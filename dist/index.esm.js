const e=(e,t)=>{const n={cfg:{orig:e},replace(e,t=e){const n=document.createElement("template");n.innerHTML=t;const i=n.content.firstChild.nextElementSibling;i.nodeName===e.nodeName?this.iterate(e,i):e.parentElement.replaceChild(i,e)},iterate(t,n,i){(t||n)&&(this.checkAdditions(t,n,i),t&&n&&t.nodeName!==n.nodeName?this.checkNodeName(t,n):t&&n&&t.nodeName===n.nodeName&&(this.checkTextContent(t,n),3!==t.nodeType&&8!==e.nodeType&&this.checkAttributes(t,n))),t&&n&&(t.childNodes&&n.childNodes?this.cfg.lengthDifferentiator=[...e.childNodes,...n.childNodes]:this.cfg.lengthDifferentiator=null,Array.apply(null,this.cfg.lengthDifferentiator).forEach((e,i)=>{this.cfg.lengthDifferentiator&&this.iterate(t.childNodes[i],n.childNodes[i],t,n)}))},checkNodeName(e,t){const n=t.cloneNode(!0);e.parentElement.replaceChild(n,e)},checkAttributes(e,t){const n=e.attributes||[],i=Object.keys(n).map(e=>n[e]),o=t.attributes||[],a=Object.keys(o).map(e=>o[e]);i.forEach(n=>null!==t.getAttribute(n.name)?e.setAttribute(n.name,t.getAttribute(n.name)):e.removeAttribute(n.name)),a.forEach(n=>e.getAttribute(n.name)!==t.getAttribute(n.name)&&e.setAttribute(n.name,t.getAttribute(n.name)))},checkTextContent(e,t){e.nodeValue!==t.nodeValue&&(e.textContent=t.textContent)},checkAdditions(e,t,n=this.cfg.orig){if(t&&void 0===e){const e=t.cloneNode(!0);3!==n.nodeType&&8!==n.nodeType&&n.appendChild(e)}else e&&void 0===t&&e.parentElement.removeChild(e)}};Object.create(n).replace(e,t)};function t(n,i){var o=function(e,t){return o.setState(e,t),e?o:o.container};o.state=n,o.schema=i;var a=t.storage,r=t.validator,s=t.emitter,c=t.tweenState,u=t.devtools;o.reactive=!0,o.debug=!!u,o.scopedCss=!0;var l=void 0;return o.isNode="undefined"!=typeof process&&null!==process&&null!==process.versions&&null!==process.versions.node,o.view=e=>e,o.middleware=[],o.uid=Math.random().toString(36).split(".")[1],o.isNode||(o.css=document.createElement("style"),o.css.id=o.uid,document.head.appendChild(o.css)),o.log=[{id:0,state:n,action:"init"}],o.i=o.log.length,o.actions=e=>(o.actionsList=e,Object.keys(e).forEach(t=>{if(void 0!==o[t])return!1;o[t]=n=>(o.action=t,e[t](n),o)}),o),this.freeze=e=>(Object.isFrozen(e)||(Object.keys(e).forEach(t=>this.freeze(e[t])),Object.freeze(e)),e),this.eq=(e,t)=>{const n=Object.keys,i=typeof e;return e&&t&&"object"===i&&i===typeof t?n(e).length===n(t).length&&n(e).every(n=>this.eq(e[n],t[n])):String(e)===String(t)},o.setState=e=>{if(a&&!o.loaded){const t=a.getItem(o,{...o.state,...e});t&&(e={...e,...t})}if(o.loaded=!0,r&&o.schema){var t=r({...o.state,...e},o.schema);if(t.length>0){var n="State doesn't match schema:";throw console.error(n,"\n",t,"\n"),new Error(n+"\n"+JSON.stringify(t)+"\n")}}if(o.prev=o.state,o.state={...o.state,...e},!this.eq(o.state,o.prev)){a&&o.loaded&&a.setItem(o,o.state),o.reactive&&o.render(o.container),i&&!o.isNode&&cancelAnimationFrame(i);var i=void 0;return o.debug&&!0!==o.tt&&(o.isNode&&!requestAnimationFrame&&(requestAnimationFrame=function(e){setTimeout(()=>e(),1)}),i=requestAnimationFrame(()=>{o.log.push({id:o.log.length,state:o.state,action:o.action||"setState"}),o.action=void 0,o.i=o.log.length-1})),this.freeze(o.state),void 0!==s&&o.action&&s.emit(""+o.action,o.state),o.middleware.forEach(e=>e({...o.state})),o}},o.tweenState=(e,t)=>(void 0!==c?c(o,e,t):o.setState(e),o),o.on=(e,t)=>(void 0!==s&&s.on(e,t),o),o.once=(e,t)=>(void 0!==s&&s.on(e,n=>{t(n),s.off(e,t)}),o),o.off=(e,t)=>(void 0!==s&&s.off(e,t),o),o.go=function(e,t){var n;return n="f"===t?o.i+e:o.i-e,o.log[n]&&(o.i=n,o.tt=!0,o.setState(o.log[n].state),o.tt=!1),o},o.rw=function(e){return e?o.go(e,"b"):(o.log[0]&&(o.tt=!0,o.setState(o.log[0].state),o.tt=!1),o.i=0,o)},o.ff=function(e){return e?o.go(e,"f"):(o.log[o.log.length-1]&&(o.tt=!0,o.setState(o.log[o.log.length-1].state),o.tt=!1),o.i=o.log.length-1,o)},o.setCss=function(){if(o&&!o.isNode&&o.css&&"function"==typeof o.style){var e=o.style(o.state);if(o.scopedCss){var t=o.container.id?o.container.id:o.container.className;t=t||o.uid;var n=o.container.id?"#":".",i=new RegExp(t+" ,\\s*\\.","gm"),a=new RegExp(t+" ,\\s*#","gm"),r=new RegExp(t+" ,\\s*([a-z\\.#])","gmi");e=e.replace(/}/g,"}\n").replace(/\;\s*\n/g,";").replace(/{\s*\n/g,"{ ").replace(/^\s+|\s+$/gm,"\n").replace(/(^[\.#\w][\w\-]*|\s*,[\.#\w][\w\-]*)/gm,n+t+" $1").replace(i,", "+n+t+" ").replace(a,", "+n+t+" #").replace(r,", "+n+t+" $1").replace(/\n/g,"").replace(/\s\s+/g," ")}var s=e.replace(/\n/g,"").replace(/\s\s+/g," ");o.css.innerHTML!==s&&(o.css.innerHTML=s)}},o.toString=function(){var e,t="",n=o.view(o.state);if(!o.loaded&&a){const e=a.getItem(o,o.state);o.setState(e),n="function"==typeof o.view?o.view(e):n}if("function"==typeof o.style&&(e=o.style(o.state).replace(/^ {4}/gm,"")),n.outerHTML)e&&(t=`<style>${e}\n</style>\n`),t+=(""+n.outerHTML).replace(/^ {4}/gm,"");else if("string"==typeof n)try{t=JSON.parse(n),t=JSON.stringify(t,null,2)}catch(i){e&&(t=`<style>${e}\n</style>\n`),t+=(""+n).replace(/^ {4}/gm,"")}else("object"==typeof n||Array.isArray(n))&&(t=JSON.stringify(n,null,2));return t},o.render=function(t){var n="function"==typeof o.view?o.view(o.state):null;if(o.isNode)return o.toString();if(!o.html&&a){const e=a.getItem(o,o.state);n="function"==typeof o.view?o.view(e):null,o.setState(e)}return document&&!o.html&&(t=document.querySelector(t)),o.html=o.container=t,l&&cancelAnimationFrame(l),l=requestAnimationFrame(()=>{if(o.css&&o.style&&o.setCss(),o.container&&n)try{e(o.container.firstElementChild,n.outerHTML?n.outerHTML:n)}catch(e){n.outerHTML?(o.container.innerHTML="",o.container.append(n)):o.container.innerHTML=n}u&&o.container&&(o.container.firstChild.setAttribute("data-uid",o.uid),u.populateUI(o.container))}),o.container},o.isNode||(window.sjComponents=window.sjComponents||{},window.sjComponents[o.uid]=o),o}for(var n=("undefined"!=typeof process&&"undefined"!=typeof require?require("perf_hooks").performance:window.performance).now,i="undefined"==typeof window?global:window,o=["moz","webkit"],a="AnimationFrame",r=i["request"+a],s=i["cancel"+a]||i["cancelRequest"+a],c=0;!r&&c<o.length;c++)r=i[o[c]+"Request"+a],s=i[o[c]+"Cancel"+a]||i[o[c]+"CancelRequest"+a];if(!r||!s){var u=0,l=0,d=[];r=function(e){if(0===d.length){var t=n(),i=Math.max(0,1e3/60-(t-u));u=i+t,setTimeout((function(){var e=d.slice(0);d.length=0;for(var t=0;t<e.length;t++)if(!e[t].cancelled)try{e[t].callback(u)}catch(e){setTimeout((function(){throw e}),0)}}),Math.round(i))}return d.push({handle:++l,callback:e,cancelled:!1}),l},s=function(e){for(var t=0;t<d.length;t++)d[t].handle===e&&(d[t].cancelled=!0)}}"undefined"!=typeof module&&(module.exports.raf=function(e){return r.call(i,e)},module.exports.cancel=function(){s.apply(i,arguments)},module.exports.polyfill=function(e){e||(e=i),e.requestAnimationFrame=r,e.cancelAnimationFrame=s});const f={linear:e=>e,inQuad:e=>e*e,outQuad:e=>e*(2-e),inOutQuad:e=>e<.5?2*e*e:(4-2*e)*e-1,inCubic:e=>e*e*e,outCubic:e=>--e*e*e+1,inOutCubic:e=>e<.5?4*e*e*e:(e-1)*(2*e-2)*(2*e-2)+1,inQuart:e=>e*e*e*e,outQuart:e=>1- --e*e*e*e,inOutQuart:e=>e<.5?8*e*e*e*e:1-8*--e*e*e*e,inQuint:e=>e*e*e*e*e,outQuint:e=>1+--e*e*e*e*e,inOutQuint:e=>e<.5?16*e*e*e*e*e:1+16*--e*e*e*e*e,inElastic:e=>(.04-.04/e)*Math.sin(25*e)+1,outElastic:e=>.04*e/--e*Math.sin(25*e),inOutElastic:e=>(e-=.5)<0?(.02+.01/e)*Math.sin(50*e):(.02-.01/e)*Math.sin(50*e)+1,inSin:e=>1+Math.sin(Math.PI/2*e-Math.PI/2),outSin:e=>Math.sin(Math.PI/2*e),inOutSin:e=>(1+Math.sin(Math.PI*e-Math.PI/2))/2,inExpo:e=>0===e?0:Math.pow(2,10*(e-1)),outExpo:function(e){return 1===e?1:1-Math.pow(2,-10*e)},inOutExpo:function(e){if(0===e||1===e)return e;var t=2*e,n=t-1;return t<1?.5*Math.pow(2,10*n):.5*(2-Math.pow(2,-10*n))},inBack:function(e,t){var n=void 0!==t?t:1.70158;return e*e*((n+1)*e-n)},outBack:function(e,t){var n=void 0!==t?t:1.70158,i=e/1-1;return i*i*((n+1)*i+n)+1},inOutBack:function(e,t=1.70158){var n=2*e,i=n-2,o=1.525*t;return n<1?.5*n*n*((o+1)*n-o):.5*(i*i*((o+1)*i+o)+2)}};var m="undefined"!=typeof process&&"undefined"!=typeof require?require("perf_hooks").performance:window.performance,h="undefined"!=typeof window&&void 0!==window.requestAnimationFrame?window.requestAnimationFrame:function(e){return r.call(i,e)},p=function(){},v=function(){return m&&m.now?m.now():Date.now()},g=function(){function e(e){this._c=e,this._c.ease=f[e.ease]||f[ease],this._c.onUpdate=e.onUpdate||p,this._c.onComplete=e.onComplete||p,this._c.delay=e.delay||0,this._c.duration=e.duration||200,e.paused||this.start()}var t=e.prototype;return t.start=function(){this._c.startTime=v(),function e(t){var n=t.delay,i=t.from,o=t.to,a=t.duration,r=t.startTime,s=t.ease,c=t.onUpdate,u=t.onComplete,l=v()-r;if(n>=l)t.frame=h((function(){return e(t)}))+1;else{var d=Math.min(1,(l-n)/a);t.progress=d;var f,m=i.length?i.map((function(e,t){var n=e+(o[t]-e)*s(d);return Number.isNaN(n)&&(n=e+(o[t]-e)*d),n})):(f=i+(o-i)*s(d),Number.isNaN(f)&&(f=i+(o-i)*d),f);c({...t,values:m}),1===d?u({...t,values:m}):t.frame=h((function(){return e(t)}))+1}}(this._c)},t.cancel=function(){cancelAnimationFrame(this._c.frame)},e}();const y=(e,t,n)=>{var i=n.onStart?n.onStart:p,o=n.onUpdate?n.onUpdate:p,a=n.onComplete?n.onComplete:p,r=!n.shouldSetState||n.shouldSetState,s=n.onSetState?n.onSetState:p;function c(e,t){Object.keys(e).forEach((n,i)=>{if(void 0!==e[n]){if("object"!=typeof e[n])return void t.push(e[n]);c(e[n],t)}})}"boolean"==typeof r&&(r=()=>r),n.frame=1,n.frameTotal=Math.ceil(.06*(n.delay+n.duration))+2;var u=[],l=[];return c(function(e){var n={};return Object.entries(e).forEach(e=>{var i=e[0],o=e[1];t[i]&&(n[i]=o)}),n}(e.state),u),c(t,l),new g({from:u||0,to:l||1,paused:n.paused||!1,delay:n.delay||0,duration:n.duration||200,ease:n.ease||"linear",frame:1,frameTotal:n.frameTotal||1,onUpdate:n=>{var a,c,u=(a=t,c=[...n.values],Object.entries(a).reduce((function e(t,[n,i]){return t[n]=i,"number"==typeof i?t[n]=c.shift():"object"==typeof i&&(t[n]=Object.entries(i).reduce(e,{})),t}),{}));return 1===n.frame&&i(n),r(n)&&(e.setState(u),s(n)),o({...n,tweenedState:u})},onComplete:n=>(e.setState(t),a(n))})},w={on:function(e,t){this._evs=this._evs||{},this._evs[e]=this._evs[e]||[],this._evs[e].push(t)},off:function(e,t){if(this._evs=this._evs||{},e in this._evs==!1)return!1;this._evs[e].splice(this._evs[e].indexOf(t),1)},emit:function(e){if(this._evs=this._evs||{},e in this._evs==!1)return!1;for(var t=0;t<this._evs[e].length;t++)this._evs[e][t].apply(this,Array.prototype.slice.call(arguments,1))}},b=(e,...t)=>(b.funcs=b.funcs||[],e.map((e,n)=>{b.i=b.i||n;var i=t[n]||"";"number"==typeof t[n]&&(i=t[n]);var o="attr";if(e.match(/style=("|')$/i)?o="style":e.match(/data-[a-z0-9\-_]+=("|')$/i)?o="dataAttr":"function"==typeof i&&i.uid&&i.state&&i.setState&&i.render?o="nestedComponent":"function"==typeof i&&"attr"===o&&e.match(/ on[a-z0-9]+=("|')$/i)&&(o="funcAttr"),i.nodeName&&"attr"===o)i=i.outerHTML;else if("nestedComponent"===o&&"function"==typeof i)e+=i.view(i.state),i="";else if("funcAttr"!==o||"function"!=typeof i||i.uid){if(Array.isArray(i))i[0].nodeName&&(i=i.map(e=>""+e.outerHTML)),i=i.join("");else if("object"==typeof i){var a="";if("dataAttr"===o)a+=JSON.stringify(i).trim();else for(var r in i)r&&i&&i.hasOwnProperty(r)&&"object"!=typeof i[r]&&("style"===o&&(a+=`${r}:${i[r]};`),"attr"===o&&(a+=` ${r}="${i[r]}"`));i=a}}else Array.isArray(b.funcs)&&(b.funcs[b.i]=i),i="",e+=b.i;return 0===t[n]&&(i="0"),b.i+=1,e?e+(i||""):""}).join("")),S=(e,...t)=>{var n=b(e,...t).trim();if(!document)return n;var i=document.createElement("template");i.innerHTML=n;for(var o=i.content.firstChild.children,a=0;a<o.length;a++)for(var r=o[a].attributes,s=0;s<r.length;s++){var c=r[s];c.name.match(/^on/)&&(o[a].removeAttribute(c.name),o[a].addEventListener(c.name.replace(/^on/,""),b.funcs[c.value]))}return i.content.firstChild},N={getItem:(e,t)=>{if(!e.store)return t;const n=JSON.parse(localStorage.getItem(e.store));return n?{...t,...n}:t},setItem:(e,t)=>{if(!e.store)return t;!e.isNode&&Component.syncTabs&&(window.syncTab=window.syncTab||[],window.syncTab[e.uid]||Component.syncTabs(e)),localStorage.setItem(e.store,JSON.stringify(t))}},A=function(e){!e.isNode&&window&&(window.addEventListener("storage",(function(t){if(t.key===e.store){let n=JSON.parse(t.newValue);e.setState({...e.state,...n})}})),window.syncTab[e.uid]=!0)};export{t as Component,w as emitter,S as htmel,b as html,N as storage,A as syncTabs,y as tweenState};
