{"version":3,"file":"ctx.min.js","sources":["../src/ctx.js"],"sourcesContent":["/*\n * Based on Canvas Context2D Wrapper <http://github.com/millermedeiros/CanvasContext2DWrapper>\n *\n * With additions shamelessly stolen from:\n *\n * - https://gist.github.com/sc0ttj/0a0b7dcfffa3894eb3da8a4c731fb251\n * - https://github.com/reu/canvas-extensions\n * - https://github.com/sapiraz/ExtendedCanvas\n * - https://github.com/Martin-Pitt/canvas-plus\n * - https://github.com/pkorac/cardinal-spline-js\n * - https://github.com/ericdrowell/concrete/blob/master/src/concrete.js\n * - https://xosh.org/canvas-recorder/\n * - https://github.com/SMUsamaShah/CanvasRecorder\n * - https://github.com/straker/kontra\n * - https://github.com/rezoner/CanvasQuery/blob/master/canvasquery.js\n * - https://hmp.is.it/creating-chroma-key-effect-html5-canvas/\n * - https://github.com/kikemadrigalr/chromaKey/blob/master/main.js\n * - http://dbp-consulting.com/tutorials/canvas/CanvasArrow.html\n * - https://github.com/Bewelge/FreeDraw/\n *\n *\n */\n\nconst ctxMethods = 'arc arcTo beginPath bezierCurveTo clearRect clip closePath createImageData createLinearGradient createRadialGradient createPattern drawFocusRing drawImage fill fillRect fillText getImageData isPointInPath lineTo measureText moveTo putImageData quadraticCurveTo rect restore rotate save scale setTransform stroke strokeRect strokeText transform translate'.split(' ');\nconst ctxProps = 'canvas fillStyle font globalAlpha globalCompositeOperation lineCap lineJoin lineWidth miterLimit shadowOffsetX shadowOffsetY shadowBlur shadowColor strokeStyle textAlign textBaseline'.split(' ');\n\n/**\n* Wrap function to enable method chaining.\n* @param {Function} fn\tFunction to be modified.\n* @param {Object} scope\tScope where function will be called.\n* @param {Object} chainReturn\tObject returned to enable chaining.\n* @return {Function} Chainable function.\n* @private\n*/\nfunction chainMethod(fn, scope, chainReturn) {\n  return function() {\n    \treturn fn.apply(scope, arguments) || chainReturn;\n  };\n}\n\n/**\n* Convert properties into getter/setter methods enabling chaining.\n* @param {String} propName\tProperty name.\n* @param {Object} scope\tObject that contain original property.\n* @param {Object} chainReturn\tObject returned to enable chaining.\n* @return {Function} Chainable getter/setter for properties.\n* @private\n*/\nfunction chainProperty(propName, scope, chainReturn) {\n  return function(value) {\n  \tif(typeof value === 'undefined') {\n  \t\treturn scope[propName];\n  \t}else{\n  \t\tscope[propName] = value;\n  \t\treturn chainReturn;\n  \t}\n  };\n}\n\nconst PIXEL_RATIO = (function () {\n  return typeof window !== 'undefined'\n    ? (window && window.devicePixelRatio) || 1\n    : 1;\n})();\n\n// calculate maths constants only once\nconst PI = Math.PI;\nconst PIx2 = PI * 2;\nconst PIo2 = PI / 2\nconst RAD2DEG = 180 / PI;\nconst DEG2RAD = PI / 180;\n\n/* TODO\n\n- responsive canvas:\n  - auto resize on screen/orientation change\n  - option to maintain aspect ratio\n  - see https://github.com/Nelkor/ctx-2d/blob/master/index.js#L18\n\n      const aspectRatio = canvas.maxWidth / canvas.maxHeight;\n      const width  = canvas.clientWidth;\n      const height = canvas.clientHeight;\n      if (aspectRatio) {\n        if (width / height < aspectRatio) {\n          canvas.width = Math.min(width, canvas.maxWidth);\n          canvas.height = canvas.width / aspectRatio;\n        } else {\n          canvas.height = Math.min(height, canvas.maxHeight);\n          canvas.width = canvas.height * aspectRatio;\n        }\n      }\n\n- various goodies: colour, maths, seeded randoms, vectors, engine objects/entities, etc\n  - https://github.com/KilledByAPixel/LittleJS/blob/main/engine/engine.all.js\n\n- undo/redo:\n  - see https://github.com/jussi-kalliokoski/canvas-history.js\n\n\n- play/replay:\n  - https://github.com/despeset/ctxShark/blob/master/ctxShark.js\n\n\n- maths:\n    - axes:\n      - generic X and Y axis generation, with ticks and labels\n\n    - plotting\n      - http://javascripter.net/faq/plotafunctiongraph.htm\n      - see https://github.com/d12/QuickPlotJS\n\n    - https://github.com/mattdesl/canvas-sketch-util/blob/master/docs/math.md\n\n    - interpolate colors and numbers: https://github.com/worksbyscott/Interpolator/blob/main/interpolator.js\n\n    - lerp for 2d coordinates\n\n          function lerp2d([x0, y0] = [], [x1, y1] = [], t) {\n            return [\n              lerp(x0, x1, t),\n              lerp(y0, y1, t),\n            ];\n          }\n          // usage\n          lerp2d([px,py], [x,y])\n\n\n=== STUFF BELOW NEEDS ANIMATION LOOP ===\n\n\n- particle emitter\n  - https://gist.github.com/nickgs/104391ea388dde93610d27093533da64\n  - https://gist.github.com/incompl/4125971\n  - https://gist.github.com/fwon/29a7d67111c8105f9de82d45856910f8\n  - https://gist.github.com/rlemon/5658113\n  - https://gist.github.com/idettman/9ddd55250e8643b83aa22ee056c34cb6\n  - https://github.com/KilledByAPixel/LittleJS/blob/main/engine/engineParticle.js\n  - also see http://buildnewgames.com/particle-systems/  (repo: https://github.com/city41/particle.js)\n\n\n\n- visual FX:\n  - smoke: https://gist.github.com/Vayn/8909634\n  - fire:\n  - explosions:\n  - fireworks: https://gist.github.com/shortercode/6647f2c11e0788ef940c82a82932d780\n  - sparks:\n  - water:\n\n\n=== STUFF BELOW NEEDS INTERACTIVITY/EVENTS SYSTEM FIRST ===\n\n- brushes:\n  - presets for draw tool, fill and stroke styles\n  - respond to pointer pressure (thickness, colour, alpha, etc)\n  - see https://github.com/jimschubert/brushes.js\n\n\n- collision detection:\n  - broad phase (narrowing it down):\n    - quad trees\n      - https://github.com/timohausmann/quadtree-js\n    - spatial has maps\n      - https://gist.github.com/troufster/710529\n      - https://gist.github.com/sc0ttj/b46aefceacb47990e59b36cceb6a81ad\n      - https://gist.github.com/sc0ttj/ec6d3faf1a77c2c8b366629a0f278f5d\n  - narrow phase (actual detecting of collisions)\n    - ?\n\n\n- https://github.com/vasturiano/canvas-color-tracker\n  - enables hover detection for canvas objects\n  - uses same method as threeJS (colours as hit areas):\n    - draws each object to shadow screen canvas, using a unique color\n    - assigns that color to the drawn object\n    - on mouse move,\n      - gets the colour under mouse x,y (from shadow canvas)\n      - looks up the object associated with that colour\n\n      const tracker = new ColorTracker();\n      const obj = { x,y,w,h,..etc };\n      const objColor = tracker.register(myObject);\n      // ...later\n      const hoverColor = ctx.getImageData(x, y, 1, 1).data;\n      const hoverObject = tracker.lookup(hoverColor);\n\n\n- easy events\n\n      const rr = ctx.create.roundedRect(x,y,w,h,r);  // caches and returns {x,y,w,h,r}\n      rr.draw();\n      rr.on('mouseover', function(e) {\n        this // equals rr\n        e    // equals event\n      });\n\n\n- map/background generator and tiler\n    - https://developer.mozilla.org/en-US/docs/Games/Techniques/Tilemaps\n    - https://developer.mozilla.org/en-US/docs/Games/Techniques/Tilemaps/Square_tilemaps_implementation:_Static_maps\n    - https://developer.mozilla.org/en-US/docs/Games/Techniques/Tilemaps/Square_tilemaps_implementation:_Scrolling_maps\n    - https://mozdevs.github.io/gamedev-js-tiles/  and  https://github.com/mozdevs/gamedev-js-tiles\n    - https://github.com/basementuniverse/tily\n    - https://github.com/yagl/tiledmap\n    - https://www.redblobgames.com/grids/parts/ (lots of theory and algorithm)\n\n\n- sprite (series of images, easy to setup and control/animate)\n  - see http://buildnewgames.com/sprite-animation/\n\n\n- shadow casting? :\n    - https://ncase.me/sight-and-light/  and https://github.com/ncase/sight-and-light\n    - or  https://github.com/kreldjarn/shadowjs/blob/master/shadow.js:\n\n     var origin = {x: 100, y: 200};\n     var rect = {\n         lx: 300,\n         ty: 350,\n         w: 50,\n         h: 200\n     };\n\n     // Cast a shadow of a rectangle from origin\n     Shadow.castFromRectangle(\n         ctx,\n         origin,\n         rect.lx,\n         rect.ty,\n         rect.w,\n         rect.h\n     );\n\n\n- field of view\n    - see https://legends2k.github.io/2d-fov/  and  https://github.com/legends2k/2d-fov\n\n\n- mouse interactivity - add properties that can be used by a useControls() addon\n\n     function getMousePos(event) {\n        var rect = ctx.canvas.getBoundingClientRect();\n        ctx.mousePos = {x:(event.clientX-rect.left)/ctx.canvas.scale, y:(event.clientY-rect.top)/ctx.canvas.scale};\n      }\n\n- node graph\n  - see https://github.com/paulfears/Graphs\n\n*/\n\n\n// helper funcs\n\nfunction getVideoMimeType() {\n  let supportedType = null;\n  let types = [\n    \"video/webm\",\n    'video/webm\\;codecs=vp9',\n    'video/vp8',\n    \"video/webm\\;codecs=vp8\",\n    \"video/webm\\;codecs=daala\",\n    \"video/webm\\;codecs=h264\",\n    \"video/mp4\",\n    \"video/mpeg\"\n  ];\n  for (let i in types) {\n    if (MediaRecorder.isTypeSupported(types[i])) {\n      supportedType = types[i];\n      break;\n    }\n  }\n  return supportedType;\n}\n\n// create a link to a blob, simulates clicking it, which triggers\n// a download of the blob in a browser\nfunction downloadBlobAs(blob, name) {\n  let a  = document.createElement('a'),\n      url = URL.createObjectURL(blob),\n      fileName = name || `canvas-${new Date().valueOf()}`,\n      e;\n\n  // set attributes\n  a.target = '_blank';\n  a.href = url;\n  a.download = fileName;\n  a.click();\n  window.URL.revokeObjectURL(url);\n}\n\n// draw arrow heads\nconst drawHead = function(ctx,x0,y0,x1,y1,x2,y2,style) {\n  // all cases do this.\n  ctx.save();\n  ctx.beginPath();\n  ctx.moveTo(x0,y0);\n  ctx.lineTo(x1,y1);\n  ctx.lineTo(x2,y2);\n  switch(style) {\n    case 0:\n      // straight filled, add the bottom as a line and fill.\n      ctx.beginPath();\n      ctx.moveTo(x0,y0);\n      ctx.lineTo(x1,y1);\n      ctx.lineTo(x2,y2);\n      ctx.lineTo(x0,y0);\n      ctx.fill();\n      break;\n    case 1:\n      //filled head, add the bottom as a quadraticCurveTo curve and fill\n      const cpx = (x0+x1+x2)/3;\n      const cpy = (y0+y1+y2)/3;\n      ctx.quadraticCurveTo(cpx,cpy,x0,y0);\n      ctx.fill();\n      break;\n  }\n  ctx.restore();\n};\n\n\n// Now define the extra methods to add/bind to our extended 2d canvas context\nconst extraMethods = {\n\n  // general helper funcs\n  clear: function(resetTransform) {\n    if (resetTransform === true) this.setTransform(1, 0, 0, 1, 0, 0);\n    this.clearRect(0, 0, this.canvas.width * PIXEL_RATIO, this.canvas.height * PIXEL_RATIO);\n  },\n  fullscreen: function() {\n    if (!document.fullscreenElement) this.canvas.requestFullscreen();\n    else document.exitFullscreen();\n  },\n  //getPixels: function() {\n  //  return this.getImageData(0, 0, this.canvas.width, this.canvas.height).data\n  //},\n  isClean: function() {\n    try {\n        const pixel = this.getImageData(0, 0, 1, 1);\n        return true;\n    } catch(err) {\n        return false;\n    }\n  },\n  size: function(w, h, a) {\n    if (this.w === w && this.h === h) return; // if no new size, just return\n    // if width or height not given, get them from aspect ratio\n    this.w = w ? w : h * a;\n    this.h = h ? h : w * a;\n    // respect device pixel ratio\n    this.canvas.width = this.w * PIXEL_RATIO;\n    this.canvas.height = this.h * PIXEL_RATIO;\n    // update the CSS too\n    this.canvas.style.width = this.w + 'px';\n    this.canvas.style.height = this.h + 'px';\n    this.canvas.style.objectFit = a ? 'contain' : null;\n    // adjust scale for pixel ratio\n    if (this.contextType === '2d' && PIXEL_RATIO !== 1) {\n      this.scale(PIXEL_RATIO, PIXEL_RATIO);\n    }\n  },\n\n  // a simple \"camera\"\n  camera: function(x = 0, y = 0, scale = 1, degrees = 0) {\n    this.resetTransform();\n    this.translate(x, y);\n    this.rotate(degrees * DEG2RAD);\n    this.scale(scale, scale);\n    this.translate(-x, -y);\n  },\n\n  // \"green screen\" filter - replaces green (by default) pixels with transparent ones\n  chromaKey: function(tolerance = 150, color = [0,255,0]) {\n    const t = tolerance > 250 ? 250 : tolerance; // more than 255 produces weird results\n    const imageData = this.getImageData(0, 0, this.canvas.width, this.canvas.height);\n    const d = imageData.data;\n    let diff;\n    // for each pixel, get its diff from cache, or calculate it\n    // NOTE: we have separate routines for green, and other colours\n    // see next note..\n    // if user wants to remove green\n    if (color[1] > color[0] && color[1] > color[2]) {\n      for (let i = 0, l = d.length; i < l; i += 4) {\n        if (d[i+1] > 50 && d[i+1] > d[i] && d[i+1] > d[i+2]) d[i+3] = 0;\n      }\n    // if user wants to remove anything else\n    } else {\n      for (let i = 0, l = d.length; i < l; i += 4) {\n        diff = Math.abs(color[0] - d[i+0]) +\n               Math.abs(color[1] - d[i+1]) +\n               Math.abs(color[2] - d[i+2]);\n        // NOTE: this bit doesn't work well if removing green (hence routine above)\n        if (diff < t) d[i+3] = (diff*diff)/t;\n      }\n    }\n    this.putImageData(imageData, 0, 0);\n  },\n\n  // drawing methods\n\n  arcArrow: function(x,y,r,startangle,endangle,anticlockwise,style=0,d=10,which=1,angle=Math.PI/8) {\n    // get radians from degrees\n    startangle = startangle * DEG2RAD;\n    endangle = endangle * DEG2RAD;\n    angle = angle * DEG2RAD;\n    this.save();\n    this.lineWidth=this.lineWidth>2?2:this.lineWidth; // anything over 2 looks bad (arrow head not close enough to edges of line)\n    this.beginPath();\n    this.arc(x,y,r,startangle,endangle,anticlockwise);\n    this.stroke();\n    let sx, sy, lineangle, destx, desty;\n    this.strokeStyle='rgba(0,0,0,0)';\t// don't show the shaft\n    if(which&1){\t    // draw the destination end\n    \tsx = Math.cos(startangle)*r+x;\n    \tsy = Math.sin(startangle)*r+y;\n    \tlineangle = Math.atan2(x-sx,sy-y);\n    \tif(anticlockwise){\n    \t    destx = sx+10*Math.cos(lineangle);\n    \t    desty = sy+10*Math.sin(lineangle);\n    \t}else{\n    \t    destx = sx-10*Math.cos(lineangle);\n    \t    desty = sy-10*Math.sin(lineangle);\n    \t}\n  \t  extraMethods.arrow.apply(this, [sx,sy,destx,desty,style,d,2,angle*RAD2DEG])\n    }\n    if(which&2){\t    // draw the origination end\n  \t  sx = Math.cos(endangle)*r+x;\n  \t  sy = Math.sin(endangle)*r+y;\n  \t  lineangle = Math.atan2(x-sx,sy-y);\n    \tif(anticlockwise){\n    \t  destx = sx-10*Math.cos(lineangle);\n    \t  desty = sy-10*Math.sin(lineangle);\n    \t}else{\n    \t  destx = sx+10*Math.cos(lineangle);\n    \t  desty = sy+10*Math.sin(lineangle);\n    \t}\n  \t  extraMethods.arrow.apply(this, [sx,sy,destx,desty,style,d,2,angle*RAD2DEG])\n    }\n    this.restore();\n  },\n  arrow: function(x1,y1,x2,y2,style = 1,d = 10,which = 1,angle = Math.PI/8){\n    angle = angle*DEG2RAD;\n    // For ends with arrow we actually want to stop before we get to the arrow\n    // so that wide lines won't put a flat end on the arrow.\n    const dist = Math.sqrt((x2-x1)*(x2-x1)+(y2-y1)*(y2-y1));\n    const ratio = (dist-d/3)/dist;\n    let tox, toy, fromx, fromy;\n    if (which === 1){\n      fromx = x1;\n      fromy = y1;\n      tox = Math.round(x1+(x2-x1)*ratio);\n      toy = Math.round(y1+(y2-y1)*ratio);\n    }else{\n      fromx = x1+(x2-x1)*(1-ratio);\n      fromy = y1+(y2-y1)*(1-ratio);\n      tox = x2;\n      toy = y2;\n    }\n    // Draw the shaft of the arrow\n    this.lineWidth=this.lineWidth>2?2:this.lineWidth; // anything over 2 looks bad (arrow head not close enough to edges of line)\n    this.beginPath();\n    this.moveTo(fromx,fromy);\n    this.lineTo(tox,toy);\n    this.stroke();\n    // calculate the angle of the line\n    const lineangle = Math.atan2(y2-y1,x2-x1);\n    // h is the line length of a side of the arrow head\n    const h = Math.abs(d/Math.cos(angle));\n    let angle1, topx, topy, angle2, botx, boty;\n\n    if (which&1){\t// handle far end arrow head\n      angle1 = lineangle+Math.PI+angle;\n      topx = x2+Math.cos(angle1)*h;\n      topy = y2+Math.sin(angle1)*h;\n      angle2 = lineangle+Math.PI-angle;\n      botx = x2+Math.cos(angle2)*h;\n      boty = y2+Math.sin(angle2)*h;\n      drawHead(this,topx,topy,x2,y2,botx,boty,style);\n    }\n    if (which&2){\t// handle far end arrow head\n      // handle near end arrow head\n      angle1 = lineangle+angle;\n      topx = x1+Math.cos(angle1)*h;\n      topy = y1+Math.sin(angle1)*h;\n      angle2 = lineangle-angle;\n      botx = x1+Math.cos(angle2)*h;\n      boty = y1+Math.sin(angle2)*h;\n      drawHead(this,topx,topy,x1,y1,botx,boty,style);\n    }\n  },\n  circle: function(x,y,r,deg = 360,antiClockwise) {\n    this.beginPath();\n    this.arc(x, y, r, 0, deg*DEG2RAD, antiClockwise);\n    // go to center of circle, and _then_ close the path (creates a \"pie\"\n    // or \"pacman\" shape, if degrees < 360)\n    this.lineTo(x, y);\n    this.closePath();\n  },\n  curve: function(points, tension, numOfSeg, close) { // also see a simpler alternative here: https://stackoverflow.com/a/49371349\n  \t// options or defaults\n  \ttension = (typeof tension === 'number') ? tension : 0.5;\n  \tnumOfSeg = numOfSeg ? numOfSeg : 20;\n    // set some vars\n  \tlet pts;// clone point array\n  \tlet res = [];\n  \tlet l = points.length;\n  \tlet i;\n  \tlet cache = new Float32Array((numOfSeg+2)*4);\n  \tlet cachePtr = 4;\n  \t// begin..\n  \tpts = points.slice(0);\n  \tif (close) {\n  \t\tpts.unshift(points[l - 1]); // insert end point as first point\n  \t\tpts.unshift(points[l - 2]);\n  \t\tpts.push(points[0], points[1]); // first point as last point\n  \t}\n  \telse {\n  \t\tpts.unshift(points[1]);\t// copy 1. point and insert at beginning\n  \t\tpts.unshift(points[0]);\n  \t\tpts.push(points[l - 2], points[l - 1]);\t// duplicate end-points\n  \t}\n  \t// cache inner-loop calculations as they are based on t alone\n  \tcache[0] = 1;\n  \tfor (i = 1; i < numOfSeg; i++) {\n  \t\tlet st = i / numOfSeg,\n  \t\t\tst2 = st * st,\n  \t\t\tst3 = st2 * st,\n  \t\t\tst23 = st3 * 2,\n  \t\t\tst32 = st2 * 3;\n\n  \t\tcache[cachePtr++] =\tst23 - st32 + 1;\t// c1\n  \t\tcache[cachePtr++] =\tst32 - st23;\t\t// c2\n  \t\tcache[cachePtr++] =\tst3 - 2 * st2 + st;\t// c3\n  \t\tcache[cachePtr++] =\tst3 - st2;\t\t\t// c4\n  \t}\n  \tcache[++cachePtr] = 1;\n  \t// the parser func\n  \tfunction parse(pts, cache, l) {\n  \t\tfor (let i = 2; i < l; i += 2) {\n  \t\t\tlet pt1 = pts[i],\n  \t\t\t\tpt2 = pts[i+1],\n  \t\t\t\tpt3 = pts[i+2],\n  \t\t\t\tpt4 = pts[i+3],\n  \t\t\t\tt1x = (pt3 - pts[i-2]) * tension,\n  \t\t\t\tt1y = (pt4 - pts[i-1]) * tension,\n  \t\t\t\tt2x = (pts[i+4] - pt1) * tension,\n  \t\t\t\tt2y = (pts[i+5] - pt2) * tension;\n\n  \t\t\tfor (let t = 0; t <= numOfSeg; t++) {\n  \t\t\t\tconst c = t * 4;\n  \t\t\t\tres.push(cache[c] * pt1 + cache[c+1] * pt3 + cache[c+2] * t1x + cache[c+3] * t2x,\n  \t\t\t\t\t\t cache[c] * pt2 + cache[c+1] * pt4 + cache[c+2] * t1y + cache[c+3] * t2y);\n  \t\t\t}\n  \t\t}\n  \t}\n  \t// calculate/parse the points\n  \tparse(pts, cache, l);\n  \tif (close) {\n  \t\tpts = [];\n  \t\tpts.push(points[l - 4], points[l - 3], points[l - 2], points[l - 1]); // second last and last\n  \t\tpts.push(points[0], points[1], points[2], points[3]); // first and second\n  \t\tparse(pts, cache, 4);\n  \t}\n  \t// add lines to path\n  \tfor(i = 0, l = res.length; i < l; i += 2) {\n  \t\tthis.lineTo(res[i], res[i+1]);\n    }\n  \treturn res;\n  },\n  ellipse: function(x, y, width, height) {\n    let kappa, ox, oy, xe, xm, ye, ym;\n    kappa = .5522848;\n    ox = (width / 2) * kappa;\n    oy = (height / 2) * kappa;\n    xe = x + width;\n    ye = y + height;\n    xm = x + width / 2;\n    ym = y + height / 2;\n    this.moveTo(x, ym);\n    this.bezierCurveTo(x, ym - oy, xm - ox, y, xm, y);\n    this.bezierCurveTo(xm + ox, y, xe, ym - oy, xe, ym);\n    this.bezierCurveTo(xe, ym + oy, xm + ox, ye, xm, ye);\n    this.bezierCurveTo(xm - ox, ye, x, ym + oy, x, ym);\n  },\n  fillCircle: function(x,y,radius,deg) {\n    extraMethods.circle.apply(this, [x,y,radius,deg])\n    this.fill();\n  },\n  fillEllipse: function(x, y, width, height) {\n    this.beginPath();\n  \textraMethods.ellipse.apply(this, [x, y, width, height])\n    this.closePath();\n    this.fill();\n  },\n  fillPolygon: function (points, dashPattern = []) {\n    extraMethods.polyshape.apply(this, [points, dashPattern, false]);\n    this.fill();\n    this.restore(); // use this cos we used setLineDash() in polygon()\n  },\n  fillPolyshape: function(x,y,radius,s,a) {\n    extraMethods.polyshape.apply(this, [x,y,radius,s,a])\n    this.fill();\n  },\n  fillRing: function(x, y, innerRadius, outerRadius) {\n  \textraMethods.ring.apply(this, [x, y, innerRadius, outerRadius]);\n    this.fill();\n  },\n  fillRoundedRect: function(x, y, w, h, r) {\n    this.beginPath();\n  \textraMethods.roundedRect.apply(this, [x, y, w, h, r])\n    this.fill();\n  },\n  fillStar: function(x,y,radius,s,a) {\n    extraMethods.star.apply(this, [x,y,radius,s,a])\n    this.fill();\n  },\n  fillTriangle: function(x,y,radius,angle) {\n    extraMethods.polyshape.apply(this, [x,y,radius,3,angle ? angle : -90])\n    this.fill();\n  },\n  gradientCircle: function(x, y, r, r2, offsetX = 0, offsetY = 0, fillSteps) {\n    const fillGradient = this.createRadialGradient(x + offsetX, y + offsetY, r2, x + offsetX, y + offsetY, r)\n    for (let i = 0; i < fillSteps.length; i++) {\n      fillGradient.addColorStop(fillSteps[i][0], fillSteps[i][1]);\n    }\n    this.fillStyle = fillGradient;\n    extraMethods.circle.apply(this, [x,y,r2])\n    this.fill();\n    this.closePath();\n  },\n  gradientRect: function(x, y, w, h, fillSteps, horiz = true) {\n    if (fillSteps) {\n      const fillGradient = horiz\n        ? this.createLinearGradient(x, y, x, y+h)\n        : this.createLinearGradient(x, y, x+w, y);\n      for (let i = 0; i < fillSteps.length; i++) {\n        fillGradient.addColorStop(fillSteps[i][0], fillSteps[i][1]);\n      }\n      this.fillStyle = fillGradient;\n      this.fillRect(x, y, w, h);\n      this.closePath();\n    }\n  },\n  line: function(px, py, x, y, dashPattern = []) {\n    this.beginPath();\n    this.save();\n    this.setLineDash(dashPattern);\n    this.moveTo(px, py);\n    this.lineTo(x, y);\n    this.closePath();\n    this.fill();\n    this.stroke();\n    this.restore(); // use this cos we used setLineDash()\n  },\n  polygon: function(points, dashPattern = [], restore = true) {\n    this.beginPath();\n    if (restore) this.save();\n    this.setLineDash(dashPattern);\n    const x = points[0][0];\n    const y = points[0][1];\n    this.moveTo(x, y);\n    points.shift(); // remove first element, we just went there\n    points.forEach(point => this.lineTo(point[0], point[1]));\n    this.closePath();\n    if (restore) this.restore(); // use this cos we used setLineDash()\n  },\n  polyshape: function(x,y,radius,s,a) {\n    const position \t= {x,y};\n    const sides \t\t= s ? s : 6;\n    const angle\t\t\t= a ? a : 0;\n    this.translate(position.x,position.y);\n    this.rotate(angle * DEG2RAD);\n    this.beginPath();\n    this.moveTo(radius, 0);\n    for(var j = 0; j <= PIx2; j += PI / (sides/2)) {\n      this.lineTo(radius * Math.cos(j), radius * Math.sin(j));\n    }\n    this.closePath();\n    this.rotate(-angle * DEG2RAD);\n    this.translate(-position.x,-position.y);\n  },\n  ring: function(x, y, innerRadius, outerRadius) {\n    this.beginPath();\n    this.arc(x, y, innerRadius, 0, PIx2, false);\n    this.moveTo(outerRadius, 0);\n    this.arc(x, y, outerRadius, PIx2, 0, true);\n    this.closePath();\n  },\n  roundedRect: function(x, y, w, h, r) {\n  \tthis.moveTo(x + r, y);\n  \tthis.arcTo(x + w, y, x + w, y + r, r);\n  \tthis.arcTo(x + w, y + h, x + w - r, y + h, r);\n  \tthis.arcTo(x, y + h, x, y + h - r, r);\n  \tthis.arcTo(x, y, x + r, y, r);\n    this.closePath();\n  },\n  spiral: function(x,y,rad,iter,rotation,lineWidth,stroke) {\n\t\tlet stepSize = rad / (iter+1);\n\t\tlet i = 0;\n\t\tlet ang = stepSize/Math.PI*2 * i;\n\t\trotation = rotation*DEG2RAD;\n\t\tthis.save();\n\t\tthis.lineWidth = lineWidth;\n\t\tthis.strokeStyle = stroke;\n\t\tlet midx = (x) ;\n\t\tlet midy = (y) ;\n\t\tx = (x) + ang * Math.cos(ang - rotation);\n\t\ty = (y) + ang * Math.sin(ang - rotation);\n\t\tthis.beginPath();\n\t\twhile (i < iter) {\n\t\t\ti++;\n\t\t\tang = stepSize/Math.PI*2 * i;\n\t\t\tthis.moveTo(x, y);\n\t\t\tx = midx + ang * Math.cos(ang - rotation);\n\t\t\ty = midy + ang * Math.sin(ang - rotation);\n\t\t\tthis.lineTo(x, y);\n\t\t}\n\t\tthis.stroke();\n\t\tthis.closePath();\n\t\tthis.restore();\n  },\n  square: function(x,y,w) {\n    this.beginPath();\n    this.rect(x, y, w, w);\n    this.closePath();\n  },\n  star: function(x,y,radius,s,a) {\n    const position \t= {x,y};\n    const sides \t\t= (s ? s : 5) * 2;\n    const angle\t\t\t= -90 - (a ? a : 0);\n    this.translate(position.x,position.y);\n    this.rotate(angle * DEG2RAD);\n    this.beginPath();\n    this.moveTo(radius, 0);\n    let wobble = 2;\n    for(var j = 0; j <= PIx2; j += PI / (sides/2)) {\n    \twobble = wobble == 1 ? 2 : 1;\n      this.lineTo(((radius / (wobble)) * Math.cos(j)),((radius / (wobble)) * Math.sin(j)));\n    }\n    this.closePath();\n    this.rotate(-angle * DEG2RAD);\n    this.translate(-position.x,-position.y);\n  },\n  strokeCircle: function(x,y,radius,deg) {\n    extraMethods.circle.apply(this, [x,y,radius,deg])\n    this.stroke();\n  },\n  strokeEllipse: function(x, y, width, height) {\n    this.beginPath();\n  \textraMethods.ellipse.apply(this, [x, y, width, height])\n    this.closePath();\n    this.stroke();\n  },\n  strokeRing: function(x, y, innerRadius, outerRadius) {\n  \textraMethods.ring.apply(this, [x, y, innerRadius, outerRadius]);\n    this.stroke();\n  },\n  strokeRoundedRect: function(x, y, w, h, r) {\n    this.beginPath();\n  \textraMethods.roundedRect.apply(this, [x, y, w, h, r])\n    this.stroke();\n  },\n  strokePolygon: function (points, dashPattern = []) {\n    extraMethods.polyshape.apply(this, [points, dashPattern, false]);\n    this.stroke();\n    this.restore(); // use this cos we used setLineDash() in polygon()\n  },\n  strokePolyshape: function(x,y,radius,s,a) {\n    extraMethods.polyshape.apply(this, [x,y,radius,s,a])\n    this.stroke();\n  },\n  strokeStar: function(x,y,radius,s,a) {\n    extraMethods.star.apply(this, [x,y,radius,s,a])\n    this.stroke();\n  },\n  strokeTriangle: function(x,y,radius,angle) {\n    extraMethods.polyshape.apply(this, [x,y,radius,3,angle ? angle : -90])\n    this.stroke();\n  },\n  triangle: function(x,y,radius,angle) {\n  \textraMethods.polyshape.apply(this, [x,y,radius,3,angle ? angle : -90])\n  },\n\n  // grids\n  checkerboard: function(x, y, w, h, gridSize, colorA, colorB) {\n    const tx = w / gridSize | 0;\n    const ty = h / gridSize | 0;\n    let color;\n    this.save();\n    this.rect(x, y, w, h);\n    for (var i = 0; i <= tx; i++) {\n      for (var j = 0; j <= ty; j++) {\n        if (j % 2) {\n          color = i % 2 ? colorA : colorB;\n        }\n        else {\n          color = i % 2 ? colorB : colorA;\n        }\n        this.fillStyle = color;\n        this.fillRect(x + i * gridSize, y + j * gridSize, gridSize, gridSize);\n      }\n    }\n    this.restore();\n  },\n  drawGrid(size, lineWidth = 0.1, strokeColor = '#444') {\n    extraMethods.drawGridBox.apply(this, [0,0,this.canvas.width,this.canvas.height,size,lineWidth,strokeColor])\n  },\n  drawGridBox(x, y, w, h, size, lineWidth = 0.1, color = '#444') {\n    this.save();\n    this.lineWidth = lineWidth;\n    this.strokeStyle = color;\n    this.moveTo(x,y)\n    this.lineTo(x+w,y)\n    this.lineTo(x+w,y+h)\n    this.lineTo(x,y+h)\n    this.lineTo(x,y)\n    // draw vertical lines\n    for (let i=1; i < w/size; i++) {\n      this.moveTo(x+size*i, y);\n      this.lineTo(x+size*i, y+h);\n    }\n    // draw horizontal lines\n    for (let i=1; i < h/size; i++) {\n      this.moveTo(x, y+size*i);\n      this.lineTo(x+w, y+size*i);\n    }\n    this.stroke();\n    this.closePath();\n    this.restore();\n  },\n\n  // helper function - creates an img element, caches it, then sets the\n  // onload method up to draw the image, and returns the image element - all\n  // that is left to do to it is set the src elsewhere\n  cacheImg: function(url, x, y, w, h, dx, dy, dWidth, dHeight) {\n    if (this.cache[url]) return this.cache[url];\n    this.cache[url] = new Image();\n    this.cache[url].onload = () => {\n      this.cache[url].width = w;\n      this.cache[url].height = h;\n      return dx\n        ? this.drawImage(this.cache[url], x, y, w, h, dx, dy, dWidth, dHeight)\n        : this.drawImage(this.cache[url], x, y, w, h);\n    }\n    this.cache[url].crossOrigin = 'anonymous';\n    return this.cache[url];\n  },\n\n  // for explanation of params,see https://developer.mozilla.org/en-US/docs/Web/API/CanvasRenderingContext2D/drawImage/canvas_drawimage.jpg\n  drawImg: function(url, x, y, w, h, dx, dy, dWidth, dHeight) {\n    // draw now, if available\n    if (url.outerHTML) return dx\n      ? this.drawImage(url, x, y, w, h, dx, dy, dWidth, dHeight)\n      : this.drawImage(url, x, y, w, h);\n    if (!this.cache) this.cache = {};\n    if (this.cache[url] && this.cache[url].src) {\n      return dx\n      ? this.drawImage(this.cache[url], x, y, w, h, dx, dy, dWidth, dHeight)\n      : this.drawImage(this.cache[url], x, y, w, h);\n    }\n    // or load it and cache it first, *then* set it's src attribute to trigger\n    // the 'onload' event, which will then draw the image to the canvas\n    extraMethods.cacheImg.apply(this, [url, x, y, w, h, dx, dy, dWidth, dHeight]).src = !url.includes('<svg')\n          ? url\n          : \"data:image/svg+xml; charset=utf8,\" + encodeURIComponent(url);\n  },\n\n  // styling helpers\n  setStyle: function(obj) {\n    for(i in obj) {\n      this[i] = obj[i];\n    };\n  },\n\n  // maths helpers\n  angleFromPoints: function(x1, x2, y1, y2) {\n    return Math.atan2(y2 - y1, x2 - x1) // returns radians\n    // see https://stackoverflow.com/a/1707251\n    // The * DEG2RAD converts radians to degrees,\n    // the + 180 makes sure its always positive i.e. 0-360 deg,\n    // rather than -180 to 180 deg\n    return Math.atan2(y2 - y1, x2 - x1) * DEG2RAD + 180;\n  },\n  angleToTarget: function (x, y, x1, y1) {\n    // atan2 returns the counter-clockwise angle in respect to the x-axis, but\n    // the canvas rotation system is based on the y-axis (rotation of 0 = up).\n    // so we need to add a quarter rotation to return a counter-clockwise\n    // rotation in respect to the y-axis\n    return Math.atan2(y1 - y, x1 - x) + PIo2;\n  },\n  clamp: function(x, min, max) {\n    return Math.min(Math.max(min, x), max);\n  },\n  distance: function(x2, x1, y2, y1) {\n    return Math.sqrt(Math.pow(x2-x1, 2) + Math.pow(y2-y1, 2));\n  },\n  inverseLerp: function(start, end, value) {\n    return (value - start) / (end - start);\n  },\n  lerp: function(start, end, value) {\n    return start + value * ( end - start );\n  },\n  seededRandom: function (str) {\n    // see https://stackoverflow.com/a/47593316/2124254\n    // see https://github.com/bryc/code/blob/master/jshash/PRNGs.m\n    // based on the above references, this was the smallest code yet decent\n    // quality seed random function (from https://github.com/straker/kontra/blob/main/src/helpers.js)#\n    //\n    // first create a suitable hash of the seed string using xfnv1a\n    // @see https://github.com/bryc/code/blob/master/jshash/PRNGs.md#addendum-a-seed-generating-functions\n    for (var i = 0, h = 2166136261 >>> 0; i < str.length; i++) {\n      h = Math.imul(h ^ str.charCodeAt(i), 16777619);\n    }\n    h += h << 13;\n    h ^= h >>> 7;\n    h += h << 3;\n    h ^= h >>> 17;\n    let seed = (h += h << 5) >>> 0;\n    // then return the seed function and discard the first result\n    // @see https://github.com/bryc/code/blob/master/jshash/PRNGs.md#lcg-lehmer-rng\n    let rand = () => ((2 ** 31 - 1) & (seed = Math.imul(48271, seed))) / 2 ** 31;\n    rand();\n    return rand;\n  },\n  random: function(min, max, decimal) {\n    if (decimal) return Math.random() * (max - min) + min;\n    return Math.floor(Math.random() * (max - min+1)) + min;\n  },\n  randomFrom(arr) {\n    return extraMethods.random.apply(this, [1, arr.length])\n  },\n  rotateAt: function(x, y, deg) {\n    this.translate(x, y);\n    this.rotate(deg * DEG2RAD);\n    this.translate(-x, -y);\n  },\n  toRad: function(deg) { // degrees to radians\n    return deg * DEG2RAD;\n  },\n  toDeg: function(rad) { // radians to degrees\n    return rad * RAD2DEG;\n  }\n};\n\nconst extraMethodNames = Object.keys(extraMethods);\n\n\n// ...Now the main function to export\n\n/**\n* @class Canvas Context2D Wrapper.\n* @param {CanvasRenderingContext2D} origCtx\tCanvas Context2D that will be wrapped.\n* @param {Component} c\tthe @scottjarvis/component to which the ctx is attached (optional)\n*/\nconst Ctx = function(origCtx, c) {\n  let n = ctxMethods.length;\n  let curProp;\n  let chunks;\n  const supportedType = (!!window.MediaRecorder) ? getVideoMimeType() : false;\n\n  /**\n   * Reference to Canvas Rendering Context 2D.\n   * @type CanvasRenderingContext2D\n   */\n  this.context = origCtx;\n\n  //wrap methods\n  while(n--) {\n  \tcurProp = ctxMethods[n];\n  \tthis[curProp] = chainMethod(origCtx[curProp], origCtx, this);\n  }\n\n  // wrap the extra methods\n  n = extraMethodNames.length;\n  while(n--) {\n  \tcurProp = extraMethodNames[n];\n  \tthis[curProp] = chainMethod(extraMethods[curProp], origCtx, this);\n  }\n\n  //convert properties into methods (getter/setter)\n  n = ctxProps.length;\n  while(n--) {\n  \tcurProp = ctxProps[n];\n  \tthis[curProp] = chainProperty(curProp, origCtx, this);\n  }\n\n  // the above code replaces context properties with methods in our new\n  // context, so put back the reference to the canvas element, cos we want it\n  this.canvas = origCtx.canvas;\n\n\n  // add more methods to the extended context - they're added here cos they're\n  // nested/namespaced under ctx.image.* and ctx.video.* and the above\n  // loops that make methods chainable don't handle nested objects\n\n  this.image = {\n    // download canvas as an image file, called ${name}\n    saveAs: function(name) {\n      this.canvas.toBlob(blob => downloadBlobAs(blob, name));\n    },\n    // pass the canvas an <img> to the given callback\n    toElement: function(cb) {\n      const img = new Image();\n      const { w, h } = this;\n      // once image is loaded, pass it into the callback\n      img.onload = function() {\n        img.width = w;\n        img.height = h;\n        cb(img);\n      };\n      img.crossOrigin = 'anonymous';\n      // set the src to trigger img.onload\n      img.src = this.canvas.toDataURL('image/png');\n    },\n  };\n\n  // NOTE - the video methods defined here are arrow functions cos we want\n  // `this` to refer to our extended context, not the original one\n  this.video = {\n\n    // record canvas to video data\n    record: (fps, mimeType = supportedType, audioBitsPerSecond = 128000, videoBitsPerSecond = 2500000) => {\n      if (!window.MediaRecorder) {\n        throw Error('Video recording not supported');\n        return false;\n      }\n      if (this.isRecording === true) return true;\n      const framesPerSecond = (fps > 0 && fps <=60) ? fps : 60;\n      chunks = [];\n      // set media recorder options\n      const opts = {\n        audioBitsPerSecond,\n        videoBitsPerSecond,\n        mimeType\n      };\n      // set the stream to record\n      const stream = this.canvas.captureStream(framesPerSecond);\n      //if (!stream) throw Error('No stream!');\n      // create the recorder\n      this.rec = new MediaRecorder(stream, opts);\n      //if (!this.rec) throw Error('No MediaRecorder.');\n      // set callbacks\n      this.rec.ondataavailable = function(e) {\n        // save the video data (received in chunks)\n        chunks.push(e.data);\n      };\n      this.rec.onstop = (e) => {\n        // when the recording stops, save and return the combined blob\n        this.videoBlob = new Blob(chunks, { type: mimeType });\n        chunks = [];\n        this.isRecording = false;\n        this.rec = null;\n        return this.videoBlob;\n      };\n      this.rec.onstart = (e) => this.isRecording = true;\n      this.rec.onresume = (e) => this.isRecording = true;\n      this.rec.onpause = (e) => {\n        this.isRecording = false;\n        this.videoBlob = new Blob(chunks, { type: mimeType });\n      }\n      // begin recording\n      this.rec.start();\n    },\n    // stop recording canvas to video\n    stop: () => {\n      if (!this.isRecording) throw Error('Nothing recording');\n      return this.rec.stop();\n    },\n    // download the recorded video data as a video file\n    saveAs: (filename) => {\n      setTimeout(() => {\n        if (this.isRecording) this.rec.stop();\n        if (!this.videoBlob) throw Error('No video to save');\n        downloadBlobAs(this.videoBlob, filename) // this.rec.stop() returns the final video as a blob;\n        this.videoBlob = null;\n      }, 64);\n    },\n    // pass the recorded canvas as a <video> to the given callback\n    toElement: (cb) => {\n      setTimeout(() => {\n        if (!this.videoBlob) throw Error('No video to export');\n        const video = document.createElement('video');\n        const { w, h }  = this;\n        video.width = w;\n        video.height = h;\n        video.crossOrigin = 'anonymous';\n        video.src = URL.createObjectURL(this.videoBlob);\n        video.load();\n        cb(video);\n      }, 64);\n    }\n  };\n\n  return;\n};\n\n\nexport default Ctx;\n"],"names":["ctxMethods","split","ctxProps","chainMethod","fn","scope","chainReturn","apply","arguments","chainProperty","propName","value","PIXEL_RATIO","window","devicePixelRatio","PI","Math","PIx2","PIo2","RAD2DEG","DEG2RAD","downloadBlobAs","blob","name","a","document","createElement","url","URL","createObjectURL","fileName","Date","valueOf","target","href","download","click","revokeObjectURL","drawHead","ctx","x0","y0","x1","y1","x2","y2","style","save","beginPath","moveTo","lineTo","fill","cpx","cpy","quadraticCurveTo","restore","extraMethods","clear","resetTransform","this","setTransform","clearRect","canvas","width","height","fullscreen","fullscreenElement","exitFullscreen","requestFullscreen","isClean","getImageData","err","size","w","h","objectFit","contextType","scale","camera","x","y","degrees","translate","rotate","chromaKey","tolerance","color","t","imageData","d","data","diff","i","l","length","abs","putImageData","arcArrow","r","startangle","endangle","anticlockwise","which","angle","sx","sy","lineangle","destx","desty","lineWidth","arc","stroke","strokeStyle","cos","sin","atan2","arrow","dist","sqrt","ratio","tox","toy","fromx","fromy","round","angle1","topx","topy","angle2","botx","boty","circle","deg","antiClockwise","closePath","curve","points","tension","numOfSeg","close","pts","res","cache","Float32Array","cachePtr","slice","unshift","push","st","st2","st3","st23","st32","parse","pt1","pt2","pt3","pt4","t1x","t1y","t2x","t2y","c","ellipse","kappa","ox","oy","xe","xm","ye","ym","bezierCurveTo","fillCircle","radius","fillEllipse","fillPolygon","dashPattern","polyshape","fillPolyshape","s","fillRing","innerRadius","outerRadius","ring","fillRoundedRect","roundedRect","fillStar","star","fillTriangle","gradientCircle","r2","offsetX","offsetY","fillSteps","fillGradient","createRadialGradient","addColorStop","fillStyle","gradientRect","horiz","createLinearGradient","fillRect","line","px","py","setLineDash","polygon","shift","forEach","point","position","sides","j","arcTo","spiral","rad","iter","rotation","stepSize","ang","midx","midy","square","rect","wobble","strokeCircle","strokeEllipse","strokeRing","strokeRoundedRect","strokePolygon","strokePolyshape","strokeStar","strokeTriangle","triangle","checkerboard","gridSize","colorA","colorB","tx","ty","[object Object]","strokeColor","drawGridBox","cacheImg","dx","dy","dWidth","dHeight","Image","onload","drawImage","crossOrigin","drawImg","outerHTML","src","includes","encodeURIComponent","setStyle","obj","angleFromPoints","angleToTarget","clamp","min","max","distance","pow","inverseLerp","start","end","lerp","seededRandom","str","imul","charCodeAt","seed","rand","random","decimal","floor","arr","rotateAt","toRad","toDeg","extraMethodNames","Object","keys","origCtx","curProp","chunks","n","supportedType","MediaRecorder","types","isTypeSupported","getVideoMimeType","context","image","saveAs","toBlob","toElement","cb","img","toDataURL","video","record","fps","mimeType","audioBitsPerSecond","videoBitsPerSecond","Error","isRecording","framesPerSecond","opts","stream","captureStream","rec","ondataavailable","e","onstop","videoBlob","Blob","type","onstart","onresume","onpause","stop","filename","setTimeout","load"],"mappings":"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"}