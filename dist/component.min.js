!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).Component=t()}(this,(function(){"use strict";const e=(e,t)=>{const n={cfg:{orig:e},replace(e,t=e){const n=document.createElement("template");n.innerHTML=t;const i=n.content.firstChild.nextElementSibling;i.nodeName===e.nodeName?this.iterate(e,i):e.parentElement.replaceChild(i,e)},iterate(t,n,i){(t||n)&&(this.checkAdditions(t,n,i),t&&n&&t.nodeName!==n.nodeName?this.checkNodeName(t,n):t&&n&&t.nodeName===n.nodeName&&(this.checkTextContent(t,n),3!==t.nodeType&&8!==e.nodeType&&this.checkAttributes(t,n))),t&&n&&(t.childNodes&&n.childNodes?this.cfg.lengthDifferentiator=[...e.childNodes,...n.childNodes]:this.cfg.lengthDifferentiator=null,Array.apply(null,this.cfg.lengthDifferentiator).forEach((e,i)=>{this.cfg.lengthDifferentiator&&this.iterate(t.childNodes[i],n.childNodes[i],t,n)}))},checkNodeName(e,t){const n=t.cloneNode(!0);e.parentElement.replaceChild(n,e)},checkAttributes(e,t){const n=e.attributes||[],i=Object.keys(n).map(e=>n[e]),o=t.attributes||[],s=Object.keys(o).map(e=>o[e]);i.forEach(n=>null!==t.getAttribute(n.name)?e.setAttribute(n.name,t.getAttribute(n.name)):e.removeAttribute(n.name)),s.forEach(n=>e.getAttribute(n.name)!==t.getAttribute(n.name)&&e.setAttribute(n.name,t.getAttribute(n.name)))},checkTextContent(e,t){e.nodeValue!==t.nodeValue&&(e.textContent=t.textContent)},checkAdditions(e,t,n=this.cfg.orig){if(t&&void 0===e){const e=t.cloneNode(!0);3!==n.nodeType&&8!==n.nodeType&&n.appendChild(e)}else e&&void 0===t&&e.parentElement.removeChild(e)}};Object.create(n).replace(e,t)};return function t(n,i){var o=function(e,t){return o.setState(e,t),e?o:o.container};o.state=n,o.schema=i;var s=t.storage,r=t.validator,a=t.emitter,c=t.tweenState,l=t.devtools;o.reactive=!0,o.debug=!!l,o.scopedCss=!0;var d=void 0;return o.isNode="undefined"!=typeof process&&null!==process&&null!==process.versions&&null!==process.versions.node,o.view=e=>e,o.middleware=[],o.uid=Math.random().toString(36).split(".")[1],o.isNode||(o.css=document.createElement("style"),o.css.id=o.uid,document.head.appendChild(o.css)),o.log=[{id:0,state:n,action:"init"}],o.i=o.log.length,o.actions=e=>(o.actionsList=e,Object.keys(e).forEach(t=>{if(void 0!==o[t])return!1;o[t]=n=>(o.action=t,e[t](n),o)}),o),this.freeze=e=>(Object.isFrozen(e)||(Object.keys(e).forEach(t=>this.freeze(e[t])),Object.freeze(e)),e),this.eq=(e,t)=>{const n=Object.keys,i=typeof e;return e&&t&&"object"===i&&i===typeof t?n(e).length===n(t).length&&n(e).every(n=>this.eq(e[n],t[n])):String(e)===String(t)},o.setState=e=>{if(s&&!o.loaded){const t=s.getItem(o,{...o.state,...e});t&&(e={...e,...t})}if(o.loaded=!0,r&&o.schema){var t=r({...o.state,...e},o.schema);if(t.length>0){var n="State doesn't match schema:";throw console.error(n,"\n",t,"\n"),new Error(n+"\n"+JSON.stringify(t)+"\n")}}if(o.prev=o.state,o.state={...o.state,...e},!this.eq(o.state,o.prev)){s&&o.loaded&&s.setItem(o,o.state),o.reactive&&o.render(o.container),i&&!o.isNode&&cancelAnimationFrame(i);var i=void 0;return o.debug&&!0!==o.tt&&(o.isNode&&!requestAnimationFrame&&(requestAnimationFrame=function(e){setTimeout(()=>e(),1)}),i=requestAnimationFrame(()=>{o.log.push({id:o.log.length,state:o.state,action:o.action||"setState"}),o.action=void 0,o.i=o.log.length-1})),this.freeze(o.state),void 0!==a&&o.action&&a.emit(""+o.action,o.state),o.middleware.forEach(e=>e({...o.state})),o}},o.tweenState=(e,t)=>(void 0!==c?c(o,e,t):o.setState(e),o),o.on=(e,t)=>(void 0!==a&&a.on(e,t),o),o.once=(e,t)=>(void 0!==a&&a.on(e,n=>{t(n),a.off(e,t)}),o),o.off=(e,t)=>(void 0!==a&&a.off(e,t),o),o.go=function(e,t){var n;return n="f"===t?o.i+e:o.i-e,o.log[n]&&(o.i=n,o.tt=!0,o.setState(o.log[n].state),o.tt=!1),o},o.rw=function(e){return e?o.go(e,"b"):(o.log[0]&&(o.tt=!0,o.setState(o.log[0].state),o.tt=!1),o.i=0,o)},o.ff=function(e){return e?o.go(e,"f"):(o.log[o.log.length-1]&&(o.tt=!0,o.setState(o.log[o.log.length-1].state),o.tt=!1),o.i=o.log.length-1,o)},o.setCss=function(){if(o&&!o.isNode&&o.css&&"function"==typeof o.style){var e=o.style(o.state);if(o.scopedCss){var t=o.container.id?o.container.id:o.container.className;t=t||o.uid;var n=o.container.id?"#":".",i=new RegExp(t+" ,\\s*\\.","gm"),s=new RegExp(t+" ,\\s*#","gm"),r=new RegExp(t+" ,\\s*([a-z\\.#])","gmi");e=e.replace(/}/g,"}\n").replace(/\;\s*\n/g,";").replace(/{\s*\n/g,"{ ").replace(/^\s+|\s+$/gm,"\n").replace(/(^[\.#\w][\w\-]*|\s*,[\.#\w][\w\-]*)/gm,n+t+" $1").replace(i,", "+n+t+" ").replace(s,", "+n+t+" #").replace(r,", "+n+t+" $1").replace(/\n/g,"").replace(/\s\s+/g," ")}var a=e.replace(/\n/g,"").replace(/\s\s+/g," ");o.css.innerHTML!==a&&(o.css.innerHTML=a)}},o.toString=function(){var e,t="",n=o.view(o.state);if(!o.loaded&&s){const e=s.getItem(o,o.state);o.setState(e),n="function"==typeof o.view?o.view(e):n}if("function"==typeof o.style&&(e=o.style(o.state).replace(/^ {4}/gm,"")),n.outerHTML)e&&(t=`<style>${e}\n</style>\n`),t+=(""+n.outerHTML).replace(/^ {4}/gm,"");else if("string"==typeof n)try{t=JSON.parse(n),t=JSON.stringify(t,null,2)}catch(i){e&&(t=`<style>${e}\n</style>\n`),t+=(""+n).replace(/^ {4}/gm,"")}else("object"==typeof n||Array.isArray(n))&&(t=JSON.stringify(n,null,2));return t},o.render=function(t){var n="function"==typeof o.view?o.view(o.state):null;if(o.isNode)return o.toString();if(!o.html&&s){const e=s.getItem(o,o.state);n="function"==typeof o.view?o.view(e):null,o.setState(e)}return document&&!o.html&&(t=document.querySelector(t)),o.html=o.container=t,d&&cancelAnimationFrame(d),d=requestAnimationFrame(()=>{if(o.css&&o.style&&o.setCss(),o.container&&n)try{e(o.container.firstElementChild,n.outerHTML?n.outerHTML:n)}catch(e){n.outerHTML?(o.container.innerHTML="",o.container.append(n)):o.container.innerHTML=n}l&&o.container&&(o.container.firstChild.setAttribute("data-uid",o.uid),l.populateUI(o.container))}),o.container},o.isNode||(window.sjComponents=window.sjComponents||{},window.sjComponents[o.uid]=o),o}}));
