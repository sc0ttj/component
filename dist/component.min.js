!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).Component=t()}(this,(function(){"use strict";var e=(e,t)=>{const n={cfg:{orig:e},replace(e,t=e){const n=document.createElement("template");n.innerHTML=t;const i=n.content.firstChild.nextElementSibling;i.nodeName===e.nodeName?this.iterate(e,i):e.parentElement.replaceChild(i,e)},iterate(t,n,i){(t||n)&&(this.checkAdditions(t,n,i),t&&n&&t.nodeName!==n.nodeName?this.checkNodeName(t,n):t&&n&&t.nodeName===n.nodeName&&(this.checkTextContent(t,n),3!==t.nodeType&&8!==e.nodeType&&this.checkAttributes(t,n))),t&&n&&(t.childNodes&&n.childNodes?this.cfg.lengthDifferentiator=[...e.childNodes,...n.childNodes]:this.cfg.lengthDifferentiator=null,Array.apply(null,this.cfg.lengthDifferentiator).forEach((e,i)=>{this.cfg.lengthDifferentiator&&this.iterate(t.childNodes[i],n.childNodes[i],t,n)}))},checkNodeName(e,t){const n=t.cloneNode(!0);e.parentElement.replaceChild(n,e)},checkAttributes(e,t){const n=e.attributes||[],i=Object.keys(n).map(e=>n[e]),r=t.attributes||[],o=Object.keys(r).map(e=>r[e]);i.forEach(n=>null!==t.getAttribute(n.name)?e.setAttribute(n.name,t.getAttribute(n.name)):e.removeAttribute(n.name)),o.forEach(n=>e.getAttribute(n.name)!==t.getAttribute(n.name)&&e.setAttribute(n.name,t.getAttribute(n.name)))},checkTextContent(e,t){e.nodeValue!==t.nodeValue&&(e.textContent=t.textContent)},checkAdditions(e,t,n=this.cfg.orig){if(t&&void 0===e){const e=t.cloneNode(!0);3!==n.nodeType&&8!==n.nodeType&&n.appendChild(e)}else e&&void 0===t&&e.parentElement.removeChild(e)}};Object.create(n).replace(e,t)};return function t(n,i){var r=function(e){return r.render(r.container),r.setState(e),e?r:r.container};r.state=n,r.schema=i,r.reactive=!0,r.debug=!1,r.scopedCss=!0;var o=void 0;return r.isNode="undefined"!=typeof process&&null!==process&&null!==process.versions&&null!==process.versions.node,r.view=e=>e,r.middleware=[],r.uid=Math.random().toString(36).split(".")[1],r.isNode||(r.css=document.createElement("style"),document.head.appendChild(r.css)),r.log=[{id:0,state:n,action:"init"}],r.actions=e=>(r.actionsList=e,Object.keys(e).forEach(t=>{if(void 0!==r[t])return!1;r[t]=n=>(r.action=t,e[t](n))}),r),this.freeze=e=>(Object.isFrozen(e)||(Object.keys(e).forEach(t=>this.freeze(e[t])),Object.freeze(e)),e),this.eq=(e,t)=>{const n=Object.keys,i=typeof e;return e&&t&&"object"===i&&i===typeof t?n(e).length===n(t).length&&n(e).every(n=>this.eq(e[n],t[n])):String(e)===String(t)},r.setState=e=>{if(t.validator&&r.schema){var n=t.validator({...r.state,...e},r.schema);if(n.length>0){var i="State doesn't match schema:";throw console.error(i,"\n",n,"\n"),new Error(i+"\n"+JSON.stringify(n)+"\n")}}if(r.prev=r.state,r.state={...r.state,...e},!this.eq(r.state,r.prev)){r.reactive&&r.render(r.container),o&&cancelAnimationFrame(o);var o=void 0;return o=requestAnimationFrame(()=>{r.debug&&this.i===r.log.length&&r.log.push({id:r.log.length,state:r.prev,action:r.action||"setState"}),this.i=r.log.length}),this.freeze(r.state),void 0!==t.emitter&&r.action&&t.emitter.emit(""+r.action,r.state),r.middleware.forEach(e=>e({...r.state})),r.action=void 0,r}},r.tweenState=(e,n)=>(void 0!==t.tweenState?t.tweenState(r,e,n):r.setState(e),r),r.on=(e,n)=>(void 0!==t.emitter&&t.emitter.on(e,n),r),r.once=(e,n)=>(void 0!==t.emitter&&t.emitter.on(e,i=>{n(i),t.emitter.off(e,n)}),r),r.off=(e,n)=>(void 0!==t.emitter&&t.emitter.off(e,n),r),r.go=function(e,t){var n;return n="f"===t?this.i+e:this.i-e,r.log[n]&&r.setState(r.log[n].state),this.i=n,this},r.rw=function(e){return e?(this.go(e,"b"),r):(r.log[0]&&r.setState(r.log[0].state),this.i=0,!0)},r.ff=function(e){return e?(r.go(e,"f"),r):(r.log[r.log.length-1]&&this.setState(r.log[r.log.length-1].state),this.i=r.log.length-1,!0)},r.setCss=function(){if(!r.isNode&&r.css&&"function"==typeof r.style){var e=r.style(r.state);if(r.scopedCss){var t=r.container.id?r.container.id:r.container.className;t=t||r.uid;var n=r.container.id?"#":".",i=new RegExp(t+" ,\\s*\\.","gm"),o=new RegExp(t+" ,\\s*#","gm"),s=new RegExp(t+" ,\\s*([a-z\\.#])","gmi");e=e.replace(/}/g,"}\n").replace(/\;\s*\n/g,";").replace(/{\s*\n/g,"{ ").replace(/^\s+|\s+$/gm,"\n").replace(/(^[\.#\w][\w\-]*|\s*,[\.#\w][\w\-]*)/gm,n+t+" $1").replace(i,", "+n+t+" ").replace(o,", "+n+t+" #").replace(s,", "+n+t+" $1").replace(/\n/g,"").replace(/\s\s+/g," ")}var a=e.replace(/\n/g,"").replace(/\s\s+/g," ");r.css.innerHTML!==a&&(r.css.innerHTML=a)}},r.toString=function(){var e,t="",n=r.view(r.state);if("function"==typeof r.style&&(e=r.style(r.state).replace(/^ {4}/gm,"")),n.outerHTML)e&&(t=`<style>${e}\n</style>\n`),t+=(""+n.outerHTML).replace(/^ {4}/gm,"");else if("string"==typeof n)try{t=JSON.parse(n),t=JSON.stringify(t,null,2)}catch(i){e&&(t=`<style>${e}\n</style>\n`),t+=(""+n).replace(/^ {4}/gm,"")}else("object"==typeof n||Array.isArray(n))&&(t=JSON.stringify(n,null,2));return t},r.render=function(t){var n="function"==typeof r.view?r.view(r.state):null;return n.outerHTML&&(n=n.outerHTML),r.isNode?r.toString():(r.container=t,o&&cancelAnimationFrame(o),o=requestAnimationFrame(()=>{if("string"==typeof t&&(t=document.querySelector(""+t)),r.container=t,r.html=t,r.css&&r.style&&r.setCss(),r.container&&n)try{e(r.container.firstChild,n)}catch(e){r.container.innerHTML=n}}),r.container)},r}}));
