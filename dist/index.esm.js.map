{"version":3,"file":"index.esm.js","sources":["../src/component.js","../src/render.js","../src/raf.js","../src/easings.js","../src/tweenState.js","../src/emitter.js","../src/html.js","../src/htmel.js","../src/ctx.js","../src/storage.js","../src/syncTabs.js","../src/useAudio.js","../src/onScroll.js","../src/onLoop.js","../src/hooks.js"],"sourcesContent":["// Begin example implementation\n\n// Note:   This is just a demo/experiment\n// Goals:  Super easy to setup, small code base, automatic re-renders on state update\n;(\"use strict\")\n\n// t = target\n// s = source\nconst domDiff = (t, s) => { // from https://codepen.io/tevko/pen/LzXjKE?editors=0010\n  const d = document; // TODO: support shadow DOM - check the root, set accordingly\n  const job = {\n    cfg: {\n      orig: t\n    },\n    // t = target\n    // s = source\n    replace(t, s = t) {\n      const v = d.createElement(\"template\")\n      v.innerHTML = s\n      const vHTML = v.content.firstChild.nextElementSibling\n      if (vHTML.nodeName !== t.nodeName) {\n        t.parentElement.replaceChild(vHTML, t)\n        return\n      }\n      this.loop(t, vHTML)\n    },\n    // tn = target Node\n    // sn = source Node\n    loop(tn, sn, tOrig) {\n      if (tn || sn) {\n        this.checkNew(tn, sn, tOrig)\n        if (\n          tn &&\n          sn &&\n          tn.nodeName !== sn.nodeName\n        ) {\n          this.checkNodeName(tn, sn)\n        } else if (\n          tn &&\n          sn &&\n          tn.nodeName === sn.nodeName\n        ) {\n          this.checkCtx(tn, sn)\n          tn.nodeType !== 3 &&\n            t.nodeType !== 8 &&\n            this.checkAttrs(tn, sn)\n        }\n      }\n      if (tn && sn) {\n        if (tn.childNodes && sn.childNodes) {\n          this.cfg.lengthDiff = [\n            ...t.childNodes,\n            ...sn.childNodes\n          ]\n        } else {\n          this.cfg.lengthDiff = null\n        }\n        Array.apply(null, this.cfg.lengthDiff).forEach(\n          (node, idx) => {\n            this.cfg.lengthDiff &&\n              this.loop(\n                tn.childNodes[idx],\n                sn.childNodes[idx],\n                tn,\n                sn\n              )\n          }\n        )\n      }\n    },\n    checkNodeName(tn, sn) {\n      const n = sn.cloneNode(true)\n      tn.parentElement.replaceChild(n, tn)\n    },\n    checkAttrs(tn, sn) {\n      const attrs = tn.attributes || []\n      const filteredAttrs = Object.keys(attrs).map(n => attrs[n])\n      const attrsNew = sn.attributes || []\n      const filteredAttrsNew = Object.keys(attrsNew).map(\n        n => attrsNew[n]\n      )\n      filteredAttrs.forEach(o => {\n        return sn.getAttribute(o.name) !== null\n          ? tn.setAttribute(o.name, sn.getAttribute(o.name))\n          : tn.removeAttribute(o.name)\n      })\n      filteredAttrsNew.forEach(a => {\n        return (\n          tn.getAttribute(a.name) !== sn.getAttribute(a.name) &&\n          tn.setAttribute(a.name, sn.getAttribute(a.name))\n        )\n      })\n    },\n    checkCtx(tn, sn) {\n      if (tn.nodeValue !== sn.nodeValue) {\n        tn.textContent = sn.textContent\n      }\n    },\n    checkNew(tn, sn, tParent = this.cfg.orig) {\n      if (sn && tn === undefined) {\n        const newNode = sn.cloneNode(true)\n        tParent.nodeType !== 3 &&\n          tParent.nodeType !== 8 &&\n          tParent.appendChild(newNode)\n      } else if (tn && sn === undefined) {\n        tn.parentElement.removeChild(tn)\n      }\n    }\n  }\n  // t = target\n  // s = source\n  Object.create(job).replace(t, s)\n}\n\n\n/**\n * A stateful component creator\n * @constructor\n * @param {object} state - The component state (model).\n */\nfunction Component(state, schema) {\n  const c = function c(state, schema) {\n    c.setState(state, schema)\n    return !state ? c.container : c\n  }\n\n  const C = Component\n  // register the add-ons\n  const validator = C.validator\n  const emitter = C.emitter\n  const tweenState = C.tweenState\n  const springTo = C.springTo\n  const strg = C.storage\n  const useAudio = C.useAudio\n  const onScroll = C.onScroll\n  const onLoop = C.onLoop\n  const Ctx = C.Ctx\n  const devtools = C.devtools\n  const cache = C.memo ? C.memo : function(f){return f;}\n  // used by storage add-on.. maybe try to remove at some point\n  const self = c\n  // re-used a lot..\n  const O = Object\n  const R = RegExp\n\n  // for debouncing render() calls, and window, document\n  let timeout, w, d, raf, t\n\n  c.reactive = true                   // if true, re-render on every state change\n  c.immutable = true                  // if true, freeze the state object after updating it\n  c.debug = devtools ? true : false   //  if true, maintain a history of state changes in `.log`\n  c.scopedCss = true                  // auto prefix component css with a unique id\n  c.state = state                     // component state\n  c.schema = schema                   // component schema (optional)\n\n  // on init, add our initial state to the state history\n  c.log = [{ id: 0, state: state, action: \"init\" }]\n  c.i = c.log.length\n\n  c.view = props => props // the default view (just return the props)\n\n  c.middleware = []\n\n  // a unique ID, used for scoping component CSS and by devtools to register them\n  c.uid = Math.random()\n    .toString(36)\n    .split(\".\")[1]\n\n  c.isNode =\n    typeof process !== \"undefined\" &&\n    process !== null &&\n    process.versions !== null &&\n    process.versions.node !== null\n\n  if (!c.isNode) {\n    w = window\n    d = document  // TODO: support shadow DOM - check the root, set accordingly\n    raf = requestAnimationFrame\n    // the <style> elem into which we put our component CSS\n    // TODO: only do this if component styles are defined\n    c.css = d.createElement(\"style\")\n    c.css.id = c.uid\n    d.head.appendChild(c.css)\n  }\n\n  /**\n   * Define chainable named \"actions\" that will update our\n   * state in specific ways and register in our state history\n   */\n  c.actions = actions => {\n    c.actionsList = actions\n    // convert each key/value to set state function:\n    O.keys(actions).forEach(axn => {\n      if (typeof c[axn] !== \"undefined\") return false\n      // add the action as a function\n      c[axn] = newState => {\n        // set current action\n        c.action = axn\n        // run action\n        actions[axn](newState)\n        // make sure the component returns itself, so it's always chainable\n        return c\n      }\n    })\n    return c\n  }\n\n  /**\n   * Used to freeze the component state\n   * @param {object} o - the object to freeze\n   */\n  c.freeze = cache(o => {\n    if (!O.isFrozen(o)) {\n      // Recursively call until all child objects are frozen\n      O.keys(o).forEach(k => c.freeze(o[k]))\n      O.freeze(o)\n    }\n    return o\n  })\n\n  /**\n   * Used to compare the current and next component state\n   * @param {object} x - the object to compare with y\n   * @param {object} y - the object to compare with x\n   */\n  c.eq = cache((x, y) => {\n    const ok = O.keys,\n      tx = typeof x,\n      ty = typeof y\n    return x && y && tx === \"object\" && tx === ty\n      ? ok(x).length === ok(y).length &&\n          ok(x).every(key => c.eq(x[key], y[key]))\n      : String(x) === String(y)\n  })\n\n  /**\n   * Set the component state\n   * @param {object} newState - the new state to update to\n   */\n  c.setState = newState => {\n    const nextState = { ...c.state, ...newState };\n    // get initial state from localStorage, if it's in there\n    if (strg && !c.done) {\n      const pState = strg.getItem(c, nextState);\n      if (pState) newState = { ...newState, ...pState };\n    }\n    c.done = true;\n\n    // enable schema validation using @scottjarvis/validator\n    if (validator && c.schema) {\n      const err = cache(validator(nextState, c.schema))\n      const msg = \"State doesn't match schema:\"\n      if (err.length > 0) {\n        console.error(msg, \"\\n\", err, \"\\n\")\n        throw new Error(msg + \"\\n\" + JSON.stringify(err) + \"\\n\")\n      }\n    }\n    // ...the new state is valid, lets continue\n\n    // update previous and current state\n    c.prev = c.state\n    c.state = { ...c.state, ...nextState }\n\n    if (!c.eq(c.state, c.prev)) {\n\n      if (strg && c.done) {\n        // c.store is just the name of the key in localStorage,\n        // where we keep our JSON stringified state\n        strg.setItem(c, c.state)\n      }\n\n      // re-render component\n      if (c.reactive) c.render(c.container, c.ctx)\n\n      if (t && !c.isNode) cancelAnimationFrame(t)\n\n      // c.tt = component is \"time travelling\" (traversing state history)\n      if (c.debug && c.tt !== true) {\n        // if node, just use setTimeout\n        if (c.isNode) raf = (logFn) => setTimeout(() => logFn(), 1)\n        t = raf(() => {\n          // we are not traversing state history, so add the new state to the log\n          c.log.push({\n            id: c.log.length,\n            state: c.state,\n            action: c.action || \"setState\"\n          })\n          // move along index\n          c.i = c.log.length -1\n        })\n      }\n\n      // log state changes if debug = true\n      //if (c.debug) console.log(c.i, [c.state, ...c.log])\n\n      // freeze state so it can only be changed through setState()\n      if (c.immutable) c.freeze(c.state)\n\n      // if we updated using an \"action\" method, and emitter is avail,\n      // then emit an event with same name as the \"action\" called,\n      // passing in the current state\n      if (typeof emitter !== \"undefined\" && !!c.action) {\n        emitter.emit(`${c.action}`, { ...c.state })\n      }\n\n      // run any middlware functions that were defined by the user\n      c.middleware.forEach(fn => fn({ ...c.state }))\n\n      c.action = undefined\n\n      return c\n    }\n  }\n\n  /**\n   * Tween from the current state to the given state, then set the given\n   * state as the new state.\n   *\n   * @param {object} cfg - the settings used for the tweening\n   *\n   */\n  c.tweenState = (props, cfg) => {\n    typeof tweenState !== \"undefined\"\n      ? tweenState(c, props, cfg)\n      : c(props)\n    return c\n  }\n\n  /**\n   * Animate from the current state to the given state, then set the given\n   * state as the new state. Uses spring-based physics.\n   *\n   * @param {object} cfg - the settings used for the spring\n   *\n   */\n  c.springTo = (props, cfg) => {\n    typeof springTo !== \"undefined\"\n      ? springTo(c, props, cfg)\n      : c(props)\n    return c\n  }\n\n  /**\n   * Audio for components\n   *\n   * @param {object} audio library - the audio files and their settings\n   *\n   */\n  c.useAudio = (props) => {\n    if (typeof useAudio !== \"undefined\") {\n      useAudio(props, c)\n    } else {\n      c(props)\n    }\n    return c\n  }\n\n  /**\n   * Scroll-based animations for components\n   *\n   * @param {object}\n   *\n   */\n  c.onScroll = fn => {\n    if (onScroll) {\n      onScroll(fn, c);\n    }\n    return c\n  }\n\n  /**\n   * Game loop (fixed interval loop, variable interval rendering)\n   *\n   * @param {object}\n   *\n   */\n  if (onLoop) {\n    c.onLoop = (fn, o) => {\n      // create a controllable loop, if needed\n      c.loop = c.loop ? c.loop : new onLoop(o, fn, c)\n      // attach the methods to control the loop\n      c.start = () => c.loop.start();\n      c.stop = () => c.loop.stop();\n      c.pause = () => c.loop.pause();\n      c.resume = () => c.loop.resume();\n    }\n  }\n\n  c.on = (ev, fn) => {\n    typeof emitter !== \"undefined\"\n      ? emitter.on(ev, fn)\n      : false\n    return c\n  }\n\n  c.once = (ev, fn) => {\n    if (typeof emitter !== \"undefined\") {\n      emitter.on(ev, props => {\n        fn(props)\n        emitter.off(ev, fn)\n      })\n    }\n    return c\n  }\n\n  c.off = (ev, fn) => {\n    typeof emitter !== \"undefined\"\n      ? emitter.off(ev, fn)\n      : false\n    return c\n  }\n\n  /**\n   * Travel forward/backward to different states in the state history\n   * @param {number} num - the number of steps through the history to take\n   * @param {string} direction - 'f' for forward, 'b' for backwards\n   */\n  c.go = function(num, dir) {\n    let i\n    if (dir === \"f\") {\n      i = c.i + num\n    } else {\n      i = c.i - num\n    }\n    if (c.log[i]) {\n      c.i = i\n      c.tt = true;\n      c(c.log[i].state) // set state\n      c.tt = false;\n    }\n    return c\n  }\n\n  /**\n   * Go to previous (or first) state in the state history\n   * @param {number} num - the number of steps through the history to take, 0 if 'num' not given\n   */\n  c.rw = function(num) {\n    if (!num) {\n      if (c.log[0]) {\n        c.tt = true;\n        c(c.log[0].state) // set state\n        c.tt = false;\n      }\n      c.i = 0\n      return c\n    }\n    return c.go(num, \"b\")\n  }\n\n  /**\n   * Go to more recent state in the state history\n   * @param {number} num - the number of steps through the history to take, most recent if 'num' not given\n   */\n  c.ff = function(num) {\n    if (!num) {\n      if (c.log[c.log.length - 1]) {\n        c.tt = true;\n        c(c.log[c.log.length - 1].state) // set state\n        c.tt = false;\n      }\n      c.i = c.log.length -1\n      return c\n    }\n    return c.go(num, \"f\")\n  }\n\n  /**\n   * If in browser, puts scoped component styles in c.css\n   */\n  c.setCss = function() {\n    // if in browser\n    if (c && !c.isNode) {\n      // if a style is defined\n      if (c.css && typeof c.style === \"function\") {\n        // get the latest component style\n        let st = c.style(c.state) // the css\n\n        // auto-prefix CSS styles with a unique id,to \"scope\" the\n        // styles to the component only\n        if (c.scopedCss) {\n          const p = c.container.id ? \"#\" : \".\"\n          // get container id, or class if no id\n          let u = c.container.id ? c.container.id : c.container.className\n          // if container has no class or id, use uid\n          u = !!u ? u : c.uid\n\n          // ..these 3 are used for scoping CSS, in setCss()\n          const fx1 = new R(u + \" ,\\\\s*\\\\.\", \"gm\")\n          const fx2 = new R(u + \" ,\\\\s*#\", \"gm\")\n          const fx3 = new R(u + \" ,\\\\s*([a-z\\\\.#])\", \"gmi\")\n          // func to scope css\n          const fx = (v,p,u) =>\n            v.replace(/}/g, \"}\\n\")\n             .replace(/\\;\\s*\\n/g, \";\")\n             .replace(/{\\s*\\n/g, \"{ \")\n             .replace(/^\\s+|\\s+$/gm, \"\\n\")\n             .replace(/(^[\\.#\\w][\\w\\-]*|\\s*,[\\.#\\w][\\w\\-]*)/gm, p + u + \" $1\")\n             .replace(fx1, \", \" + p + u + \" \")\n             .replace(fx2, \", \" + p + u + \" #\")\n             .replace(fx3, \", \" + p + u + \" $1\")\n             .replace(/\\n/g, \"\")\n             .replace(/\\s\\s+/g, \" \")\n           // scope the css\n           st = cache(fx(st,p,u))\n        }\n\n        // minify the CSS\n        const minCss = st.replace(/\\n/g, \"\").replace(/\\s\\s+/g, \" \")\n        // if the new CSS is changed from previous, re-render it\n        if (c.css.innerHTML !== minCss) c.css.innerHTML = minCss\n      }\n    }\n  }\n\n  // used by .toString()\n  const toStr = (view, style) => {\n    let s = '';\n    if (view.outerHTML) {\n      if (style) s = `<style>${style}\\n</style>\\n`\n      s += `${view.outerHTML}`.replace(/^ {4}/gm, \"\")\n    } else if (typeof view === \"string\") {\n      try {\n        // if view is a JSON string\n        s = JSON.parse(view)\n        // return the view as prettified JSON\n        s = JSON.stringify(s, null, 2)\n      } catch (err) {\n        if (style) s = `<style>${style}\\n</style>\\n`\n        s += `${view}`.replace(/^ {4}/gm, \"\")\n      }\n    } else if (typeof view === \"object\" || Array.isArray(view)) {\n      // return the view as prettified JSON\n      s = JSON.stringify(view, null, 2)\n    }\n    //if (c.debug) console.log(s)\n    return s\n  }\n\n  /*\n  * Render the current view as a string, including\n  * our component styling, in a <style> tag\n  */\n  c.toString = function() {\n    let view = c.view(c.state, c.ctx)\n    let str = ''\n    let style = ''\n\n    // get local state\n    if (!c.done && strg) {\n      const pState = strg.getItem(c, c.state);\n      c(pState);\n      view = typeof c.view === \"function\" ? c.view(pState, c.ctx) : view\n    }\n\n    // get component styles, nicely indented\n    if (typeof c.style === \"function\") {\n      style = c.style(c.state).replace(/^ {4}/gm, \"\")\n    }\n\n    return cache(toStr(view,style))\n  }\n\n  /**\n   * Re-render the component and add it to the page\n   * @param {string|element} container - the element which holds the component\n   */\n  c.render = function(el, ctxType) {\n    if (c.isNode) return c.toString()\n\n    let view;\n\n    // get state from localStorage, if it's in there\n    if (!c.html && strg) {\n      const pState = strg.getItem(c, c.state);\n      view = typeof c.view === \"function\" ? c.view(pState, c.ctx) : null\n      c(pState); // set state\n    }\n\n    // make sure we have container as an HTML Element\n    if (d && !c.html) {\n      // TODO: support shadow DOM - check the root , set `d` accordingly\n      el = d.querySelector(el)\n    }\n    c.html = c.container = el\n\n    // get the canvas context, if needed\n    if (c.html && c.html.getContext && !c.ctx) {\n      c.ctx = c.html.getContext(ctxType ? ctxType : '2d')\n      // extend canvas if Ctx addon available (adds methods, makes all methods chainable)\n      if (c.ctx && Ctx) {\n        c.ctx = new Ctx(c.ctx, c);\n      }\n    }\n\n    if (timeout) cancelAnimationFrame(timeout)\n\n    timeout = raf(() => {\n      if (c.css && c.style) c.setCss()\n\n      // if we a container, lets (re)render the view (if any) to the page\n      if (c.html) {\n        view = typeof c.view === \"function\" ? c.view(c.state, c.ctx) : null\n        // if container exists, is *not* a canvas\n        if (!c.ctx) {\n          // get the view\n          // try to update view:\n          // try DOM diffing, else append to empty innerHTML, else replace innerHTML\n          try {\n            domDiff(c.html.firstElementChild, view.outerHTML ? view.outerHTML : view)\n            //console.log('diffed')\n          } catch (err) {\n            if (view && view.outerHTML) {\n              c.html.innerHTML = ''\n              c.html.append(view)\n              //console.log('cleared & appended')\n            } else {\n              c.html.innerHTML = view\n              //console.log('replaced innerHTML')\n            }\n          }\n        } else {\n          // else if container exists and *is* a canvas\n          c.view(c.state, c.ctx)\n        }\n      }\n      // for devtools\n      if (devtools && c.html) {\n        c.html.firstChild.setAttribute('data-uid', c.uid)\n        devtools.populateUI(c.html)\n      }\n    })\n\n    // return the container element\n    return c.html\n  }\n\n  // for devtools\n  if (!c.isNode) {\n    w.sjComponents = w.sjComponents || {};\n    w.sjComponents[c.uid] = c;\n  }\n\n  return c\n}\n\nexport default Component\n",";(\"use strict\")\n\n// t = target\n// s = source\nconst domDiff = (t, s) => { // from https://codepen.io/tevko/pen/LzXjKE?editors=0010\n  const job = {\n    cfg: {\n      orig: t\n    },\n    // t = target\n    // s = source\n    replace(t, s = t) {\n      const v = document.createElement(\"template\")\n      v.innerHTML = s\n      const vHTML = v.content.firstElementChild\n      if (vHTML.nodeName !== t.nodeName) {\n        t.parentElement.replaceChild(vHTML, t)\n        return\n      }\n      this.loop(t, vHTML)\n    },\n    // tn = target Node\n    // sn = source Node\n    loop(tn, sn, tOrig) {\n      if (tn || sn) {\n        this.checkNew(tn, sn, tOrig)\n        if (\n          tn &&\n          sn &&\n          tn.nodeName !== sn.nodeName\n        ) {\n          this.checkNodeName(tn, sn)\n        } else if (\n          tn &&\n          sn &&\n          tn.nodeName === sn.nodeName\n        ) {\n          this.checkCtx(tn, sn)\n          tn.nodeType !== 3 &&\n            t.nodeType !== 8 &&\n            this.checkAttrs(tn, sn)\n        }\n      }\n      if (tn && sn) {\n        if (tn.childNodes && sn.childNodes) {\n          this.cfg.lengthDiff = [\n            ...t.childNodes,\n            ...sn.childNodes\n          ]\n        } else {\n          this.cfg.lengthDiff = null\n        }\n        Array.apply(null, this.cfg.lengthDiff).forEach(\n          (node, idx) => {\n            this.cfg.lengthDiff &&\n              this.loop(\n                tn.childNodes[idx],\n                sn.childNodes[idx],\n                tn,\n                sn\n              )\n          }\n        )\n      }\n    },\n    checkNodeName(tn, sn) {\n      const n = sn.cloneNode(true)\n      tn.parentElement.replaceChild(n, tn)\n    },\n    checkAttrs(tn, sn) {\n      const attrs = tn.attributes || []\n      const filteredAttrs = Object.keys(attrs).map(n => attrs[n])\n      const attrsNew = sn.attributes || []\n      const filteredAttrsNew = Object.keys(attrsNew).map(\n        n => attrsNew[n]\n      )\n      filteredAttrs.forEach(o => {\n        return sn.getAttribute(o.name) !== null\n          ? tn.setAttribute(o.name, sn.getAttribute(o.name))\n          : tn.removeAttribute(o.name)\n      })\n      filteredAttrsNew.forEach(a => {\n        return (\n          tn.getAttribute(a.name) !== sn.getAttribute(a.name) &&\n          tn.setAttribute(a.name, sn.getAttribute(a.name))\n        )\n      })\n    },\n    checkCtx(tn, sn) {\n      if (tn.nodeValue !== sn.nodeValue) {\n        tn.textContent = sn.textContent\n      }\n    },\n    checkNew(tn, sn, tParent = this.cfg.orig) {\n      if (sn && tn === undefined) {\n        const newNode = sn.cloneNode(true)\n        tParent.nodeType !== 3 &&\n          tParent.nodeType !== 8 &&\n          tParent.appendChild(newNode)\n      } else if (tn && sn === undefined) {\n        tn.parentElement.removeChild(tn)\n      }\n    }\n  }\n  // t = target\n  // s = source\n  Object.create(job).replace(t, s)\n}\n\nlet timeout;\n\nconst render = (view, sel) => {\n  if (!window) return v\n\n  const v = typeof view === 'function' ? view() : view\n  const c = document.querySelector(sel)\n\n  if (timeout) cancelAnimationFrame(timeout)\n\n  timeout = requestAnimationFrame(() => {\n    if (c && c.nodeName && v) {\n      domDiff(\n        c,\n        v.outerHTML ? v.outerHTML : `<${c.nodeName} ${c.id ? `id=\"${c.id}\"` : ''} ${c.className ? `class=\"${c.className}\"` : ''}>${v}</${c.nodeName}>`\n      )\n      //console.log('diffed DOM')\n    }\n  });\n\n  return c\n}\n\nexport default render;\n","var performance =\n  typeof process !== \"undefined\" && typeof require !== \"undefined\"\n    ? require(\"perf_hooks\").performance\n    : window.performance\n\nvar now = performance.now,\n  root = typeof window === \"undefined\" ? global : window,\n  vendors = [\"moz\", \"webkit\"],\n  suffix = \"AnimationFrame\",\n  raf = root[\"request\" + suffix],\n  caf = root[\"cancel\" + suffix] || root[\"cancelRequest\" + suffix]\n\nfor (var i = 0; !raf && i < vendors.length; i++) {\n  raf = root[vendors[i] + \"Request\" + suffix]\n  caf =\n    root[vendors[i] + \"Cancel\" + suffix] ||\n    root[vendors[i] + \"CancelRequest\" + suffix]\n}\n\n// Some versions of FF have rAF but not cAF\nif (!raf || !caf) {\n  var last = 0,\n    id = 0,\n    queue = [],\n    frameDuration = 1000 / 60\n\n  raf = function(callback) {\n    if (queue.length === 0) {\n      var _now = now(),\n        next = Math.max(0, frameDuration - (_now - last))\n      last = next + _now\n      setTimeout(function() {\n        var cp = queue.slice(0)\n        // Clear queue here to prevent\n        // callbacks from appending listeners\n        // to the current frame's queue\n        queue.length = 0\n        for (var i = 0; i < cp.length; i++) {\n          if (!cp[i].cancelled) {\n            try {\n              cp[i].callback(last)\n            } catch (e) {\n              setTimeout(function() {\n                throw e\n              }, 0)\n            }\n          }\n        }\n      }, Math.round(next))\n    }\n    queue.push({\n      handle: ++id,\n      callback: callback,\n      cancelled: false\n    })\n    return id\n  }\n\n  caf = function(handle) {\n    for (var i = 0; i < queue.length; i++) {\n      if (queue[i].handle === handle) {\n        queue[i].cancelled = true\n      }\n    }\n  }\n}\n\nif (typeof module !== \"undefined\") {\n  module.exports.raf = function(fn) {\n    // Wrap in a new function to prevent\n    // `cancel` potentially being assigned\n    // to the native rAF function\n    return raf.call(root, fn)\n  }\n  module.exports.cancel = function() {\n    caf.apply(root, arguments)\n  }\n  module.exports.polyfill = function(object) {\n    if (!object) {\n      object = root\n    }\n    object.requestAnimationFrame = raf\n    object.cancelAnimationFrame = caf\n  }\n}\n\nexport default function(fn) {\n  // Wrap in a new function to prevent\n  // `cancel` potentially being assigned\n  // to the native rAF function\n  return raf.call(root, fn)\n}\n","const easing = {\n  // no easing, no acceleration\n  linear: t => t,\n  // accelerating from zero velocity\n  inQuad: t => t * t,\n  // decelerating to zero velocity\n  outQuad: t => t * (2 - t),\n  // acceleration until halfway, then deceleration\n  inOutQuad: t => (t < 0.5 ? 2 * t * t : -1 + (4 - 2 * t) * t),\n  // accelerating from zero velocity\n  inCubic: t => t * t * t,\n  // decelerating to zero velocity\n  outCubic: t => --t * t * t + 1,\n  // acceleration until halfway, then deceleration\n  inOutCubic: t =>\n    t < 0.5 ? 4 * t * t * t : (t - 1) * (2 * t - 2) * (2 * t - 2) + 1,\n  // accelerating from zero velocity\n  inQuart: t => t * t * t * t,\n  // decelerating to zero velocity\n  outQuart: t => 1 - --t * t * t * t,\n  // acceleration until halfway, then deceleration\n  inOutQuart: t => (t < 0.5 ? 8 * t * t * t * t : 1 - 8 * --t * t * t * t),\n  // accelerating from zero velocity\n  inQuint: t => t * t * t * t * t,\n  // decelerating to zero velocity\n  outQuint: t => 1 + --t * t * t * t * t,\n  // acceleration until halfway, then deceleration\n  inOutQuint: t =>\n    t < 0.5 ? 16 * t * t * t * t * t : 1 + 16 * --t * t * t * t * t,\n  // elastic bounce effect at the beginning\n  inElastic: t => (0.04 - 0.04 / t) * Math.sin(25 * t) + 1,\n  // elastic bounce effect at the end\n  outElastic: t => ((0.04 * t) / --t) * Math.sin(25 * t),\n  // elastic bounce effect at the beginning and end\n  inOutElastic: t =>\n    (t -= 0.5) < 0\n      ? (0.02 + 0.01 / t) * Math.sin(50 * t)\n      : (0.02 - 0.01 / t) * Math.sin(50 * t) + 1,\n  // slight acceleration from zero to full speed\n  inSin: t => 1 + Math.sin((Math.PI / 2) * t - Math.PI / 2),\n  // slight deceleration at the end\n  outSin: t => Math.sin((Math.PI / 2) * t),\n  // slight acceleration at beginning and slight deceleration at end\n  inOutSin: t => (1 + Math.sin(Math.PI * t - Math.PI / 2)) / 2,\n  // Accelerate exponentially until finish\n  inExpo: t => {\n    if (t === 0) return 0\n    return Math.pow(2, 10 * (t - 1))\n  },\n  //\n  // Initial exponential acceleration slowing to stop\n  outExpo: function(t) {\n    if (t === 1) return 1\n    return -Math.pow(2, -10 * t) + 1\n  },\n  // Exponential acceleration and deceleration\n  inOutExpo: function(t) {\n    if (t === 0 || t === 1) return t\n    var scaledTime = t * 2\n    var scaledTime1 = scaledTime - 1\n    if (scaledTime < 1) return 0.5 * Math.pow(2, 10 * scaledTime1)\n    return 0.5 * (-Math.pow(2, -10 * scaledTime1) + 2)\n  },\n  // Slow movement backwards then fast snap to finish\n  inBack: function(t, magnitude) {\n    var m = typeof magnitude !== \"undefined\" ? magnitude : 1.70158\n    return t * t * ((m + 1) * t - m)\n  },\n  // Fast snap to backwards point then slow resolve to finish\n  outBack: function(t, magnitude) {\n    var m = typeof magnitude !== \"undefined\" ? magnitude : 1.70158\n    var scaledTime = t / 1 - 1\n    return scaledTime * scaledTime * ((m + 1) * scaledTime + m) + 1\n  },\n  // Slow movement backwards, fast snap to past finish, slow resolve to finish\n  inOutBack: function(t, magnitude = 1.70158) {\n    var scaledTime = t * 2\n    var scaledTime2 = scaledTime - 2\n    var s = magnitude * 1.525\n    if (scaledTime < 1)\n      return 0.5 * scaledTime * scaledTime * ((s + 1) * scaledTime - s)\n    return 0.5 * (scaledTime2 * scaledTime2 * ((s + 1) * scaledTime2 + s) + 2)\n  }\n}\n\nexport default easing\n","import raf from './raf.js'\nimport easing from \"./easings.js\"\n;(\"use strict\")\n\n\n// if no window.performance, use 'perf_hooks' module\n// (from https://stackoverflow.com/questions/23003252/window-performance-now-equivalent-in-nodejs)\nvar performance =\n  typeof process !== \"undefined\" && typeof require !== \"undefined\"\n    ? require(\"perf_hooks\").performance\n    : window.performance\n\n// if no requestAnimationFrame, use the 'raf' polyfill\nvar requestAnimationFrame =\n  typeof window !== \"undefined\" &&\n  typeof window.requestAnimationFrame !== \"undefined\"\n    ? window.requestAnimationFrame\n    : raf\n\n//\n//\n// ES5-loose (transpiled) version of\n// https://github.com/jeremenichelli/phena/blob/master/src/index.js\n//\n\nvar noop = function noop() {}\n\nvar now = function now() {\n  return performance && performance.now ? performance.now() : Date.now()\n}\n\nvar step = function step(context) {\n  var delay = context.delay,\n    from = context.from,\n    to = context.to,\n    duration = context.duration,\n    startTime = context.startTime,\n    easeFn = context.ease,\n    onUpdate = context.onUpdate,\n    onComplete = context.onComplete\n\n  var currentTime = now()\n  var elapsed = currentTime - startTime\n\n  if (delay >= elapsed) {\n    context.frame =\n      requestAnimationFrame(function() {\n        return step(context)\n      }) + 1\n    return\n  }\n\n  // calculate progress according to time and and easing\n  var progress = Math.min(1, (elapsed - delay) / duration)\n\n  // add progress to tween props\n  context.progress = progress\n\n  var values = from.length\n    ? from.map(function(val, index) {\n        var value = val + (to[index] - val) * easeFn(progress)\n        if (Number.isNaN(value)) {\n          value = val + (to[index] - val) * progress\n        }\n        return value\n      })\n    : (() => {\n        var value = from + (to - from) * easeFn(progress)\n        if (Number.isNaN(value)) {\n          value = from + (to - from) * progress\n        }\n        return value\n      })()\n\n  // EDIT by @sc0ttj - pass in the whole context, with values\n  onUpdate({ ...context, values }) // call complete callback or invoke new frame\n\n  // EDIT by @sc0ttj - pass in the whole context, with values\n  if (progress === 1) onComplete({ ...context, values })\n  else\n    context.frame =\n      requestAnimationFrame(function() {\n        return step(context)\n      }) + 1\n}\n\nvar Tween = /*#__PURE__*/ (function() {\n  function Tween(context) {\n    this._c = context\n    this._c.ease = easing[context.ease] || easing[ease]\n    this._c.onUpdate = context.onUpdate || noop\n    this._c.onComplete = context.onComplete || noop\n    this._c.delay = context.delay || 0\n    this._c.duration = context.duration || 200\n    if (!context.paused) this.start()\n  }\n\n  var _proto = Tween.prototype\n\n  _proto.start = function start() {\n    this._c.startTime = now()\n    step(this._c)\n  }\n\n  _proto.cancel = function cancel() {\n    cancelAnimationFrame(this._c.frame)\n  }\n\n  return Tween\n})()\n\n\n// for each property in newState, get the value from the given state\nconst getStateToTween = function(state, newState) {\n  const stateToTween = {}\n  Object.entries(state).forEach(entry => {\n    const key = entry[0];\n    const val = entry[1];\n    if (newState[key]) stateToTween[key] = val;\n  })\n  return stateToTween\n}\n\n// go through properties in the given state, add to the given array\nconst addValues = function(state, array) {\n  Object.keys(state).forEach((key, index) => {\n    if (typeof state[key] !== \"undefined\") {\n      if (typeof state[key] !== \"object\") {\n        array.push(state[key])\n        return\n      }\n      addValues(state[key], array)\n    }\n  })\n}\n\nconst setTweenedValues = function(state, vals) {\n  function reducer(obj, [key, val]) {\n    obj[key] = val\n    if (typeof val === \"number\") {\n      obj[key] = vals.shift()\n    } else if (typeof val === \"object\") {\n      obj[key] = Object.entries(val).reduce(reducer, {})\n    }\n    return obj\n  }\n  const tweenedState = Object.entries(state).reduce(reducer, {})\n  return tweenedState\n}\n\nconst tweenState = (self, newState, cfg) => {\n  // define default callbacks\n  var onStart = cfg.onStart ? cfg.onStart : noop\n  var onUpdate = cfg.onUpdate ? cfg.onUpdate : noop\n  var onComplete = cfg.onComplete ? cfg.onComplete : noop\n  var shouldSetState = cfg.shouldSetState ? cfg.shouldSetState : true\n  var onSetState = cfg.onSetState ? cfg.onSetState : noop\n\n  if (typeof shouldSetState === \"boolean\") shouldSetState = () => shouldSetState\n\n  cfg.frame = 1\n  cfg.frameTotal = Math.ceil((60 / 1000) * (cfg.delay + cfg.duration)) + 2\n\n  // get a state matching the shape of newState, but with values from self.state\n  var stateToTween = getStateToTween(self.state, newState)\n\n  var startValuesArr = []\n  var endValuesArr = []\n  // use current state values as start values\n  addValues(stateToTween, startValuesArr)\n  // use next state values as end values\n  addValues(newState, endValuesArr)\n\n  // execute the tween, set state on completion\n  var tween = new Tween({\n    from: startValuesArr || 0,\n    to: endValuesArr || 1,\n    paused: cfg.paused || false,\n    delay: cfg.delay || 0,\n    duration: cfg.duration || 200,\n    ease: cfg.ease || \"linear\",\n    frame: 1,\n    frameTotal: cfg.frameTotal || 1,\n    onUpdate: props => {\n      // make sure values is an array\n      var tweenedState = setTweenedValues(newState, [...props.values])\n      if (props.frame === 1) onStart(props)\n      // set current tween properties as the new state\n      if (shouldSetState(props)) {\n        self.setState(tweenedState)\n        onSetState(props)\n      }\n      return onUpdate({ ...props, tweenedState })\n    },\n    onComplete: props => {\n      self.setState(newState)\n      return onComplete(props)\n    }\n  })\n\n  return tween\n}\n\nexport default tweenState\n","// from https://raw.githubusercontent.com/jeromeetienne/microevent.js/master/microevent.js\n\n// This is basically \"MicroEvent\", renamed to \"emitter\", with\n// some changes:\n//  - use \"on\", \"off\", \"emit\", instead of \"bind\", \"unbind\", \"trigger\"\n\n// @TODO\n//  1. update \"on\" and \"off\" methods:\n//    - support matching events via regex pattern:\n//    - \"on\":  for all matches, add fn to this._evts[match]\n//    - \"off\": for all matches, rm fn from this._evts[match]\n//  2. allow to pass data/props around in \"emit\" and \"on\"\n\n;(\"use strict\")\n\nconst emitter = {\n  on: function(ev, fn) {\n    this._evs = this._evs || {}\n    this._evs[ev] = this._evs[ev] || []\n    this._evs[ev].push(fn)\n  },\n  off: function(ev, fn) {\n    this._evs = this._evs || {}\n    if (ev in this._evs === false) return false\n    this._evs[ev].splice(this._evs[ev].indexOf(fn), 1)\n  },\n  emit: function(ev /* , args... */) {\n    this._evs = this._evs || {}\n    if (ev in this._evs === false) return false\n    for (var i = 0; i < this._evs[ev].length; i++) {\n      // the \"arguments\" variable holds the current state (see src/component.js:214)\n      this._evs[ev][i].apply(this, Array.prototype.slice.call(arguments, 1))\n    }\n  }\n}\n\nexport default emitter\n","/*\n * html`<div>...</div>`\n * - allows a cleaner, more powerful way to create HTML using JS Template literals:\n *   - auto joins arrays, without adding commas (so no need to keep using .join('') in your templates)\n *   - supports embedding real DOM nodes: Node Lists, HTML Collections, HTML Objects, Elements\n *   - supports embedding JS Objects as HTML attributes, CSS styles, and HTML data attributes:\n *     - `html` works out the context and converts the given object to an appropriate string\n *     - `html` ignores/strips nested child objects when converting to string\n *   - hides falsey stuff (instead of printing \"false\" [etc] in the output)\n *   - returns generated HTML as a string\n *\n * @param {Template Literal} representing a single HTML element\n * @return {String}\n */\n\nconst html = (strings, ...vals) => {\n  // create a property in which to save event attribute funcs, which we'll\n  // later attach to their elements as proper event listeners\n  html.funcs = html.funcs || [];\n  // start: loop over the template content\n  var output = strings.map((str, i) => {\n    html.i = html.i || i;\n    var v = vals[i] || '';\n    // dont ignore zeros\n    if (typeof vals[i] === 'number') v = vals[i]\n    var ctx = 'attr'\n    // workout our current \"context\" (either inside an HTML opening tag,\n    // inside a style attribute, or inside a data-* attribute)\n    if (str.match(/style=(\"|')$/i)) { //\"\n      ctx = 'style'\n    }\n    // check if dealing with a html `data-*` attribute\n    else if (str.match(/data-[a-z0-9\\-_]+=(\"|')$/i)) { //\"\n      ctx = 'dataAttr'\n    }\n\n    // check for a nested component\n    else if (typeof v === 'function' && v.uid && v.state && v.setState && v.render) {\n      ctx = 'nestedComponent'\n    }\n    // check for event attributes like `onclick=\"{someFunc}\"` etc\n    else if (typeof v === 'function'\n        && ctx === 'attr'\n        && str.match(/ on[a-z0-9]+=(\"|')$/i)) //\"\n    {\n      ctx = 'funcAttr'\n    }\n\n\n    // check for either an Element, HTML Collection, Node List, String,\n    // Object, etc):\n    // if current value to process (v) is an HTML Object of any kind,\n    // gets its outer HTML and use that\n    if (v.nodeName && ctx === 'attr') {\n      v = v.outerHTML;\n\n    } else if (ctx === 'nestedComponent' && typeof v === 'function') {\n\n      // *Important* ..We have a nested component, with its own state and\n      // render loop, but without a container.. We don't need or want it to\n      // setState and re-render, we just want it's latest \"view\", which is\n      // also much faster to get than doing a whole setState + re-render\n      str += v.view(v.state)\n      v=''\n\n    } else if (ctx === 'funcAttr' && typeof v === 'function' && !v.uid) {\n      // keep the function for later, but dont include it in output\n      if (Array.isArray(html.funcs)) html.funcs[html.i] = v;\n      // replace `onclick=\"...\" with onclick=\"${i}\" - we'll reference\n      // it later, once it's a real Element, so we can attach funcs[i] to\n      // it, as a proper event listener method\n      v='';\n      str += html.i\n    } else if (Array.isArray(v)) {\n      // if we have a Node List or HTML Collection, convert its\n      // items to strings\n      if (v[0].nodeName) v = v.map(n => `${n.outerHTML}`)\n      // now concat the array itself to string\n      v = v.join('');\n\n    } else if (typeof v === \"object\") {\n      var s = ''; // the string to build from our object (if needed)\n      if (ctx === 'dataAttr') {\n        // if object is for a data attr, add it as JSON\n        s += JSON.stringify(v).trim();\n      } else {\n        // gets the objects properties as strings,\n        // while ignoring nested objects, arrays etc\n        for (var p in v) {\n          if (p && v && v.hasOwnProperty(p) && typeof v[p] !== \"object\") {\n            // if inside a style attr, return `key: val;`\n            // if inside an HTML tag, return ` key=\"val\"`\n            if (ctx === 'style') s += `${p}:${v[p]};`;\n            if (ctx === 'attr')  s += ` ${p}=\"${v[p]}\"`;\n          }\n        }\n      }\n      // now we've built the appropriate string, set it as the value to\n      // add to our template\n      v = s\n    }\n    // fix not returning zeros (JS treats them as \"falsey\")\n    if (vals[i] === 0) v = \"0\"\n    // now we've converted `v` to a string version of whatever is was,\n    // we can return the current string, with `v` appended, and then\n    // move to next iteration\n\n    html.i += 1;\n    return str ? str + (v || '') : '';\n  }).join('');\n\n  // return the compiled HTML as a string\n  return output;\n}\n\nexport default html\n","import html from './html'\n\n/**\n * htmel`<div>...</div>`\n * - allows a cleaner, more powerful way to create HTML using JS Template literals:\n *   - auto joins arrays, without adding commas (so no need to keep using .join('') in your templates)\n *   - supports embedding real DOM nodes: Node Lists, HTML Collections, HTML Objects, Elements\n *   - supports embedding JS Objects as HTML attributes, CSS styles, and HTML data attributes:\n *     - `html` works out the context and converts the given object to an appropriate string\n *     - `html` ignores/strips nested child objects when converting to string\n *   - supports embedding functions in event attributes:\n *     - `htmel` will attach them as callbacks to the relevant Event Listeners\n *   - hides falsey stuff (instead of printing \"false\" [etc] in the output)\n *   - returns the generated HTML as an HTML Object (browser) or a string (NodeJS)\n *\n * @param {Template Literal} HTML representing a single element\n * @return {Element|String}\n */\nconst htmel = (strings, ...vals) => {\n  var out = html(strings, ...vals).trim(); // use .trim() so we never return a text node of whitespace as the result\n  // if not in a browser, return the HTML as a string\n  if (!document) return out;\n  // else, return the HTML as a proper HTML Object\n  var t = document.createElement('template');\n  t.innerHTML = out;\n  // get all elems inside our template\n  var elems = t.content.firstChild.children.length > 0 \n    ? t.content.firstChild.children \n    : t.content.firstChild;\n  // for each elem, get its attributes\n  for (var i = 0; i < elems.length; i++) {\n    var attrs = elems[i].attributes;\n    // for each attribute, check it starts with `on`\n    for (var q = 0; q < attrs.length; q++) {\n      var attr = attrs[q];\n      if (attr.name.match(/^on/)) {\n        // if attribute starts with \"on\", remove it\n        elems[i].removeAttribute(attr.name);\n        // and assign the function as a proper event listener instead\n        elems[i].addEventListener(attr.name.replace(/^on/, ''), html.funcs[attr.value])\n      }\n    }\n  }\n  return t.content.firstChild;\n}\n\nexport default htmel\n","/*\n * Based on Canvas Context2D Wrapper <http://github.com/millermedeiros/CanvasContext2DWrapper>\n *\n * With additions shamelessly stolen from:\n *\n * - https://gist.github.com/sc0ttj/0a0b7dcfffa3894eb3da8a4c731fb251\n * - https://github.com/reu/canvas-extensions\n * - https://github.com/sapiraz/ExtendedCanvas\n * - https://github.com/Martin-Pitt/canvas-plus\n * - https://github.com/pkorac/cardinal-spline-js\n * - https://github.com/ericdrowell/concrete/blob/master/src/concrete.js\n * - https://xosh.org/canvas-recorder/\n * - https://github.com/SMUsamaShah/CanvasRecorder\n * - https://github.com/straker/kontra\n * - https://github.com/rezoner/CanvasQuery/blob/master/canvasquery.js\n * - https://hmp.is.it/creating-chroma-key-effect-html5-canvas/\n * - https://github.com/kikemadrigalr/chromaKey/blob/master/main.js\n * -\n *\n *\n */\n\nconst ctxMethods = 'arc arcTo beginPath bezierCurveTo clearRect clip closePath createImageData createLinearGradient createRadialGradient createPattern drawFocusRing drawImage fill fillRect fillText getImageData isPointInPath lineTo measureText moveTo putImageData quadraticCurveTo rect restore rotate save scale setTransform stroke strokeRect strokeText transform translate'.split(' ');\nconst ctxProps = 'canvas fillStyle font globalAlpha globalCompositeOperation lineCap lineJoin lineWidth miterLimit shadowOffsetX shadowOffsetY shadowBlur shadowColor strokeStyle textAlign textBaseline'.split(' ');\n\n/**\n* Wrap function to enable method chaining.\n* @param {Function} fn\tFunction to be modified.\n* @param {Object} scope\tScope where function will be called.\n* @param {Object} chainReturn\tObject returned to enable chaining.\n* @return {Function} Chainable function.\n* @private\n*/\nfunction chainMethod(fn, scope, chainReturn) {\n  return function() {\n    \treturn fn.apply(scope, arguments) || chainReturn;\n  };\n}\n\n/**\n* Convert properties into getter/setter methods enabling chaining.\n* @param {String} propName\tProperty name.\n* @param {Object} scope\tObject that contain original property.\n* @param {Object} chainReturn\tObject returned to enable chaining.\n* @return {Function} Chainable getter/setter for properties.\n* @private\n*/\nfunction chainProperty(propName, scope, chainReturn) {\n  return function(value) {\n  \tif(typeof value === 'undefined') {\n  \t\treturn scope[propName];\n  \t}else{\n  \t\tscope[propName] = value;\n  \t\treturn chainReturn;\n  \t}\n  };\n}\n\nconst PIXEL_RATIO = (function () {\n  return (window && window.devicePixelRatio) || 1;\n})();\n\n// calculate maths constants only once\nconst PI = Math.PI;\nconst PIx2 = PI * 2;\nconst PIo2 = PI / 2\nconst RAD2DEG = 180 / PI;\nconst DEG2RAD = PI / 180;\n\n// display settings\n//const maxWidth = 1920, maxHeight = 1200; // up to 1080p and 16:10\n//const fixedWidth = 1280, fixedHeight = 720;  // 720p\n//const fixedWidth = 1920, fixedHeight = 1080; // 1080p\n//const fixedWidth = 128,  fixedHeight = 128;  // PICO-8\n//const fixedWidth = 240,  fixedHeight = 136;  // TIC-80\n/* TODO\n\n- brushes:\n  - presets for draw tool, fill and stroke styles\n  - see https://github.com/jimschubert/brushes.js\n\n\n- arrows:\n  - line arrows\n  - arc arrows\n\n\n- responsive canvas:\n  - auto resize on screen/orientation change\n  - option to maintain aspect ratio\n  - see https://github.com/Nelkor/ctx-2d/blob/master/index.js#L18\n\n      const aspectRatio = canvas.maxWidth / canvas.maxHeight;\n      const width  = canvas.clientWidth;\n      const height = canvas.clientHeight;\n      if (aspectRatio) {\n        if (width / height < aspectRatio) {\n          canvas.width = Math.min(width, canvas.maxWidth);\n          canvas.height = canvas.width / aspectRatio;\n        } else {\n          canvas.height = Math.min(height, canvas.maxHeight);\n          canvas.width = canvas.height * aspectRatio;\n        }\n      }\n\n- various goodies: colour, maths, seeded randoms, vectors, engine objects/entities, etc\n  - https://github.com/KilledByAPixel/LittleJS/blob/main/engine/engine.all.js\n\n- undo/redo:\n  - see https://github.com/jussi-kalliokoski/canvas-history.js\n\n\n- play/replay:\n  - https://github.com/despeset/ctxShark/blob/master/ctxShark.js\n\n\n- maths:\n    - plotting\n      - http://javascripter.net/faq/plotafunctiongraph.htm\n      - see https://github.com/d12/QuickPlotJS\n\n    - https://github.com/mattdesl/canvas-sketch-util/blob/master/docs/math.md\n\n    - interpolate colors and numbers: https://github.com/worksbyscott/Interpolator/blob/main/interpolator.js\n\n    - lerp (linear interpolation) for single value\n\n          function lerp(start, end, value) {\n            return start + value * ( end - start );\n          }\n\n          console.log( lerp(10, 20, 0.5) );  // => 15\n          console.log( lerp(10, 20, 2) );    // => 30\n\n    - inverse lerp:\n\n        function inverseLerp(start, end, value) {\n          return (value - start) / (end - start);\n        }\n\n        console.log( inverseLerp(10, 20, 15) );  // => 0.5\n        console.log( inverseLerp(10, 20, 30) );  // => 2\n\n\n    - lerp for 2d coordinates\n\n          function lerp2d([x0, y0] = [], [x1, y1] = [], t) {\n            return [\n              lerp(x0, x1, t),\n              lerp(y0, y1, t),\n            ];\n          }\n          // usage\n          lerp2d([px,py], [x,y])\n\n\n=== STUFF BELOW NEEDS ANIMATION LOOP ===\n\n\n- particle emitter\n  - https://gist.github.com/nickgs/104391ea388dde93610d27093533da64\n  - https://gist.github.com/incompl/4125971\n  - https://gist.github.com/fwon/29a7d67111c8105f9de82d45856910f8\n  - https://gist.github.com/rlemon/5658113\n  - https://gist.github.com/idettman/9ddd55250e8643b83aa22ee056c34cb6\n  - https://github.com/KilledByAPixel/LittleJS/blob/main/engine/engineParticle.js\n  - also see http://buildnewgames.com/particle-systems/  (repo: https://github.com/city41/particle.js)\n\n\n\n- visual FX:\n  - smoke: https://gist.github.com/Vayn/8909634\n  - fire:\n  - explosions:\n  - fireworks: https://gist.github.com/shortercode/6647f2c11e0788ef940c82a82932d780\n  - sparks:\n  - water:\n\n\n=== STUFF BELOW NEEDS INTERACTIVITY/EVENTS SYSTEM FIRST ===\n\n- collision detection:\n  - broad phase (narrowing it down):\n    - quad trees\n      - https://github.com/timohausmann/quadtree-js\n    - spatial has maps\n      - https://gist.github.com/troufster/710529\n      - https://gist.github.com/sc0ttj/b46aefceacb47990e59b36cceb6a81ad\n      - https://gist.github.com/sc0ttj/ec6d3faf1a77c2c8b366629a0f278f5d\n  - narrow phase (actual detecting of collisions)\n    - ?\n\n\n- https://github.com/vasturiano/canvas-color-tracker\n  - enables hover detection for canvas objects\n  - uses same method as threeJS (colours as hit areas):\n    - draws each object to shadow screen canvas, using a unique color\n    - assigns that color to the drawn object\n    - on mouse move,\n      - gets the colour under mouse x,y (from shadow canvas)\n      - looks up the object associated with that colour\n\n      const tracker = new ColorTracker();\n      const obj = { x,y,w,h,..etc };\n      const objColor = tracker.register(myObject);\n      // ...later\n      const hoverColor = ctx.getImageData(x, y, 1, 1).data;\n      const hoverObject = tracker.lookup(hoverColor);\n\n\n- easy events\n\n      const rr = ctx.create.roundedRect(x,y,w,h,r);  // caches and returns {x,y,w,h,r}\n      rr.draw();\n      rr.on('mouseover', function(e) {\n        this // equals rr\n        e    // equals event\n      });\n\n\n- map/background generator and tiler\n    - https://developer.mozilla.org/en-US/docs/Games/Techniques/Tilemaps\n    - https://developer.mozilla.org/en-US/docs/Games/Techniques/Tilemaps/Square_tilemaps_implementation:_Static_maps\n    - https://developer.mozilla.org/en-US/docs/Games/Techniques/Tilemaps/Square_tilemaps_implementation:_Scrolling_maps\n    - https://mozdevs.github.io/gamedev-js-tiles/  and  https://github.com/mozdevs/gamedev-js-tiles\n    - https://github.com/basementuniverse/tily\n    - https://github.com/yagl/tiledmap\n    - https://www.redblobgames.com/grids/parts/ (lots of theory and algorithm)\n\n\n- sprite (series of images, easy to setup and control/animate)\n  - see http://buildnewgames.com/sprite-animation/\n\n\n- shadow casting? :\n    - https://ncase.me/sight-and-light/  and https://github.com/ncase/sight-and-light\n    - or  https://github.com/kreldjarn/shadowjs/blob/master/shadow.js:\n\n     var origin = {x: 100, y: 200};\n     var rect = {\n         lx: 300,\n         ty: 350,\n         w: 50,\n         h: 200\n     };\n\n     // Cast a shadow of a rectangle from origin\n     Shadow.castFromRectangle(\n         ctx,\n         origin,\n         rect.lx,\n         rect.ty,\n         rect.w,\n         rect.h\n     );\n\n\n- field of view\n    - see https://legends2k.github.io/2d-fov/  and  https://github.com/legends2k/2d-fov\n\n\n- mouse interactivity - add properties that can be used by a useControls() addon\n\n     function getMousePos(event) {\n        var rect = ctx.canvas.getBoundingClientRect();\n        ctx.mousePos = {x:(event.clientX-rect.left)/ctx.canvas.scale, y:(event.clientY-rect.top)/ctx.canvas.scale};\n      }\n\n- node graph\n  - see https://github.com/paulfears/Graphs\n\n*/\n\n\n// helper funcs\n\nfunction getVideoMimeType() {\n  let supportedType = null;\n  let types = [\n    \"video/webm\",\n    'video/webm\\;codecs=vp9',\n    'video/vp8',\n    \"video/webm\\;codecs=vp8\",\n    \"video/webm\\;codecs=daala\",\n    \"video/webm\\;codecs=h264\",\n    \"video/mp4\",\n    \"video/mpeg\"\n  ];\n  for (let i in types) {\n    if (MediaRecorder.isTypeSupported(types[i])) {\n      supportedType = types[i];\n      break;\n    }\n  }\n  return supportedType;\n}\n\n// create a link to a blob, simulates clicking it, which triggers\n// a download of the blob in a browser\nfunction downloadBlobAs(blob, name) {\n  let a  = document.createElement('a'),\n      url = URL.createObjectURL(blob),\n      fileName = name || `canvas-${new Date().valueOf()}`,\n      e;\n\n  // set attributes\n  a.target = '_blank';\n  a.href = url;\n  a.download = fileName;\n  a.click();\n  window.URL.revokeObjectURL(url);\n}\n\n// define extra methods to add/bind to our extended 2d canvas context\nconst extraMethods = {\n\n  // general helper funcs\n  clear: function(resetTransform) {\n    if (resetTransform === true) this.setTransform(1, 0, 0, 1, 0, 0);\n    this.clearRect(0, 0, this.canvas.width * PIXEL_RATIO, this.canvas.height * PIXEL_RATIO);\n  },\n  fullscreen: function() {\n    if (!document.fullscreenElement) this.canvas.requestFullscreen();\n    else document.exitFullscreen();\n  },\n  isClean: function() {\n    try {\n        const pixel = this.getImageData(0, 0, 1, 1);\n        return true;\n    } catch(err) {\n        return false;\n    }\n  },\n\n  size: function(w, h, a) {\n    if (this.w === w && this.h === h) return; // if no new size, just return\n    // if width or height not given, get them from aspect ratio\n    this.w = w ? w : h * a;\n    this.h = h ? h : w * a;\n    // respect device pixel ratio\n    this.canvas.width = this.w * PIXEL_RATIO;\n    this.canvas.height = this.h * PIXEL_RATIO;\n    // update the CSS too\n    this.canvas.style.width = this.w + 'px';\n    this.canvas.style.height = this.h + 'px';\n    this.canvas.style.objectFit = a ? 'contain' : null;\n    // adjust scale for pixel ratio\n    if (this.contextType === '2d' && PIXEL_RATIO !== 1) {\n      this.scale(PIXEL_RATIO, PIXEL_RATIO);\n    }\n  },\n\n  // a simple \"camera\"\n  camera: function(x = 0, y = 0, scale = 1, degrees = 0) {\n    this.resetTransform();\n    this.translate(x, y);\n    this.rotate(degrees * DEG2RAD);\n    this.scale(scale, scale);\n    this.translate(-x, -y);\n  },\n\n  // replace green (by default) pixels with transparent ones\n  chromaKey: function(tolerance = 150, color = [0,255,0]) {\n    const t = tolerance > 250 ? 250 : tolerance; // more than 255 produces weird results\n    const imageData = this.getImageData(0, 0, this.canvas.width, this.canvas.height);\n    const d = imageData.data;\n    let diff;\n\n    // for each pixel, get its diff from cache, or calculate it\n    // NOTE: we have separate routines for green, and other colours\n    // see next note\n\n    // if user wants to remove green\n    if (color[1] > color[0] && color[1] > color[2]) {\n      for (let i = 0, l = d.length; i < l; i += 4) {\n        if (d[i+1] > 50 && d[i+1] > d[i] && d[i+1] > d[i+2]) d[i+3] = 0;\n      }\n    // if user wants to remove anything else\n    } else {\n      for (let i = 0, l = d.length; i < l; i += 4) {\n        diff = Math.abs(color[0] - d[i+0]) +\n               Math.abs(color[1] - d[i+1]) +\n               Math.abs(color[2] - d[i+2]);\n        // NOTE: this bit doesn't work well if removing green (hence routine above)\n        if (diff < t) d[i+3] = (diff*diff)/t;\n      }\n    }\n    this.putImageData(imageData, 0, 0);\n  },\n\n  //getPixels: function() {\n  //  return this.getImageData(0, 0, this.canvas.width, this.canvas.height).data\n  //},\n\n  // new drawing method & shapes\n  line: function(px, py, x, y, dashPattern = []) {\n    this.beginPath();\n    this.save();\n    this.setLineDash(dashPattern);\n    this.moveTo(px, py);\n    this.lineTo(x, y);\n    this.closePath();\n    this.fill();\n    this.stroke();\n    this.restore(); // use this cos we used setLineDash()\n  },\n  circle: function(x,y,r,deg = 360,antiClockwise) {\n    this.beginPath();\n    this.arc(x, y, r, 0, deg*DEG2RAD, antiClockwise);\n    // go to center of circle, and _then_ close the path (creates a \"pie\"\n    // or \"pacman\" shape, if degrees < 360)\n    this.lineTo(x, y);\n    this.closePath();\n  },\n  fillCircle: function(x,y,radius,deg) {\n    extraMethods.circle.apply(this, [x,y,radius,deg])\n    this.fill();\n  },\n  strokeCircle: function(x,y,radius,deg) {\n    extraMethods.circle.apply(this, [x,y,radius,deg])\n    this.stroke();\n  },\n  ellipse: function(x, y, width, height) {\n    let kappa, ox, oy, xe, xm, ye, ym;\n    kappa = .5522848;\n    ox = (width / 2) * kappa;\n    oy = (height / 2) * kappa;\n    xe = x + width;\n    ye = y + height;\n    xm = x + width / 2;\n    ym = y + height / 2;\n    this.moveTo(x, ym);\n    this.bezierCurveTo(x, ym - oy, xm - ox, y, xm, y);\n    this.bezierCurveTo(xm + ox, y, xe, ym - oy, xe, ym);\n    this.bezierCurveTo(xe, ym + oy, xm + ox, ye, xm, ye);\n    this.bezierCurveTo(xm - ox, ye, x, ym + oy, x, ym);\n  },\n  fillEllipse: function(x, y, width, height) {\n    this.beginPath();\n  \textraMethods.ellipse.apply(this, [x, y, width, height])\n    this.closePath();\n    this.fill();\n  },\n  strokeEllipse: function(x, y, width, height) {\n    this.beginPath();\n  \textraMethods.ellipse.apply(this, [x, y, width, height])\n    this.closePath();\n    this.stroke();\n  },\n  ring: function(x, y, innerRadius, outerRadius) {\n    this.beginPath();\n    this.arc(x, y, innerRadius, 0, PIx2, false);\n    this.moveTo(outerRadius, 0);\n    this.arc(x, y, outerRadius, PIx2, 0, true);\n    this.closePath();\n  },\n  fillRing: function(x, y, innerRadius, outerRadius) {\n  \textraMethods.ring.apply(this, [x, y, innerRadius, outerRadius]);\n    this.fill();\n  },\n  strokeRing: function(x, y, innerRadius, outerRadius) {\n  \textraMethods.ring.apply(this, [x, y, innerRadius, outerRadius]);\n    this.stroke();\n  },\n  gradientCircle: function(x, y, r, r2, offsetX = 0, offsetY = 0, fillSteps) {\n    const fillGradient = this.createRadialGradient(x + offsetX, y + offsetY, r2, x + offsetX, y + offsetY, r)\n    for (let i = 0; i < fillSteps.length; i++) {\n      fillGradient.addColorStop(fillSteps[i][0], fillSteps[i][1]);\n    }\n    this.fillStyle = fillGradient;\n    extraMethods.circle.apply(this, [x,y,r2])\n    this.fill();\n    this.closePath();\n  },\n  gradientRect: function(x, y, w, h, fillSteps, horiz = true) {\n    if (fillSteps) {\n      const fillGradient = horiz\n        ? this.createLinearGradient(x, y, x, y+h)\n        : this.createLinearGradient(x, y, x+w, y);\n      for (let i = 0; i < fillSteps.length; i++) {\n        fillGradient.addColorStop(fillSteps[i][0], fillSteps[i][1]);\n      }\n      this.fillStyle = fillGradient;\n      this.fillRect(x, y, w, h);\n      this.closePath();\n    }\n  },\n  roundedRect: function(x, y, w, h, r) {\n  \tthis.moveTo(x + r, y);\n  \tthis.arcTo(x + w, y, x + w, y + r, r);\n  \tthis.arcTo(x + w, y + h, x + w - r, y + h, r);\n  \tthis.arcTo(x, y + h, x, y + h - r, r);\n  \tthis.arcTo(x, y, x + r, y, r);\n    this.closePath();\n  },\n  fillRoundedRect: function(x, y, w, h, r) {\n    this.beginPath();\n  \textraMethods.roundedRect.apply(this, [x, y, w, h, r])\n    this.fill();\n  },\n  strokeRoundedRect: function(x, y, w, h, r) {\n    this.beginPath();\n  \textraMethods.roundedRect.apply(this, [x, y, w, h, r])\n    this.stroke();\n  },\n  polygon: function(points, dashPattern = [], restore = true) {\n    this.beginPath();\n    if (restore) this.save();\n    this.setLineDash(dashPattern);\n    const x = points[0][0];\n    const y = points[0][1];\n    this.moveTo(x, y);\n    points.shift(); // remove first element, we just went there\n    points.forEach(point => this.lineTo(point[0], point[1]));\n    this.closePath();\n    if (restore) this.restore(); // use this cos we used setLineDash()\n  },\n  fillPolygon: function (points, dashPattern = []) {\n    extraMethods.polyshape.apply(this, [points, dashPattern, false]);\n    this.fill();\n    this.restore(); // use this cos we used setLineDash() in polygon()\n  },\n  strokePolygon: function (points, dashPattern = []) {\n    extraMethods.polyshape.apply(this, [points, dashPattern, false]);\n    this.stroke();\n    this.restore(); // use this cos we used setLineDash() in polygon()\n  },\n  polyshape: function(x,y,radius,s,a) {\n    const position \t= {x,y};\n    const sides \t\t= s ? s : 6;\n    const angle\t\t\t= a ? a : 0;\n    this.translate(position.x,position.y);\n    this.rotate(angle * DEG2RAD);\n    this.beginPath();\n    this.moveTo(radius, 0);\n    for(var j = 0; j <= PIx2; j += PI / (sides/2)) {\n      this.lineTo(radius * Math.cos(j), radius * Math.sin(j));\n    }\n    this.closePath();\n    this.rotate(-angle * DEG2RAD);\n    this.translate(-position.x,-position.y);\n  },\n  fillPolyshape: function(x,y,radius,s,a) {\n    extraMethods.polyshape.apply(this, [x,y,radius,s,a])\n    this.fill();\n  },\n  strokePolyshape: function(x,y,radius,s,a) {\n    extraMethods.polyshape.apply(this, [x,y,radius,s,a])\n    this.stroke();\n  },\n  star: function(x,y,radius,s,a) {\n    const position \t= {x,y};\n    const sides \t\t= (s ? s : 5) * 2;\n    const angle\t\t\t= -90 - (a ? a : 0);\n    this.translate(position.x,position.y);\n    this.rotate(angle * DEG2RAD);\n    this.beginPath();\n    this.moveTo(radius, 0);\n    let wobble = 2;\n    for(var j = 0; j <= PIx2; j += PI / (sides/2)) {\n    \twobble = wobble == 1 ? 2 : 1;\n      this.lineTo(((radius / (wobble)) * Math.cos(j)),((radius / (wobble)) * Math.sin(j)));\n    }\n    this.closePath();\n    this.rotate(-angle * DEG2RAD);\n    this.translate(-position.x,-position.y);\n  },\n  fillStar: function(x,y,radius,s,a) {\n    extraMethods.star.apply(this, [x,y,radius,s,a])\n    this.fill();\n  },\n  strokeStar: function(x,y,radius,s,a) {\n    extraMethods.star.apply(this, [x,y,radius,s,a])\n    this.stroke();\n  },\n  square: function(x,y,w) {\n    this.beginPath();\n    this.rect(x, y, w, w);\n    this.closePath();\n  },\n  triangle: function(x,y,radius,angle) {\n  \textraMethods.polyshape.apply(this, [x,y,radius,3,angle ? angle : -90])\n  },\n  fillTriangle: function(x,y,radius,angle) {\n    extraMethods.polyshape.apply(this, [x,y,radius,3,angle ? angle : -90])\n    this.fill();\n  },\n  strokeTriangle: function(x,y,radius,angle) {\n    extraMethods.polyshape.apply(this, [x,y,radius,3,angle ? angle : -90])\n    this.stroke();\n  },\n  curve: function(points, tension, numOfSeg, close) { // also see a simpler alternative here: https://stackoverflow.com/a/49371349\n  \t// options or defaults\n  \ttension = (typeof tension === 'number') ? tension : 0.5;\n  \tnumOfSeg = numOfSeg ? numOfSeg : 20;\n    // set some vars\n  \tlet pts;// clone point array\n  \tlet res = [];\n  \tlet l = points.length;\n  \tlet i;\n  \tlet cache = new Float32Array((numOfSeg+2)*4);\n  \tlet cachePtr = 4;\n\n  \t// begin..\n  \tpts = points.slice(0);\n  \tif (close) {\n  \t\tpts.unshift(points[l - 1]); // insert end point as first point\n  \t\tpts.unshift(points[l - 2]);\n  \t\tpts.push(points[0], points[1]); // first point as last point\n  \t}\n  \telse {\n  \t\tpts.unshift(points[1]);\t// copy 1. point and insert at beginning\n  \t\tpts.unshift(points[0]);\n  \t\tpts.push(points[l - 2], points[l - 1]);\t// duplicate end-points\n  \t}\n  \t// cache inner-loop calculations as they are based on t alone\n  \tcache[0] = 1;\n  \tfor (i = 1; i < numOfSeg; i++) {\n  \t\tlet st = i / numOfSeg,\n  \t\t\tst2 = st * st,\n  \t\t\tst3 = st2 * st,\n  \t\t\tst23 = st3 * 2,\n  \t\t\tst32 = st2 * 3;\n\n  \t\tcache[cachePtr++] =\tst23 - st32 + 1;\t// c1\n  \t\tcache[cachePtr++] =\tst32 - st23;\t\t// c2\n  \t\tcache[cachePtr++] =\tst3 - 2 * st2 + st;\t// c3\n  \t\tcache[cachePtr++] =\tst3 - st2;\t\t\t// c4\n  \t}\n  \tcache[++cachePtr] = 1;\n\n  \t// the parser func\n  \tfunction parse(pts, cache, l) {\n  \t\tfor (let i = 2; i < l; i += 2) {\n  \t\t\tlet pt1 = pts[i],\n  \t\t\t\tpt2 = pts[i+1],\n  \t\t\t\tpt3 = pts[i+2],\n  \t\t\t\tpt4 = pts[i+3],\n  \t\t\t\tt1x = (pt3 - pts[i-2]) * tension,\n  \t\t\t\tt1y = (pt4 - pts[i-1]) * tension,\n  \t\t\t\tt2x = (pts[i+4] - pt1) * tension,\n  \t\t\t\tt2y = (pts[i+5] - pt2) * tension;\n\n  \t\t\tfor (let t = 0; t <= numOfSeg; t++) {\n  \t\t\t\tconst c = t * 4;\n  \t\t\t\tres.push(cache[c] * pt1 + cache[c+1] * pt3 + cache[c+2] * t1x + cache[c+3] * t2x,\n  \t\t\t\t\t\t cache[c] * pt2 + cache[c+1] * pt4 + cache[c+2] * t1y + cache[c+3] * t2y);\n  \t\t\t}\n  \t\t}\n  \t}\n\n  \t// calculate/parse the points\n  \tparse(pts, cache, l);\n\n  \tif (close) {\n  \t\tpts = [];\n  \t\tpts.push(points[l - 4], points[l - 3], points[l - 2], points[l - 1]); // second last and last\n  \t\tpts.push(points[0], points[1], points[2], points[3]); // first and second\n  \t\tparse(pts, cache, 4);\n  \t}\n  \t// add lines to path\n  \tfor(i = 0, l = res.length; i < l; i += 2) {\n  \t\tthis.lineTo(res[i], res[i+1]);\n    }\n\n  \treturn res;\n  },\n\n  // grids\n  drawGridBox(x, y, w, h, size, lineWidth = 0.1, color = '#444') {\n    this.save();\n    this.lineWidth = lineWidth;\n    this.strokeStyle = color;\n    this.moveTo(x,y)\n    this.lineTo(x+w,y)\n    this.lineTo(x+w,y+h)\n    this.lineTo(x,y+h)\n    this.lineTo(x,y)\n    // draw vertical lines\n    for (let i=1; i < w/size; i++) {\n      this.moveTo(x+size*i, y);\n      this.lineTo(x+size*i, y+h);\n    }\n    // draw horizontal lines\n    for (let i=1; i < h/size; i++) {\n      this.moveTo(x, y+size*i);\n      this.lineTo(x+w, y+size*i);\n    }\n    this.stroke();\n    this.closePath();\n    this.restore();\n  },\n  drawGrid(size, lineWidth = 0.1, strokeColor = '#444') {\n    extraMethods.drawGridBox.apply(this, [0,0,this.canvas.width,this.canvas.height,size,lineWidth,strokeColor])\n  },\n  checkerboard: function(x, y, w, h, gridSize, colorA, colorB) {\n    const tx = w / gridSize | 0;\n    const ty = h / gridSize | 0;\n    let color;\n    this.save();\n    this.rect(x, y, w, h);\n    for (var i = 0; i <= tx; i++) {\n      for (var j = 0; j <= ty; j++) {\n        if (j % 2) {\n          color = i % 2 ? colorA : colorB;\n        }\n        else {\n          color = i % 2 ? colorB : colorA;\n        }\n        this.fillStyle = color;\n        this.fillRect(x + i * gridSize, y + j * gridSize, gridSize, gridSize);\n      }\n    }\n    this.restore();\n  },\n\n  // helper function - creates an img element, caches it, then sets the\n  // onload method up to draw the image, and returns the image element - all\n  // that is left to do to it is set the src elsewhere\n  cacheImg: function(url, x, y, w, h, dx, dy, dWidth, dHeight) {\n    if (this.cache[url]) return this.cache[url];\n    this.cache[url] = new Image();\n    this.cache[url].onload = () => {\n      this.cache[url].width = w;\n      this.cache[url].height = h;\n      return dx\n        ? this.drawImage(this.cache[url], x, y, w, h, dx, dy, dWidth, dHeight)\n        : this.drawImage(this.cache[url], x, y, w, h);\n    }\n    this.cache[url].crossOrigin = 'anonymous';\n    return this.cache[url];\n  },\n\n  // for explanation of params,see https://developer.mozilla.org/en-US/docs/Web/API/CanvasRenderingContext2D/drawImage/canvas_drawimage.jpg\n  drawImg: function(url, x, y, w, h, dx, dy, dWidth, dHeight) {\n    // draw now, if available\n    if (url.outerHTML) return dx\n      ? this.drawImage(url, x, y, w, h, dx, dy, dWidth, dHeight)\n      : this.drawImage(url, x, y, w, h);\n    if (!this.cache) this.cache = {};\n    if (this.cache[url] && this.cache[url].src) {\n      return dx\n      ? this.drawImage(this.cache[url], x, y, w, h, dx, dy, dWidth, dHeight)\n      : this.drawImage(this.cache[url], x, y, w, h);\n    }\n    // or load it and cache it first, *then* set it's src attribute to trigger\n    // the 'onload' event, which will then draw the image to the canvas\n    extraMethods.cacheImg.apply(this, [url, x, y, w, h, dx, dy, dWidth, dHeight]).src = !url.includes('<svg')\n          ? url\n          : \"data:image/svg+xml; charset=utf8,\" + encodeURIComponent(url);\n  },\n\n  // styling helpers\n  setStyle: function(obj) {\n    for(i in obj) {\n      this[i] = obj[i];\n    };\n  },\n\n  // maths helpers\n  angleFromPoints: function(x1, x2, y1, y2) {\n    return Math.atan2(y2 - y1, x2 - x1) // returns radians\n    // see https://stackoverflow.com/a/1707251\n    // The * DEG2RAD converts radians to degrees,\n    // the + 180 makes sure its always positive i.e. 0-360 deg,\n    // rather than -180 to 180 deg\n    return Math.atan2(y2 - y1, x2 - x1) * DEG2RAD + 180;\n  },\n  angleToTarget: function (x, y, x1, y1) {\n    // atan2 returns the counter-clockwise angle in respect to the x-axis, but\n    // the canvas rotation system is based on the y-axis (rotation of 0 = up).\n    // so we need to add a quarter rotation to return a counter-clockwise\n    // rotation in respect to the y-axis\n    return Math.atan2(y1 - y, x1 - x) + PIo2;\n  },\n  clamp: function(x, min, max) {\n    return Math.min(Math.max(min, x), max);\n  },\n  distance: function(x2, x1, y2, y1) {\n    return Math.sqrt(Math.pow(x2-x1, 2) + Math.pow(y2-y1, 2));\n  },\n  seededRandom: function (str) {\n    // see https://stackoverflow.com/a/47593316/2124254\n    // see https://github.com/bryc/code/blob/master/jshash/PRNGs.m\n    // based on the above references, this was the smallest code yet decent\n    // quality seed random function (from https://github.com/straker/kontra/blob/main/src/helpers.js)#\n    //\n    // first create a suitable hash of the seed string using xfnv1a\n    // @see https://github.com/bryc/code/blob/master/jshash/PRNGs.md#addendum-a-seed-generating-functions\n    for (var i = 0, h = 2166136261 >>> 0; i < str.length; i++) {\n      h = Math.imul(h ^ str.charCodeAt(i), 16777619);\n    }\n    h += h << 13;\n    h ^= h >>> 7;\n    h += h << 3;\n    h ^= h >>> 17;\n    let seed = (h += h << 5) >>> 0;\n    // then return the seed function and discard the first result\n    // @see https://github.com/bryc/code/blob/master/jshash/PRNGs.md#lcg-lehmer-rng\n    let rand = () => ((2 ** 31 - 1) & (seed = Math.imul(48271, seed))) / 2 ** 31;\n    rand();\n    return rand;\n  },\n  random: function(min, max, decimal) {\n    if (decimal) return Math.random() * (max - min) + min;\n    return Math.floor(Math.random() * (max - min+1)) + min;\n  },\n  randomFrom(arr) {\n    return extraMethods.random.apply(this, [1, arr.length])\n  },\n  rotateAt: function(x, y, deg) {\n    this.translate(x, y);\n    this.rotate(deg * DEG2RAD);\n    this.translate(-x, -y);\n  },\n  toRad: function(deg) { // degrees to radians\n    return deg * DEG2RAD;\n  },\n  toDeg: function(rad) { // radians to degrees\n    return rad * RAD2DEG;\n  }\n};\n\nconst extraMethodNames = Object.keys(extraMethods);\n\n/**\n* @class Canvas Context2D Wrapper.\n* @param {CanvasRenderingContext2D} origCtx\tCanvas Context2D that will be wrapped.\n* @param {Component} c\tthe @scottjarvis/component to which the ctx is attached (optional)\n*/\nwindow.Ctx = function(origCtx, c) {\n  let n = ctxMethods.length;\n  let curProp;\n  let chunks;\n  const supportedType = getVideoMimeType();\n\n  /**\n   * Reference to Canvas Rendering Context 2D.\n   * @type CanvasRenderingContext2D\n   */\n  this.context = origCtx;\n\n  //wrap methods\n  while(n--) {\n  \tcurProp = ctxMethods[n];\n  \tthis[curProp] = chainMethod(origCtx[curProp], origCtx, this);\n  }\n\n  // wrap the extra methods\n  n = extraMethodNames.length;\n  while(n--) {\n  \tcurProp = extraMethodNames[n];\n  \tthis[curProp] = chainMethod(extraMethods[curProp], origCtx, this);\n  }\n\n  //convert properties into methods (getter/setter)\n  n = ctxProps.length;\n  while(n--) {\n  \tcurProp = ctxProps[n];\n  \tthis[curProp] = chainProperty(curProp, origCtx, this);\n  }\n\n  // the above code replaces context properties with methods in our new\n  // context, so put back the reference to the canvas element, cos we want it\n  this.canvas = origCtx.canvas;\n\n  // add more methods to the extended context - they're added here cos they're\n  // grouped/namespaced under ctx.image.* and ctx.video.* and the above\n  // loops that make methods chainable don't handle this\n\n  this.image = {\n    // download canvas as an image file, called ${name}\n    saveAs: function(name) {\n      this.canvas.toBlob(blob => downloadBlobAs(blob, name));\n    },\n    // pass the canvas an <img> to the given callback\n    toElement: function(cb) {\n      const img = new Image();\n      const { w, h } = this;\n      // once image is loaded, pass it into the callback\n      img.onload = function() {\n        img.width = w;\n        img.height = h;\n        cb(img);\n      };\n      img.crossOrigin = 'anonymous';\n      // set the src to trigger img.onload\n      img.src = this.canvas.toDataURL('image/png');\n    },\n  };\n\n  this.video = {\n\n    // record canvas to video data\n    record: (fps, mimeType = supportedType, audioBitsPerSecond = 128000, videoBitsPerSecond = 2500000) => {\n      if (this.isRecording === true) return true;\n      const framesPerSecond = (fps > 0 && fps <=60) ? fps : 24;\n      chunks = [];\n      // set media recorder options\n      const opts = {\n        audioBitsPerSecond,\n        videoBitsPerSecond,\n        mimeType\n      };\n      // set the stream to record\n      const stream = this.canvas.captureStream(framesPerSecond);\n      //if (!stream) throw Error('No stream!');\n      // create the recorder\n      this.rec = new MediaRecorder(stream, opts);\n      //if (!this.rec) throw Error('No MediaRecorder.');\n      // set callbacks\n      this.rec.ondataavailable = function(e) {\n        // save the video data (received in chunks)\n        chunks.push(e.data);\n      };\n      this.rec.onstop = (e) => {\n        // when the recording stops, save and return the combined blob\n        this.videoBlob = new Blob(chunks, { type: mimeType });\n        chunks = [];\n        this.isRecording = false;\n        this.rec = null;\n        return this.videoBlob;\n      };\n      this.rec.onstart = (e) => this.isRecording = true;\n      this.rec.onresume = (e) => this.isRecording = true;\n      this.rec.onpause = (e) => {\n        this.isRecording = false;\n        this.videoBlob = new Blob(chunks, { type: mimeType });\n      }\n      // begin recording\n      this.rec.start();\n    },\n    // stop recording canvas to video\n    stop: () => {\n      if (!this.isRecording) throw Error('No video is recording');\n      return this.rec.stop();\n    },\n    // download the recorded video data as a video file\n    saveAs: (filename) => {\n      setTimeout(() => {\n        if (this.isRecording) this.rec.stop();\n        if (!this.videoBlob) throw Error('No video to save');\n        downloadBlobAs(this.videoBlob, filename) // this.rec.stop() returns the final video as a blob;\n        this.videoBlob = null;\n      }, 64);\n    },\n    // pass the recorded canvas as a <video> to the given callback\n    toElement: (cb) => {\n      setTimeout(() => {\n        if (!this.videoBlob) throw Error('No video to export');\n        const video = document.createElement('video');\n        const { w, h }  = this;\n        video.width = w;\n        video.height = h;\n        video.crossOrigin = 'anonymous';\n        video.src = URL.createObjectURL(this.videoBlob);\n        video.load();\n        cb(video);\n      }, 64);\n    }\n  };\n\n  return;\n};\n\n\nexport default Ctx;\n","/**\n * Enable persistant storage using localStorage\n */\nconst storage = {\n\n  getItem: (c, state) => {\n    if (!c.store) return state;\n    // console.log('getItem:', c.store, state);\n    const s = JSON.parse(localStorage.getItem(c.store))\n    return s ? { ...state, ...s } : state;\n  },\n\n  setItem: (c, state) => {\n    if (!c.store) return state;\n\n    // if Component.syncTabs is available, also keep browser tabs in\n    // sync - syncTabs will create an event which monitors localStorage\n    // changes and re-renders the given component if it's storage changed.\n    if (!c.isNode && Component.syncTabs) {\n        window.syncTab  = window.syncTab || [];\n        if (!window.syncTab[c.uid]) Component.syncTabs(c)\n    }\n\n    localStorage.setItem(c.store, JSON.stringify(state))\n  }\n\n};\n\nexport default storage;\n","/**\n * Synchronize state updates and page renders between browser tabs\n * @param {func} c - the component to re-render when it's storage updates/changes\n */\nconst syncTabs = function(c) {\n  if (c.isNode || !window) return;\n  // the \"storage\" event fires when localStorage is updated\n  window.addEventListener('storage', function (event) {\n    // if the storage obj that changed is the given components \"store\",\n    // then add the new \"store\" data to the latest state\n    if (event.key === c.store) {\n      let newState = JSON.parse(event.newValue);\n      c.setState({ ...c.state, ...newState })\n    }\n  });\n  window.syncTab[c.uid] = true\n};\n\nexport default syncTabs;\n","/**\n  The useAudio() function uses lots of code and ideas from these projects:\n\n    - https://github.com/kittykatattack/sound.js\n    - https://github.com/madebywild/audioFX\n\n  To add more features or extend useAudio, take a look at\n    - https://github.com/chrisguttandin/standardized-audio-context (a \"ponyfill\" to improve cross-browser compatibility)\n    - https://github.com/mohayonao/pseudo-audio-param (automation of props over time)\n    - https://github.com/mohayonao/adsr-envelope\n    - https://github.com/rsimmons/fastidious-envelope-generator\n    - https://github.com/Theodeus/tuna\n\n*/\n\n\n\n/**\n * useAudio - main function, creates audio objects from a library of sounds, such as mp3 files\n *\n * param sounds - an Object containing the library of sounds to create (required)\n * param c      - the Component to attach the library of sounds to (optional)\n *\n */\nconst useAudio = function(sounds, c) {\n  // if not in browser, exit\n  if (!document || !window || typeof sounds !== 'object') return;\n\n  const isArr = Array.isArray;\n  // a \"no operation\" function, used as a default setting for some callbacks\n  const noop = function noop(){ return; };\n  // minimin vol (exponentialRampToValue method of web audio API gain nodes\n  // doesn't like zero as a input, for some reason)\n  const minGain = 0.00001;\n\n  // create the global \"audio context\", or hook into an existing one\n  const ctx = window.AudioContext || window.webkitAudioContext;\n  window.audioCtx = window.audioCtx ? window.audioCtx : new ctx();\n\n  // normalize browser syntax\n  if (!audioCtx.createGain) audioCtx.createGain = audioCtx.createGainNode;\n  if (!audioCtx.createDelay) audioCtx.createDelay = audioCtx.createDelayNode;\n  // if (!audioCtx.createScriptProcessor) audioCtx.createScriptProcessor = audioCtx.createJavaScriptNode;\n\n\n  // the library of the sounds Nodes returned by this function\n  const library = {};\n  // vars used as re-usable holders, accessed in various functions, and always\n  // represent the current item in the list of sounds passed into useAudio\n  let name = null;\n  let src = null;\n  let filters = false;\n  // the list of supported filters, listed in the order they are connected..\n  // note that not all of these need to be enabled\n  const filterList = [\n   'gain', 'panning', 'reverb', 'equalizer', 'lowpass',\n   'lowshelf', 'peaking', 'notch', 'highpass', 'highshelf', 'bandpass',\n   'allpass', 'compression', 'analyser'\n  ];\n  // store audio buffer objects in here, ready to be put into bufferSourceNodes,\n  // which are high performance \"fire and forget\" audio nodes with a start()\n  // method called by play() method\n  const cache = {};\n  // set the number of files that need to be loaded\n  window.totalFiles = window.totalFiles ? window.totalFiles : 0;\n  window.totalFiles += Object.keys(sounds).length;\n  // set the number of files loaded so far\n  window.loadedFiles = window.loadedFiles ? window.loadedFiles : 0;\n\n\n\n  // download the given audio file, decode it, save it as a buffer into\n  // cache[name], then run the given callback, which is fileLoaded()\n  const loadFile = (url, item) => {\n    // if we already cached it, use the cached one\n    if (cache[name]) {\n      fileLoaded(cache[name]);\n      return;\n    }\n    // else, create a AJAX request\n    const req = new XMLHttpRequest();\n    req.open(\"GET\", url);\n    req.responseType = \"arraybuffer\";\n    // once req is completed, run this func\n    req.onload = function() {\n      // decode the response data into a buffer object, and pass it to callback\n      let d = req.response;\n      audioCtx.decodeAudioData(d, function(buffer) {\n        // run onloaded the callback\n        fileLoaded(buffer, item);\n      });\n    };\n    // report the download progress\n    req.onprogress = function (e) {\n      let percent = 0;\n      if (e.lengthComputable) {\n        percent = (e.loaded / e.total) * 100;\n      }\n      document.dispatchEvent(new CustomEvent(\"audioProgress\", { detail: { percent, url } }));\n      return percent;\n    };\n    // send the request\n    req.send();\n  };\n\n\n\n  // the callback passed into loadFile, run once the given file has loaded,\n  // receives the file as a buffer\n  const fileLoaded = (buffer, item) => {\n    // cache the buffer object\n    cache[name] = cloneBuffer(buffer);\n    // add the current sound to the library of sounds to be returned (namely,\n    // add library[name] and populate it with all the sounds props)\n    library[name] = addToLibrary(item);\n    // add the .settings({ ... }) method, for updating a sounds props, to the\n    // library collection itself - calling it will update all sounds in the\n    // library object\n    library['settings'] = (props, cb) => {\n      // update all sounds\n      Object.keys(library).forEach(audioObj => {\n        if (!library[audioObj]) return;\n        if (audioObj === 'settings') return;\n        // update the sound object with the given properties\n        if (library[audioObj].settings) library[audioObj].settings(props);\n      });\n      // then run the callback, if any\n      if (typeof cb === 'function') cb(library[audioObj].state);\n      // make it chainable\n      return library;\n    };\n\n    // add to count of files now loaded and check if all done\n    checkAllFilesLoaded();\n    // autoplay if needed\n    if (library[name].autoplay === true) library[name].play();\n  };\n\n\n  // count each file downloaded via AJAX, check if num loaded matches total\n  const checkAllFilesLoaded = () => {\n    window.loadedFiles += 1;\n    // check if all files loaded\n    if (window.totalFiles === window.loadedFiles) {\n      document.dispatchEvent(new CustomEvent(\"audioLoaded\", { detail: library }));\n    }\n  };\n\n  // clone a buffer object, so we can save it to the cache before playing it\n  // (after which the buffer normally disappears and is garbage collected)\n  const cloneBuffer = inBuffer => {\n    let outBuffer = audioCtx.createBuffer(\n      inBuffer ? inBuffer.numberOfChannels : 2,\n      inBuffer ? inBuffer.length : 0,\n      inBuffer ? inBuffer.sampleRate : audioCtx.sampleRate\n    );\n    for (var i = 0, c = inBuffer.numberOfChannels; i < c; ++i) {\n      let od = outBuffer.getChannelData(i),\n        id = inBuffer.getChannelData(i);\n      od.set(id, 0);\n    }\n    return outBuffer;\n  }\n\n\n\n  // create the sound Object and add it to the library that we return\n  const addToLibrary = (item) => {\n    // library is the main object returned by useAudio(), and \"name\" is the\n    // name of the current sound object being added (\"name\" is defined in main\n    // loop near end of the script)\n\n    const obj = {\n      // set some properties\n      name,\n      src, // should be a string (URL to audio file), another sound object, or an array of sound objects\n      // the main methods\n      play,\n      playFrom,\n      pause,\n      fadeIn,\n      fadeOut,\n      rapidFire,\n      stop,\n      mute,\n      unmute,\n      connectTo,\n      // callbacks\n      onPlay: item[1].onPlay || noop,\n      onPause: item[1].onPause || noop,\n      onResume: item[1].onResume || noop,\n      onStop: item[1].onStop || noop,\n      onChange: item[1].onChange || noop,  // fired when a prop in state changes or sound is -reconnected\n      // set input node:\n      input: audioCtx.createBufferSource(),\n      // set output node:\n      // - output to the default output of the Audio Context all our sounds use\n      output: audioCtx.destination,\n      // set audio nodes:\n      // the actual audio nodes that will be connected and form the audio graph..\n      // this will be created by the play() method, and will include input/output\n      // above... NOTE: if defined, equaliser nodes end up in their own array,\n      // separate from this list of audio nodes, so that we can keep track of\n      // which nodes are used for what, and that the equaliser can be adjusted\n      // as a single \"thing\", via settings\n      audioNodes: [],\n      // set audio properties:\n      // all audio nodes have these settings applied to them where relevant,\n      // and the play(), pause() etc  methods check for and respect these\n      // settings. All filter settings will be added to state too. The state\n      // should be updated using the mySound.settings({ ... }) method.\n      state: {\n        isPlaying: false,                         // boolean\n        volume: item[1].volume || 1,              // 0 is slient, 1 is 100%, 2 is 200%\n        muted: item[1].muted || false,            // false is not muted\n        autoplay: item[1].autoplay || false,      // boolean\n        loop: item[1].loop || false,              // boolean\n        playbackRate: item[1].playbackRate || 1,  // 1 is normal speed, 2 is double speed\n        //detune: item[1].detune || 0,              // 1200 is up 1 octave, -1200 is down 1 octave\n        startTime: item[1].startTime || 0,        // start time of the sound, when played\n        startOffset: item[1].startOffset || 0,    // used to help track pause/resume/play times\n        //fadeIn: item[1].fadeIn || 0,              // duration in seconds\n        //fadeOut: item[1].fadeOut || 0,            // duration in seconds\n      },\n      // this is the mySound.settings() method... it allows updating the props\n      // of individual sounds with mySound.settings({ ... }) - pass in only\n      // the options you want to change.\n      settings: function(props, cb) {\n        // check if prop relates to an existing audio node or not\n        Object.keys(props).forEach(key => {\n          const rebuildNodes = filterList.indexOf(key) !== -1 && isDisabled(obj.state[key]) !== isDisabled(props[key]);\n          if (rebuildNodes) {\n            obj.state = { ...obj.state, ...props };\n            obj.audioNodes = createNodes(obj);\n            connectNodes(obj);\n            if (obj.state.isPlaying) obj.playFrom(audioCtx.currentTime);\n          }\n        });\n        obj.state = { ...obj.state, ...props };\n        randomiseSound(obj);\n        // update settings of each audio node\n        setupNodesFor(obj);\n        if (typeof cb === 'function') cb(obj.state);\n        // setting have changed, call the relevant callback\n        obj.onChange(obj.state);\n        // return the whole sound object\n        return obj;\n      },\n    };\n    // create all audio nodes that we need\n    obj.audioNodes = createNodes(obj);\n    return obj;\n  }\n\n\n  const randomiseSound = (soundObj) => {\n    const s = soundObj.state;\n    // randomise sound if need be\n    if (typeof s.randomization === 'object') {\n      const r = s.randomization;\n      if (r.volume) s.volume = s.volume + (Math.random() * r.volume);\n      if (r.playbackRate) s.playbackRate = s.playbackRate + (Math.random() * r.playbackRate);\n      if (r.startOffset) s.startOffset = s.startOffset + 1 * (0.01 + Math.random() * r.startOffset);\n      if (r.delay && getAudioNode(soundObj, 'delay')) s.delay = s.delay * (0.01 + Math.random() * r.delay);\n    }\n  }\n\n  // for each audio node in soundObj, apply settings from state - this function\n  // is called by the setting() method and play(), etc.\n  const setupNodesFor = (soundObj) => {\n    const s = soundObj.state;\n    // configure the input node\n    soundObj.input.loop = s.loop;\n    soundObj.input.playbackRate.value = s.playbackRate;\n    // for each sound property in soundObject.state\n    Object.keys(s).forEach(key => {\n      const nodeType = key === 'volume' ? 'gain' : key;\n      // get the audio node of type 'nodeType'\n      let node = getAudioNode(soundObj, nodeType);\n      // get opts/values of the current prop (key) in sound objects state\n      // set the value based on the property (key) in the state\n      if (node && !isDisabled(s[key])) {\n        setNodeProps(soundObj, node, s[key]);\n      }\n    });\n  };\n\n\n  // helper func - check if an audio node is disabled in the options\n  const isDisabled = n => n === undefined || n === null || n === false;\n\n  // create all audio nodes defined in sound settings, and return them in an array\n  const createNodes = (soundObj) => {\n    // define a list of all audio nodes needed in the chain\n    const graph = [\n      soundObj.input, // the input node\n    ];\n    // get filter opts\n    const filterNodes = {};\n    // always create a gain node, as they're not listed with the other filters\n    // in the config pass to us by user\n    const allFilters = {\n      gain: soundObj.state.volume,\n      ...filters,\n      ...soundObj.state,\n    };\n    // create a filter node for each one defined\n    Object.keys(allFilters).forEach(type => {\n      // get the options for this filter\n      const opts = allFilters[type];\n      // skip filter is no valid settings given\n      if (isDisabled(opts)) return;\n      // create filter and add to a list of all enabled filters\n      filterNodes[type] = createFilterNode(soundObj, type, opts);\n      // add filter settings to state\n      const prop = type === 'gain' ? 'volume' : type;\n      soundObj.state[prop] = opts;\n      if (filterNodes[type]) {\n        // set audio nodes props to match values in the sounds state\n        setNodeProps(soundObj, filterNodes[type], opts);\n      }\n    });\n    // now sort all filterNodes into the \"proper\" order\n    filterList.forEach(type => {\n      // attach the node in the list (type)\n      if (filterNodes[type] && type !== 'equalizer') {\n        graph.push(filterNodes[type]);\n      }\n      // add all the equalizer nodes, which are not in filterNodes,\n      // but in the soundObj.eq array\n      else if (type === 'equalizer' && isArr(soundObj.eq)) {\n        soundObj.eq.forEach(node => graph.push(node));\n      }\n    });\n    // add the output node to the graph\n    graph.push(soundObj.output)\n    return graph;\n  };\n\n\n  // create filter nodes of given \"type\", with options \"o\" for soundObject \"s\"\n  const createFilterNode = (s, type, o) => {\n    let n = undefined; // the node to return\n    switch (type) {\n      case 'gain':\n      case 'volume':\n        n = audioCtx.createGain();\n        break;\n      case 'panning':\n        if (!audioCtx.createStereoPanner) {\n          n = audioCtx.createPanner();\n        } else {\n          n = audioCtx.createStereoPanner();\n        }\n        break;\n      //case 'panning3d':\n      //  n = audioCtx.createPanner();\n      //  break;\n      case 'delay':\n        n = audioCtx.createDelay();\n        break;\n      case 'lowpass':\n      case 'highpass':\n      case 'bandpass':\n      case 'allpass':\n      case 'lowshelf':\n      case 'highshelf':\n      case 'peaking':\n      case 'notch':\n        n = audioCtx.createBiquadFilter();\n        break;\n      case 'equalizer':\n        // we need to return an \"audio node\" to put into our graph array, but\n        // we don't wanna create only one node for our equalizer, so\n        // return a fake node into the list, of type \"equalizer\", and add\n        // all the nodes we need to a separate array - we'll parse the fake\n        // node of type \"equalizer\" in setNodeProps(), and access it's array\n        // of nodes there\n        n = {\n          type: 'equalizer',\n        };\n        // create the array that holds each filter node (each is a eq band)\n        s.eq = [];\n        // each obj in o is a filter settings obj, so create an audio node\n        // for each one, with the correct type\n        //if (o && o.length && o.length > 0) {\n        o.forEach((eq, i) => {\n          const eqNode = audioCtx.createBiquadFilter();\n          if (i === 0) {\n            eqNode.type = 'lowpass';\n          }\n          else if (i === (o.length - 1)) {\n            eqNode.type = 'highpass';\n          }\n          else {\n            eqNode.type = 'peaking';\n          }\n          // add each audio node to the \"equalizer\" array\n          s.eq.push(eqNode);\n        });\n        //}\n        break;\n      case 'reverb':\n        n = audioCtx.createConvolver();\n        break;\n      case 'analyser':\n        n = audioCtx.createAnalyser();\n        break;\n      case 'compression':\n        n = audioCtx.createDynamicsCompressor();\n        break;\n      default:\n        break;\n    }\n    // set a type (used in createNodes() to filter node list)\n    if (n) n.type = type;\n    // return the audio node\n    return n;\n  };\n\n\n\n  // TODO smoother settings changes: also use \"linearRampToValueAtTime\", or \"exponentialRampToValueAtTime\"\n  // TODO clamp values between the min/max of the AudioParam type:\n  //        - gain: min  0, max  1\n  //        - pan: min  -1, max  1\n  //        - ..\n  // set the props of the given audio node (n) to match the values in the\n  // current sounds state options (o) for the given sound object (s)\n  const setNodeProps = (s, n, o) => {\n    const type = n.type;\n    const ct = audioCtx.currentTime;\n\n    // helper functions, to check and set filter values\n    const has = prop => typeof o === 'number' || typeof o[prop] === 'number';\n    const setVal = (prop, v) => n[prop].setValueAtTime(v, ct);\n    const setFreq = () => n.frequency.setValueAtTime(o.freq, ct);\n    const setGain = () => n.gain.setValueAtTime(o.gain, ct);\n    const setQ = () => n.Q.setValueAtTime(o.q, ct)\n\n    switch (type) {\n      case 'volume':\n      case 'gain':\n        // dont let \"v\" go below zero\n        let v = o <= 0 ? minGain : o;\n        // set to zero if muted\n        if (s.state.mute === true) v = minGain;\n        // update the node and state\n        //s.state.volume = v;\n        n.gain.setValueAtTime(v, ct);\n        //n.gain.value = v;\n        break;\n      case 'panning':\n        if (!audioCtx.createStereoPanner) {\n          //Panner objects accept x, y and z coordinates for 3D\n          //sound. However, because we're only doing 2D left/right\n          //panning we're only interested in the x coordinate,\n          //the first one. However, for a natural effect, the z\n          //value also has to be set proportionately.\n          const y = 0;\n          const z = 1 - Math.abs(o);\n          n.setPosition(o, y, z);\n          n.panValue = o;\n        } else {\n          setVal('pan', typeof o === 'number' ? o : 0);\n        }\n        //s.state.panning = o;\n        break;\n      //case 'panning3d':\n      //  // TODO\n      //  break;\n      case 'delay':\n        setVal('delayTime', typeof o === 'number' ? o : 0);\n        break;\n      case 'lowpass':\n      case 'highpass':\n      case 'bandpass':\n      case 'allpass':\n      case 'lowshelf':\n      case 'highshelf':\n      case 'peaking':\n      case 'notch':\n      \tif (has('freq')) setFreq();\n      \tif (has('gain')) setGain();\n      \tif (has('q')) setQ();\n        break;\n      case 'reverb':\n        if (o) {\n          // to allow only some props to be passed in let's merge `o` with defaults and state\n          const opts = { duration: 1, decay: 1, reverse: false, ...s.state.reverb, ...o };\n          // set the reverb\n          n.buffer = impulseResponse(opts.duration, opts.decay, opts.reverse);\n          // update state, so it contains all reverb settings\n          s.state.reverb = opts;\n        } else {\n          n.buffer = null;\n        }\n        break;\n      case 'equalizer':\n        // Note - the equalizer is an array of nodes, so don't set props on 'n',\n        // instead loop over the array and set props for each\n        if (isArr(s.eq)) {\n          // get each filter in equalizer, and apply the settings in 'opts'\n          o.forEach((opts, i) => {\n            const node = s.eq[i];\n            if (typeof opts.freq === 'number') {\n              node.frequency.value = opts.freq;\n//              node.frequency.setValueAtTime(opts.freq, ct);\n            }\n            if (typeof opts.gain === 'number') {\n              node.gain.value = opts.gain;\n//              node.gain.setValueAtTime(opts.gain, ct);\n            }\n            if (typeof opts.q === 'number') {\n              node.Q.value = opts.q;\n//              node.Q.setValueAtTime(opts.q, ct);\n            }\n          });\n        }\n        break;\n      case 'analyser':\n        if (has('fftSize')) n.fftSize = o.fftSize;\n        if (has('minDecibels')) n.minDecibels = o.minDecibels;\n        if (has('maxDecibels')) n.maxDecibels = o.maxDecibels;\n        if (has('smoothingTimeConstant')) n.smoothingTimeConstant = o.smoothingTimeConstant;\n        // now we add some useful props for visualisations to the sounds state:\n        // 1. add the analyser node to state\n        s.state.visualiser = n;\n        break;\n      case 'compression':\n        if (has('threshold')) setVal('threshold', o.threshold);\n        if (has('knee')) setVal('knee', o.knee);\n        if (has('ratio')) setVal('ratio', o.ratio);\n        if (has('attack')) setVal('attack', o.attack);\n        if (has('release')) setVal('release', o.release);\n        break;\n      default:\n        break;\n    }\n  }\n\n\n\n  // public method on soundObjs\n  // play the sound\n  const play = () => {\n    const s = library[name];\n    const state = s.state;\n    // get the input node\n    const input = audioCtx.createBufferSource();\n    // set the sound nodes buffer property to the (down)loaded sound\n    input.buffer = cloneBuffer(cache[name]);\n    // randomise sound if need be\n    randomiseSound(s);\n    // configure the input node\n    input.loop = state.loop;\n    input.playbackRate.value = state.playbackRate;\n    //input.detune.value += state.detune;\n    s.input = input;\n    // create the nodes\n    s.audioNodes = createNodes(s);\n    // now connect the audio nodes, in the proper order\n    connectNodes(s);\n    // set all properties on the relevent audio nodes to match the sounds \"state\"\n    setupNodesFor(s); // not needed...?\n    // normalize for better browser support\n    if (!input.start) input.start = input.noteOn;\n    // play the sound\n    input.start(state.startTime, state.startOffset % input.buffer.duration);\n    state.isPlaying = true;\n    // play any other sounds which have been \"connected\" to this one\n    if (isArr(s.attachedSounds)) {\n      s.attachedSounds.forEach(snd => {\n        if (!snd.state.isPlaying) snd.playFrom(audioCtx.currentTime);\n      });\n    }\n    // enable fade in if needed\n    if (typeof state.fadeIn === 'number' && state.fadeIn > 0) {\n      fadeIn(state.fadeIn);\n    }\n    // run the callbacks\n    if (state.startOffset === 0) s.onPlay(state);\n    if (state.startOffset > 0) s.onResume(state);\n  };\n\n\n  // internal method, used by play(), rapidFire(), to connect up the audio nodes\n  // before playing the sound\n  const connectNodes = (soundObj) => {\n    // connect all enabled audio nodes\n    soundObj.audioNodes.forEach((n, i) => {\n      const curr = n;\n      const next = soundObj.audioNodes[i + 1];\n      const prev =  i > 0 ? soundObj.audioNodes[i - 1] : null;\n      if (curr && next && curr.connect) {\n        // if next node is the equalizer, connect the equalizer nodes\n        if (next.type === 'equalizer') {\n          curr.connect(soundObj.eq[0]);\n          // go through each eq node and connect them up\n          soundObj.eq.forEach((eqNode, num) => {\n            if (soundObj.eq[num] && soundObj.eq[num + 1]) {\n              soundObj.eq[num].connect(soundObj.eq[num + 1]);\n            }\n          });\n        }\n        else if (prev && prev.type === 'equalizer') {\n          // if prev node was the equalizer, connect its last node up to\n          // the current node in the list\n          soundObj.eq[soundObj.eq.length - 1].connect(curr);\n          curr.connect(next);\n        } else {\n          // no need to connect to/from equaliser, so just connect up the\n          // current node \"curr\" to \"next\" node\n          curr.connect(next);\n        }\n      }\n    });\n  };\n\n  // public method on soundObjs - play a sound multiple times\n  // param \"count\"    number of times to play the sound\n  // param \"delay\"    number of milliseconds delay between in play\n  const rapidFire = (count, delay) => {\n    const num = count ? count : 3;\n    const dly = delay ? delay : 200;\n    // Make multiple sources using the same buffer and play in quick succession.\n    for (let i = 0; i < num; i++) {\n      // disable looping for this sound while rapid firing\n      const loopSetting = library[name].state.loop;\n      library[name].state.loop = false;\n      setTimeout(play, dly);\n      // restore loop setting\n      library[name].state.loop = loopSetting;\n    }\n  }\n\n\n  // public method on soundObjs\n  const pause = () => {\n      //Pause the sound if it's playing, and calculate the\n      //`startOffset` to save the current position.\n      if (library[name].state.isPlaying) {\n        library[name].state.startOffset = audioCtx.currentTime - library[name].state.startTime;\n        library[name].input.stop(0);\n        library[name].state.isPlaying = false;\n        // run the callback\n        library[name].onPause(library[name].state);\n        // pause any other sounds which have been \"connected\" to this one\n        if (isArr(library[name].attachedSounds)) {\n          library[name].attachedSounds.forEach(snd => {\n            if (snd.state.isPlaying) snd.pause();\n          });\n        }\n      }\n  };\n\n\n  // public method on soundObjs\n  const playFrom = (time) => {\n      try {\n        library[name].input.stop(0);\n      } catch (e) {};\n      library[name].state.startOffset = time;\n      library[name].play();\n  };\n\n\n  // public method on soundObjs\n  const stop = () => {\n    //Stop the sound if it's playing, reset the start and offset times,\n    //then call the `play` method again.\n    if (library[name].state.isPlaying) {\n      library[name].input.stop(0);\n      library[name].state.isPlaying = false;\n      library[name].state.startOffset = 0;\n      // run the callback\n      library[name].onStop(library[name].state);\n      // stop any other sounds which have been \"connected\" to this one\n      if (isArr(library[name].attachedSounds)) {\n        library[name].attachedSounds.forEach(snd => {\n          if (snd.state.isPlaying) snd.stop();\n        });\n      }\n    }\n  };\n\n  // public method on soundObjs\n  const mute = () => {\n    // set a previous volume, so we can restore it\n    library[name].state.prevVol = library[name].state.volume;\n    library[name].settings({\n      volume: 0,\n      muted: true,\n    });\n    // mute any other sounds which have been \"connected\" to this one\n    if (isArr(library[name].attachedSounds)) {\n      library[name].attachedSounds.forEach(snd => {\n        if (snd.state.isPlaying) snd.mute();\n      });\n    }\n  }\n\n  // public method on soundObjs\n  const unmute = () => {\n    library[name].settings({\n      volume: library[name].state.prevVol,\n      prevVol: undefined,\n      muted: false,\n    });\n    // unmute any other sounds which have been \"connected\" to this one\n    if (isArr(library[name].attachedSounds)) {\n      library[name].attachedSounds.forEach(snd => {\n        if (snd.state.isPlaying) snd.unmute();\n      });\n    }\n  }\n\n\n  // public method on soundObjs\n  // method added to sound object to let users re-connect sounds, by doing\n  // soundObj.connectTo(otherSoundObj);\n  const connectTo = (otherSound) => {\n    // update the sound props to output to the other sound\n    otherSound.attachedSounds = otherSound.attachedSounds || [];\n    otherSound.attachedSounds.push(library[name]);\n    // setting have changed, call the relevant callback\n    library[name].onChange(library[name].state);\n  };\n\n\n  // helper func to get an audio node by type (useAudio always add a type\n  // property to audio nodes, even if they don't normally have them)\n  const getAudioNode = (soundObj, type) => {\n    if (!soundObj.audioNodes) return;\n    return soundObj.audioNodes.filter(n => n.type === type)[0];\n  };\n\n  // public method on soundObjs\n  const fadeIn = function(durationInSeconds, endVol) {\n      if (!library[name].state.isPlaying) library[name].play();\n      fade(endVol ? endVol : 1, durationInSeconds);\n  };\n\n\n  // public method on soundObjs\n  const fadeOut = function (durationInSeconds) {\n      fade(minGain, durationInSeconds);\n  };\n\n\n  // helper func called by fadeIn() and fadeOut()\n  const fade = function (endValue, durationInSeconds) {\n      const gn = getAudioNode(library[name], 'gain');\n      const ct = audioCtx.currentTime;\n      const s = library[name].state;\n      // set the value to transition *from*\n      gn.gain.value = s.volume;\n      if (s.isPlaying) {\n        gn.gain.setValueAtTime(s.volume, ct);\n        // now the values to transition *to*\n        gn.gain.exponentialRampToValueAtTime(endValue, ct + durationInSeconds);\n        s.volume = endValue;\n      }\n  };\n\n\n  // simulate a model of sound reverberation in an acoustic space which\n  // a convolver node can blend with the source sound.\n  function impulseResponse(duration, decay, reverse) {\n    //The length of the buffer.\n    const length = audioCtx.sampleRate * duration;\n    //Create an audio buffer to store the reverb effect.\n    const impulse = audioCtx.createBuffer(2, length, audioCtx.sampleRate);\n    //Use `getChannelData` to initialize empty arrays to store sound data for\n    //the left and right channels.\n    const left  = impulse.getChannelData(0);\n    const right = impulse.getChannelData(1);\n    //Loop through each sample-frame and fill the channel\n    //data with random noise.\n    let n;\n    if (reverse) {\n      //Apply the reverse effect, if `reverse` is `true`.\n      for (let i = 0; i < length; i++) {\n        n = length - i;\n        let multi = Math.pow(1 - n / length, decay)\n        left[n] = (Math.random() * 0.5) * multi;\n        right[n] = (Math.random() * 0.5) * multi;\n      }\n    } else {\n      for (let i = 0; i < length; i++) {\n        n = i;\n        let multi = Math.pow(1 - n / length, decay)\n        left[i] = (Math.random() * 0.5) * multi;\n        right[i] = (Math.random() * 0.5) * multi;\n      }\n    }\n    //Return the `impulse`.\n    return impulse;\n  }\n\n\n  //\n  // MAIN LOOP - parse each sound given in 'sounds' param\n  //\n  Object.entries(sounds).forEach(item => {\n    // work out some info about the sound\n    const hasFilters = typeof item[1] === 'object' && typeof item[1].filters === 'object';\n    name = item[1].name || item[0];\n    src = item[1].src || item[1];\n    filters = hasFilters ? item[1].filters : undefined;\n    // create the sound object for \"item\"\n    library[name] = null;\n    // create an item in cache that will hold a  buffer, in which we will store\n    // the audio data returned from an AJAX request\n    cache[name] = null;\n    // download audio file, save it as a buffer in the fileLoaded() callback,\n    // then add the sound to the library to be returned\n    loadFile(src, item);\n  });\n\n  // attach all our sounds to the given component, if any\n  if (c) c.audio = library;\n\n  // return all the sounds\n  return library;\n};\n\n\n// finally, export the main function\n//\nexport default useAudio;\n","const onScroll = (fn, c) => {\n  if (!document) return;\n\n  const cb = function() {\n    // get document bounds\n    const pageBounds = document.body.getBoundingClientRect();\n    // get guideline (marker) position\n    const offset = c.onScroll.offset || 35;\n    const guideline = document.documentElement.clientHeight / 100 * offset; // 50% of page height\n    // debounce scroll updates to 60fps\n    requestAnimationFrame(totalFrames => {\n      // get component position, relative to guideline (marker)\n      const bounds = c.html.getBoundingClientRect();\n      const outside = bounds.top > guideline || bounds.bottom < guideline;\n      let progress = (guideline - bounds.top) / bounds.height;\n      if (bounds.top >= guideline) progress = 0;\n      if (bounds.bottom <= guideline) progress = 1;\n      c.onScroll.frame = !outside ? (c.onScroll.frame || 0) + 1 : 0;\n      //\n      let direction = null;\n      if (c.onScroll.frame !== 0) {\n        direction = c.onScroll.prevPos < progress ? 'down' : 'up'\n      }\n      // setup the props to return\n      const scrollProps = {\n        frame: c.onScroll.frame,\n        totalFrames: +totalFrames.toFixed(0),\n        progress: +progress.toFixed(2),\n        direction: direction,\n      };\n      // run the given function, pass in current scroll props\n      fn(scrollProps)\n      c.onScroll.prevPos = progress;\n    });\n  };\n\n  if (!c.onScroll.ready) {\n    window.addEventListener('scroll', cb);\n    c.onScroll.ready = true;\n  }\n}\n\nexport default onScroll;\n","// adapted from https://github.com/robertcorponoi/deltaframe-extra\n\n;(\"use strict\")\n\n\nclass RAF {\n  id = 0;\n  running = false;\n  fn = () => {};\n  usingSetTimeout = false;\n\n  constructor() {\n    const self = this;\n    window.requestAnimationFrame = window.requestAnimationFrame || window.webkitRequestAnimationFrame || function (f) { return setTimeout(f, 1000 / 60) };\n    window.cancelAnimationFrame = window.cancelAnimationFrame || window.webkitCancelAnimationFrame || function () { clearTimeout(self.id) }\n  }\n\n  start(fn, forceSetTimeout) {\n    if (this.running) return;\n    this.running = true;\n    this.fn = fn;\n    if (forceSetTimeout) {\n      this.usingSetTimeout = true;\n      this.updateTimeout();\n    }\n    else {\n      window.requestAnimationFrame((time) => this.updateRAF(time));\n    }\n  }\n\n  updateRAF(timestamp) {\n    this.running = true;\n    this.fn(timestamp);\n    this.id = window.requestAnimationFrame((time) => this.updateRAF(time));\n  }\n\n  updateTimeout() {\n    let timestamp = window.performance.now();\n    this.fn(timestamp);\n    this.id = window.setTimeout(() => this.updateTimeout(), 1000 / 60);\n  }\n\n  restart() {\n    if (this.usingSetTimeout) {\n      window.clearTimeout(this.id);\n    }\n    else {\n      window.cancelAnimationFrame(this.id);\n    }\n    this.id = 0;\n    this.running = false;\n    if (this.usingSetTimeout) {\n      this.updateTimeout();\n    }\n    else {\n      window.requestAnimationFrame((time) => this.updateRAF(time));\n    }\n    this.running = true;\n  }\n\n  stop() {\n    if (this.usingSetTimeout) {\n      window.clearTimeout(this.id);\n    }\n    else {\n      window.cancelAnimationFrame(this.id);\n    }\n    this.id = 0;\n    this.running = false;\n    this.fn = () => {};\n    return;\n  }\n}\n\nclass Options {\n  minFps = 15;\n  targetFps = 60;\n  maxRestarts = Infinity;\n  runTime = Infinity;\n  forceSetTimeout = false;\n  autoResume = true;\n\n  constructor(options = {}) {\n    Object.assign(this, options);\n  }\n\n  get minFpsCalc() {\n    return Math.floor(1000 / this.minFps);\n  }\n\n  get targetFpsCalc() {\n    return Math.floor(1000 / this.targetFps);\n  }\n}\n\nexport default class onLoop {\n  _options;\n  _restartAttempts;\n  _running;\n  _paused;\n  _fn;\n  _c;\n  _raf;\n  _frame;\n  _time;\n  _prevTime;\n  _delta;\n  _deltaAverage;\n  _deltaHistory;\n  _deltaIndex;\n  _hidden;\n\n  constructor(options, fn, c) {\n    this._options = new Options(options);\n    this._restartAttempts = 0;\n    this._running = false;\n    this._paused = false;\n    this._fn = fn;\n    this._c = c;\n    this._frame = 0;\n    this._time = 0;\n    this._prevTime = 0;\n    this._delta = 0;\n    this._deltaAverage = 0;\n    this._deltaHistory = [];\n    this._deltaIndex = 0;\n    this._raf = new RAF();\n    this._hidden = document.hidden;\n    this._boot();\n  }\n\n  get timesRestarted() { return this._restartAttempts; }\n\n  get isRunning() { return this._running; }\n\n  get isPaused() { return this._paused; }\n\n  get frame() { return this._frame; }\n\n  get time() { return this._time; }\n\n  start() {\n    this._prevTime = 0;\n    this._running = true;\n    this._raf.start((timestamp) => this._update(timestamp), this._options.forceSetTimeout);\n  }\n\n  pause() {\n    this._paused = true;\n    this._running = false;\n  }\n\n  resume() {\n    this._paused = false;\n    this._prevTime = window.performance.now();\n    this._running = true;\n  }\n\n  stop() {\n    this._restartAttempts = 0;\n    this._running = false;\n    this._paused = false;\n    this._fn = () => {};\n    this._frame = 0;\n    this._time = 0;\n    this._prevTime = 0;\n    this._delta = 0;\n    this._deltaHistory = [];\n    this._deltaIndex = 0;\n    document.removeEventListener('visibilitychange', () => this._visibilityChange);\n    this._raf.stop();\n    return;\n  }\n\n  _boot() {\n    document.addEventListener(\"visibilitychange\", () => this._visibilityChange());\n  }\n\n  _update(timestamp) {\n    if (this._paused) return;\n\n    if (timestamp >= this._options.runTime) {\n      this.stop();\n      return;\n    }\n\n    this._time = timestamp;\n\n    this._delta = timestamp - this._prevTime;\n\n    if (this._deltaIndex === 10) this._deltaIndex = 0;\n\n    this._deltaHistory[this._deltaIndex] = this._delta;\n\n    this._deltaIndex++;\n\n    let mean = 0;\n\n    for (let i = 0; i < this._deltaHistory.length; ++i) mean += this._deltaHistory[i];\n\n    mean /= 10;\n\n    this._deltaAverage = mean;\n\n    if (this._deltaAverage >= this._options.minFpsCalc) {\n      if (this._restartAttempts === this._options.maxRestarts) {\n        this.stop();\n\n        return;\n      }\n\n      this._raf.restart();\n\n      this._restartAttempts++;\n    }\n\n    if (this._deltaAverage >= this._options.targetFpsCalc) {\n      this._frame++;\n\n      this._fn(this._c.state, this._delta, this._deltaAverage, timestamp);\n\n      this._prevTime = timestamp;\n    }\n  }\n\n  _visibilityChange() {\n    const visibility = document.visibilityState;\n    if (this.isPaused && this._options.autoResume && visibility === 'visible') this.resume();\n    else if (this.isRunning && visibility === 'hidden') this.pause();\n  }\n}\n","// Taken from: \n// https://github.com/getify/TNG-Hooks/blob/master/src/tng-hooks.src.js\n\n// Changes: \n// 1. main function renamed to useHooks()\n// 2. added useDeferred and useThrottle from forks\n\n(function UMD(context,definition){\n  /* istanbul ignore next */if (typeof define === \"function\" && define.amd) { define(definition); }\n  /* istanbul ignore next */else if (typeof module !== \"undefined\" && module.exports) { module.exports = definition(); }\n  /* istanbul ignore next */else { Object.assign(context,definition()); }\n})(this,function DEF(){\n  \"use strict\";\n\n  var buckets = new WeakMap();\n  var tngStack = [];\n\n  return {\n    useHooks, useState, useReducer, useEffect,\n    useMemo, useCallback, useRef, useDeferred,\n    useThrottle\n  };\n\n\n  // ******************\n\n  function useHooks(...fns) {\n    fns = fns.map(function mapper(fn){\n      tngf.reset = reset;\n      return tngf;\n\n\n      // ******************\n\n      function tngf(...args) {\n        tngStack.push(tngf);\n        var bucket = getCurrentBucket();\n        bucket.nextStateSlotIdx = 0;\n        bucket.nextEffectIdx = 0;\n        bucket.nextMemoizationIdx = 0;\n\n        try {\n          return fn.apply(this,args);\n        }\n        finally {\n          // run (cleanups and) effects, if any\n          try {\n            runEffects(bucket);\n          }\n          finally {\n            tngStack.pop();\n          }\n        }\n      }\n\n      function runEffects(bucket) {\n        for (let [idx,[effect,guards]] of bucket.effects.entries()) {\n          try {\n            if (typeof effect == \"function\") {\n              effect();\n            }\n          }\n          finally {\n            bucket.effects[idx][0] = undefined;\n          }\n        }\n      }\n\n      function reset() {\n        tngStack.push(tngf);\n        var bucket = getCurrentBucket();\n        try {\n          // run all pending cleanups\n          for (let cleanup of bucket.cleanups) {\n            if (typeof cleanup == \"function\") {\n              cleanup();\n            }\n          }\n        }\n        finally {\n          tngStack.pop();\n          bucket.stateSlots.length = 0;\n          bucket.effects.length = 0;\n          bucket.cleanups.length = 0;\n          bucket.memoizations.length = 0;\n          bucket.nextStateSlotIdx = 0;\n          bucket.nextEffectIdx = 0;\n          bucket.nextMemoizationIdx = 0;\n        }\n      }\n    });\n\n    return (fns.length < 2) ? fns[0] : fns;\n  }\n\n\n  function getCurrentBucket() {\n    if (tngStack.length > 0) {\n      let tngf = tngStack[tngStack.length - 1];\n      let bucket;\n      if (!buckets.has(tngf)) {\n        bucket = {\n          nextStateSlotIdx: 0,\n          nextEffectIdx: 0,\n          nextMemoizationIdx: 0,\n          stateSlots: [],\n          effects: [],\n          cleanups: [],\n          memoizations: [],\n        };\n        buckets.set(tngf,bucket);\n      }\n\n      return buckets.get(tngf);\n    }\n  }\n\n  function useState(initialVal) {\n    var bucket = getCurrentBucket();\n    // console.log('useState:bucket', bucket);\n    if (bucket) {\n      const reducer = function reducer(prevVal,vOrFn) {\n        // console.log('useState:reducer', prevVal,vOrFn);\n        return typeof vOrFn == \"function\" ?\n          vOrFn(prevVal) :\n          vOrFn;\n      };\n      return useReducer(reducer,initialVal);\n    }\n    else {\n      throw new Error(\"useState() only valid inside an Articulated Function or a Custom Hook.\");\n    }\n  }\n\n  function useThrottle(fn, timer, ...guards) {\n    if(!fn) { throw new TypeError('useThrottle() requires a function argument')}\n    if(!timer) { throw new TypeError('useThrottle() requires a timer argument')}\n\n    var bucket = getCurrentBucket();\n    if (bucket) {\n      const [slot] = useState({fn, timer, lastExecute: 0});\n\n      if (guards.length > 0) {\n        if (guards.length === 1 && Array.isArray(guards[0])) {\n          guards = guards[0];\n        }\n      }\n\n      if (!slot.throttledFn || guardsChanged(slot.guards, guards)) {\n        slot.guards = guards;\n        slot.timer = timer;\n        slot.fn = fn;\n        slot.throttledFn =  function throttledFunction(...args) {\n          const {fn, timer, lastExecute} = slot;\n          const currentTime = Date.now();\n\n          if(lastExecute + timer < currentTime) {\n            try {\n              fn.apply(this, args);\n            } finally {\n              slot.lastExecute = currentTime;\n            }\n          }\n        };\n      }\n\n      return slot.throttledFn;\n\n    }\n    else {\n      throw new Error(\"useThrottle() only valid inside an Articulated Function or a Custom Hook.\");\n    }\n  }\n\n  function useReducer(reducerFn,initialVal,...initialReduction) {\n    var bucket = getCurrentBucket();\n    if (bucket) {\n      // need to create this state-slot for this bucket?\n      if (!(bucket.nextStateSlotIdx in bucket.stateSlots)) {\n        let slot = [\n          typeof initialVal == \"function\" ? initialVal() : initialVal,\n          function updateSlot(v){\n            slot[0] = reducerFn(slot[0],v);\n          },\n        ];\n        bucket.stateSlots[bucket.nextStateSlotIdx] = slot;\n\n        // run the reducer initially?\n        if (initialReduction.length > 0) {\n          bucket.stateSlots[bucket.nextStateSlotIdx][1](initialReduction[0]);\n        }\n      }\n\n      return [...bucket.stateSlots[bucket.nextStateSlotIdx++]];\n    }\n    else {\n      throw new Error(\"useReducer() only valid inside an Articulated Function or a Custom Hook.\");\n    }\n  }\n\n  // NOTE: both `guards1` and `guards2` are either\n  //    `undefined` or an array\n  function guardsChanged(guards1,guards2) {\n    // either guards list not set?\n    if (guards1 === undefined || guards2 === undefined) {\n      // force assumption of change in guards\n      return true;\n    }\n\n    // guards lists of different length?\n    if (guards1.length !== guards2.length) {\n      // guards changed\n      return true;\n    }\n\n    // check guards lists for differences\n    //    (only shallow value comparisons)\n    for (let [idx,guard] of guards1.entries()) {\n      if (!Object.is(guard,guards2[idx])) {\n        // guards changed\n        return true;\n      }\n    }\n\n    // assume no change in guards\n    return false;\n  }\n\n  function useEffect(fn,...guards) {\n    // passed in any guards?\n    if (guards.length > 0) {\n      // only passed a single guards list?\n      if (guards.length == 1 && Array.isArray(guards[0])) {\n        guards = guards[0];\n      }\n    }\n    // no guards passed\n    // NOTE: different handling than an empty guards list like []\n    else {\n      guards = undefined;\n    }\n\n    var bucket = getCurrentBucket();\n    if (bucket) {\n      // need to create this effect-slot for this bucket?\n      if (!(bucket.nextEffectIdx in bucket.effects)) {\n        bucket.effects[bucket.nextEffectIdx] = [];\n      }\n\n      let effectIdx = bucket.nextEffectIdx;\n      let effect = bucket.effects[effectIdx];\n\n      // check guards?\n      if (guardsChanged(effect[1],guards)) {\n        // define effect handler\n        effect[0] = function effect(){\n          // run a previous cleanup first?\n          if (typeof bucket.cleanups[effectIdx] == \"function\") {\n            try {\n              bucket.cleanups[effectIdx]();\n            }\n            finally {\n              bucket.cleanups[effectIdx] = undefined;\n            }\n          }\n\n          // invoke the effect itself\n          var ret = fn();\n\n          // cleanup function returned, to be saved?\n          if (typeof ret == \"function\") {\n            bucket.cleanups[effectIdx] = ret;\n          }\n        };\n        effect[1] = guards;\n      }\n\n      bucket.nextEffectIdx++;\n    }\n    else {\n      throw new Error(\"useEffect() only valid inside an Articulated Function or a Custom Hook.\");\n    }\n  }\n\n  function useMemo(fn,...inputGuards) {\n    // passed in any input-guards?\n    if (inputGuards.length > 0) {\n      // only passed a single inputGuards list?\n      if (inputGuards.length == 1 && Array.isArray(inputGuards[0])) {\n        inputGuards = inputGuards[0];\n      }\n    }\n    // no input-guards passed\n    // NOTE: different handling than an empty inputGuards list like []\n    else {\n      // the function itself is then used as the only input-guard\n      inputGuards = [fn];\n    }\n\n    var bucket = getCurrentBucket();\n    if (bucket) {\n      // need to create this memoization-slot for this bucket?\n      if (!(bucket.nextMemoizationIdx in bucket.memoizations)) {\n        bucket.memoizations[bucket.nextMemoizationIdx] = [];\n      }\n\n      let memoization = bucket.memoizations[bucket.nextMemoizationIdx];\n\n      // check input-guards?\n      if (guardsChanged(memoization[1],inputGuards)) {\n        try {\n          // invoke the to-be-memoized function\n          memoization[0] = fn();\n        }\n        finally {\n          // save the new input-guards\n          memoization[1] = inputGuards;\n        }\n      }\n\n      bucket.nextMemoizationIdx++;\n\n      // return the memoized value\n      return memoization[0];\n    }\n    else {\n      throw new Error(\"useMemo() only valid inside an Articulated Function or a Custom Hook.\");\n    }\n  }\n\n  function useCallback(fn,...inputGuards) {\n    if (getCurrentBucket()) {\n      return useMemo(function callback(){ return fn; },...inputGuards);\n    }\n    else {\n      throw new Error(\"useCallback() only valid inside an Articulated Function or a Custom Hook.\");\n    }\n  }\n\n  function useRef(initialValue) {\n    if (getCurrentBucket()) {\n      // create a new {} object with a `current` property,\n      // save it in a state slot\n      var [ref] = useState({ current: initialValue, });\n      return ref;\n    }\n    else {\n      throw new Error(\"useRef() only valid inside an Articulated Function or a Custom Hook.\");\n    }\n  }\n\n  function useDeferred() {\n    if (getCurrentBucket()) {\n      const [deferred] = useState((function () {\n        let resolve, reject;\n        let pr = new Promise((res, rej) => {\n          resolve = res;\n          reject = rej;\n        })\n\n        return { pr, resolve, reject }\n      })())\n\n      return deferred\n    } else {\n      throw new Error(\"useDeferred() only valid inside an Articulated Function or a Custom Hook.\")\n    }\n  }\n\n});\n"],"names":["domDiff","t","s","d","document","job","cfg","orig","[object Object]","v","createElement","innerHTML","vHTML","content","firstChild","nextElementSibling","nodeName","this","loop","parentElement","replaceChild","tn","sn","tOrig","checkNew","checkNodeName","checkCtx","nodeType","checkAttrs","childNodes","lengthDiff","Array","apply","forEach","node","idx","n","cloneNode","attrs","attributes","filteredAttrs","Object","keys","map","attrsNew","filteredAttrsNew","o","getAttribute","name","setAttribute","removeAttribute","a","nodeValue","textContent","tParent","undefined","newNode","appendChild","removeChild","create","replace","Component","state","schema","c","setState","container","C","validator","emitter","tweenState","springTo","strg","storage","useAudio","onScroll","onLoop","Ctx","devtools","cache","memo","f","O","R","RegExp","timeout","w","raf","reactive","immutable","debug","scopedCss","i","log","id","action","length","view","props","middleware","uid","Math","random","toString","split","isNode","process","versions","window","requestAnimationFrame","css","head","actions","actionsList","axn","newState","freeze","isFrozen","k","eq","x","y","ok","tx","every","key","String","nextState","done","pState","getItem","err","msg","console","error","Error","JSON","stringify","prev","setItem","render","ctx","cancelAnimationFrame","tt","logFn","setTimeout","push","emit","fn","start","stop","pause","resume","on","ev","once","off","go","num","dir","rw","ff","setCss","style","st","p","u","className","fx1","fx2","fx3","fx","minCss","outerHTML","parse","isArray","toStr","el","ctxType","html","querySelector","getContext","firstElementChild","append","populateUI","sjComponents","sel","now","require","performance","root","global","vendors","suffix","caf","last","queue","callback","_now","next","max","cp","slice","cancelled","e","round","handle","module","exports","call","cancel","arguments","polyfill","object","easing","linear","inQuad","outQuad","inOutQuad","inCubic","outCubic","inOutCubic","inQuart","outQuart","inOutQuart","inQuint","outQuint","inOutQuint","inElastic","sin","outElastic","inOutElastic","inSin","PI","outSin","inOutSin","inExpo","pow","outExpo","inOutExpo","scaledTime","scaledTime1","inBack","magnitude","m","outBack","inOutBack","scaledTime2","noop","Date","Tween","context","_c","ease","onUpdate","onComplete","delay","duration","paused","_proto","prototype","startTime","step","from","to","easeFn","elapsed","frame","progress","min","value","values","val","index","Number","isNaN","addValues","array","self","onStart","shouldSetState","onSetState","frameTotal","ceil","stateToTween","entries","entry","getStateToTween","startValuesArr","endValuesArr","vals","tweenedState","reduce","reducer","obj","shift","_evs","splice","indexOf","strings","funcs","str","match","join","trim","hasOwnProperty","htmel","out","elems","children","q","attr","addEventListener","ctxMethods","ctxProps","chainMethod","scope","chainReturn","chainProperty","propName","PIXEL_RATIO","devicePixelRatio","PIx2","PIo2","RAD2DEG","DEG2RAD","downloadBlobAs","blob","url","URL","createObjectURL","fileName","valueOf","target","href","download","click","revokeObjectURL","extraMethods","clear","resetTransform","setTransform","clearRect","canvas","width","height","fullscreen","fullscreenElement","exitFullscreen","requestFullscreen","isClean","getImageData","size","h","objectFit","contextType","scale","camera","degrees","translate","rotate","chromaKey","tolerance","color","imageData","data","diff","l","abs","putImageData","line","px","py","dashPattern","beginPath","save","setLineDash","moveTo","lineTo","closePath","fill","stroke","restore","circle","r","deg","antiClockwise","arc","fillCircle","radius","strokeCircle","ellipse","kappa","ox","oy","xe","xm","ye","ym","bezierCurveTo","fillEllipse","strokeEllipse","ring","innerRadius","outerRadius","fillRing","strokeRing","gradientCircle","r2","offsetX","offsetY","fillSteps","fillGradient","createRadialGradient","addColorStop","fillStyle","gradientRect","horiz","createLinearGradient","fillRect","roundedRect","arcTo","fillRoundedRect","strokeRoundedRect","polygon","points","point","fillPolygon","polyshape","strokePolygon","position","sides","angle","j","cos","fillPolyshape","strokePolyshape","star","wobble","fillStar","strokeStar","square","rect","triangle","fillTriangle","strokeTriangle","curve","tension","numOfSeg","close","pts","res","Float32Array","cachePtr","unshift","st2","st3","st23","st32","pt1","pt2","pt3","pt4","t1x","t1y","t2x","t2y","lineWidth","strokeStyle","strokeColor","drawGridBox","checkerboard","gridSize","colorA","colorB","ty","cacheImg","dx","dy","dWidth","dHeight","Image","onload","drawImage","crossOrigin","drawImg","src","includes","encodeURIComponent","setStyle","angleFromPoints","x1","x2","y1","y2","atan2","angleToTarget","clamp","distance","sqrt","seededRandom","imul","charCodeAt","seed","rand","decimal","floor","arr","rotateAt","toRad","toDeg","rad","extraMethodNames","origCtx","curProp","chunks","supportedType","types","MediaRecorder","isTypeSupported","getVideoMimeType","image","saveAs","toBlob","toElement","cb","img","toDataURL","video","record","fps","mimeType","audioBitsPerSecond","videoBitsPerSecond","isRecording","framesPerSecond","opts","stream","captureStream","rec","ondataavailable","onstop","videoBlob","Blob","type","onstart","onresume","onpause","filename","load","store","localStorage","syncTabs","syncTab","event","newValue","sounds","isArr","AudioContext","webkitAudioContext","audioCtx","createGain","createGainNode","createDelay","createDelayNode","library","filters","filterList","totalFiles","loadedFiles","fileLoaded","buffer","item","cloneBuffer","addToLibrary","audioObj","settings","checkAllFilesLoaded","autoplay","play","dispatchEvent","CustomEvent","detail","inBuffer","outBuffer","createBuffer","numberOfChannels","sampleRate","od","getChannelData","set","playFrom","fadeIn","fadeOut","rapidFire","mute","unmute","connectTo","onPlay","onPause","onResume","onStop","onChange","input","createBufferSource","output","destination","audioNodes","isPlaying","volume","muted","playbackRate","startOffset","isDisabled","createNodes","connectNodes","currentTime","randomiseSound","setupNodesFor","soundObj","randomization","getAudioNode","setNodeProps","graph","filterNodes","allFilters","gain","createFilterNode","prop","createStereoPanner","createPanner","createBiquadFilter","eqNode","createConvolver","createAnalyser","createDynamicsCompressor","ct","has","setVal","setValueAtTime","z","setPosition","panValue","frequency","freq","Q","decay","reverse","reverb","impulse","left","right","multi","impulseResponse","fftSize","minDecibels","maxDecibels","smoothingTimeConstant","visualiser","threshold","knee","ratio","attack","release","noteOn","attachedSounds","snd","curr","connect","count","dly","loopSetting","time","prevVol","otherSound","filter","durationInSeconds","endVol","fade","endValue","gn","exponentialRampToValueAtTime","hasFilters","req","XMLHttpRequest","open","responseType","response","decodeAudioData","onprogress","percent","lengthComputable","loaded","total","send","loadFile","audio","body","getBoundingClientRect","offset","guideline","documentElement","clientHeight","totalFrames","bounds","outside","top","bottom","direction","prevPos","scrollProps","toFixed","ready","RAF","webkitRequestAnimationFrame","webkitCancelAnimationFrame","clearTimeout","forceSetTimeout","running","usingSetTimeout","updateTimeout","updateRAF","timestamp","Options","Infinity","options","assign","minFpsCalc","minFps","targetFpsCalc","targetFps","_options","_restartAttempts","_running","_paused","_fn","_frame","_time","_prevTime","_delta","_deltaAverage","_deltaHistory","_deltaIndex","_raf","_hidden","hidden","_boot","timesRestarted","isRunning","isPaused","_update","removeEventListener","_visibilityChange","runTime","mean","maxRestarts","restart","visibility","visibilityState","autoResume","definition","buckets","WeakMap","tngStack","useHooks","fns","tngf","reset","bucket","getCurrentBucket","cleanup","cleanups","pop","stateSlots","effects","memoizations","nextStateSlotIdx","nextEffectIdx","nextMemoizationIdx","args","effect","guards","runEffects","useState","useReducer","useEffect","effectIdx","guardsChanged","ret","useMemo","useCallback","inputGuards","useRef","initialValue","ref","current","useDeferred","deferred","resolve","reject","pr","Promise","rej","useThrottle","timer","TypeError","slot","lastExecute","throttledFn","get","initialVal","prevVal","vOrFn","reducerFn","initialReduction","guards1","guards2","guard","is","memoization"],"mappings":"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"}