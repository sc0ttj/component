{"version":3,"file":"springTo.min.js","sources":["../src/raf.js","../src/springTo.js"],"sourcesContent":["var performance =\n  typeof process !== \"undefined\" && typeof require !== \"undefined\"\n    ? require(\"perf_hooks\").performance\n    : window.performance\n\nvar now = performance.now,\n  root = typeof window === \"undefined\" ? global : window,\n  vendors = [\"moz\", \"webkit\"],\n  suffix = \"AnimationFrame\",\n  raf = root[\"request\" + suffix],\n  caf = root[\"cancel\" + suffix] || root[\"cancelRequest\" + suffix]\n\nfor (var i = 0; !raf && i < vendors.length; i++) {\n  raf = root[vendors[i] + \"Request\" + suffix]\n  caf =\n    root[vendors[i] + \"Cancel\" + suffix] ||\n    root[vendors[i] + \"CancelRequest\" + suffix]\n}\n\n// Some versions of FF have rAF but not cAF\nif (!raf || !caf) {\n  var last = 0,\n    id = 0,\n    queue = [],\n    frameDuration = 1000 / 60\n\n  raf = function(callback) {\n    if (queue.length === 0) {\n      var _now = now(),\n        next = Math.max(0, frameDuration - (_now - last))\n      last = next + _now\n      setTimeout(function() {\n        var cp = queue.slice(0)\n        // Clear queue here to prevent\n        // callbacks from appending listeners\n        // to the current frame's queue\n        queue.length = 0\n        for (var i = 0; i < cp.length; i++) {\n          if (!cp[i].cancelled) {\n            try {\n              cp[i].callback(last)\n            } catch (e) {\n              setTimeout(function() {\n                throw e\n              }, 0)\n            }\n          }\n        }\n      }, Math.round(next))\n    }\n    queue.push({\n      handle: ++id,\n      callback: callback,\n      cancelled: false\n    })\n    return id\n  }\n\n  caf = function(handle) {\n    for (var i = 0; i < queue.length; i++) {\n      if (queue[i].handle === handle) {\n        queue[i].cancelled = true\n      }\n    }\n  }\n}\n\nif (typeof module !== \"undefined\") {\n  module.exports.raf = function(fn) {\n    // Wrap in a new function to prevent\n    // `cancel` potentially being assigned\n    // to the native rAF function\n    return raf.call(root, fn)\n  }\n  module.exports.cancel = function() {\n    caf.apply(root, arguments)\n  }\n  module.exports.polyfill = function(object) {\n    if (!object) {\n      object = root\n    }\n    object.requestAnimationFrame = raf\n    object.cancelAnimationFrame = caf\n  }\n}\n\nexport default function(fn) {\n  // Wrap in a new function to prevent\n  // `cancel` potentially being assigned\n  // to the native rAF function\n  return raf.call(root, fn)\n}\n","import raf from './raf.js'\n\n// if no requestAnimationFrame, use the 'raf' polyfill\nconst requestAnimationFrame =\n  typeof window !== \"undefined\" &&\n  typeof window.requestAnimationFrame !== \"undefined\"\n    ? window.requestAnimationFrame\n    : raf\n\n// Taken from https://github.com/raphaelameaume/lemonade-spring\nconst config = {\n  mass: 1,\n  stiffness: 0.1,\n  damping: 0.8,\n  precision: 0.01,\n};\n\nfunction noop() {}\n\nfunction isAtTarget(curr, dest, precision = config.precision) {\n  return curr < dest + precision && curr > dest - precision;\n}\n\nfunction createObjectSpring(start, {\n  paused = false,\n  stiffness = config.stiffness,\n  damping = config.damping,\n  mass = config.mass,\n  precision = config.precision,\n  shouldSetState = () => true,\n  onSetState = noop,\n  onStart = noop,\n  onUpdate = noop,\n  onComplete = noop,\n} = config) {\n  let keys, previous, current;\n  let finalState = {};\n  let completedKeys = [];\n\n  function to(newState) {\n    Object.keys(newState).forEach(key => {\n      let completedKeyIndex = completedKeys.indexOf(key);\n      if (completedKeyIndex >= 0) {\n        completedKeys.splice(completedKeyIndex, 1);\n      }\n      finalState[key] = newState[key];\n    });\n    spring.completed = false;\n  }\n\n  function update(frame, self) { // pass in frame, so it can be receved by users callbacks (for convenience)\n    if (Object.keys(finalState).length > 0) {\n      let velocity;\n      let acceleration;\n\n      for (let i = 0; i < keys.length; i++) {\n        let key = keys[i];\n        if (finalState[key] !== undefined && !completedKeys.includes(key)) {\n          velocity = (current[key] - previous[key]);\n          acceleration = (finalState[key] - current[key]) * spring.stiffness - velocity * spring.damping;\n          acceleration /= spring.mass;\n\n          previous[key] = current[key];\n          current[key] += velocity + acceleration;\n          start[key] = current[key];\n\n          if (isAtTarget(current[key], finalState[key], spring.precision) && !completedKeys.includes(key)) {\n              completedKeys.push(key);\n          }\n        }\n      }\n\n      const values = getValue();\n      const currentData = { ...values, velocity, acceleration, frame };\n      if (frame === 1) onStart({ ...values, frame });\n\n      let isComplete = Object.keys(finalState).every(key => completedKeys.includes(key));\n\n      if (!spring.completed) {\n        onUpdate(currentData);\n        if (shouldSetState(currentData)) {\n          self.setState({ ...values });\n          onSetState(currentData);\n        }\n        if (isComplete) {\n          spring.completed = true;\n          Object.keys(finalState).forEach(key => {\n              current[key] = finalState[key];\n          });\n          onComplete(currentData);\n        }\n      }\n    }\n  }\n\n\n  function setValue(value) {\n    keys = Object.keys(value);\n\n    previous = keys.reduce((obj, key) => {\n      obj[key] = value[key];\n\n      return obj;\n    }, {});\n\n    current = keys.reduce((obj, key) => {\n      obj[key] = value[key];\n\n      return obj;\n    }, {});\n\n    finalState = {};\n    completedKeys = [];\n    spring.completed = false;\n  }\n\n\n  function getValue() {\n      return current;\n  }\n\n\n  const spring = {\n    paused,\n    completed: false,\n    stiffness,\n    damping,\n    precision,\n    mass,\n    update,\n    getValue,\n    setValue,\n    to\n  };\n\n  spring.setValue(start);\n\n  return spring;\n}\n\n// sc0ttj - component specific stuff below\n\n// for each property in newState, get the value from the given state\nconst getStateToTween = function(state, newState) {\n  const stateToTween = {}\n  Object.entries(state).forEach(entry => {\n    const key = entry[0];\n    const val = entry[1];\n    if (newState[key]) stateToTween[key] = val;\n  })\n  return stateToTween\n}\n\nconst springTo = function(self, newState, springCfg) {\n  let spring,\n      loop,\n      frame = 1;\n\n  const defaults = {\n    onStart: noop,\n    onUpdate: noop,\n    onComplete: noop,\n    shouldSetState: noop,\n    onSetState: noop,\n  };\n\n  // get a state matching the shape of newState, but with values from self.state\n  const stateToTween = getStateToTween(self.state, newState)\n\n  // define the spring\n  spring = createObjectSpring(stateToTween, { ...defaults, ...springCfg });\n  spring.cfg = springCfg;\n\n  // define the animation loop\n  function loopFn() {\n    if (spring.paused === true) return;\n    spring.update(frame, self);\n    frame += 1;\n    loop = requestAnimationFrame(loopFn);\n  }\n\n  // pass the values to animate\n  spring.to(newState);\n  // start the loop\n  loopFn();\n\n\n  // create some callbacks\n  spring.pause = () => {\n    spring.paused = true;\n    cancelAnimationFrame(loop);\n  };\n\n  spring.play = () => {\n    spring.paused = false;\n    loopFn();\n  }\n\n  spring.stop = () => {\n    cancelAnimationFrame(loop);\n    spring.play = noop;\n    spring.completed = true;\n    frame = 1;\n  }\n\n  return spring;\n};\n\nexport default springTo;\n\n"],"names":["now","process","require","performance","window","root","global","vendors","suffix","raf","caf","i","length","last","id","queue","callback","_now","next","Math","max","setTimeout","cp","slice","cancelled","e","round","push","handle","module","exports","fn","call","cancel","apply","arguments","polyfill","object","requestAnimationFrame","cancelAnimationFrame","config","mass","stiffness","damping","precision","noop","isAtTarget","curr","dest","self","newState","springCfg","spring","loop","frame","defaults","onStart","onUpdate","onComplete","shouldSetState","onSetState","stateToTween","state","Object","entries","forEach","entry","key","val","getStateToTween","loopFn","paused","update","start","keys","previous","current","finalState","completedKeys","getValue","completed","velocity","acceleration","undefined","includes","values","currentData","isComplete","every","setState","setValue","value","reduce","obj","to","completedKeyIndex","indexOf","splice","createObjectSpring","cfg","pause","play","stop"],"mappings":"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"}