!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?module.exports=i():"function"==typeof define&&define.amd?define(i):(t="undefined"!=typeof globalThis?globalThis:t||self).onLoop=i()}(this,(function(){"use strict";class t{id=0;running=!1;fn=()=>{};usingSetTimeout=!1;constructor(){const t=this;window.requestAnimationFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||function(t){return setTimeout(t,1e3/60)},window.cancelAnimationFrame=window.cancelAnimationFrame||window.webkitCancelAnimationFrame||function(){clearTimeout(t.id)}}start(t,i){this.running||(this.running=!0,this.fn=t,i?(this.usingSetTimeout=!0,this.updateTimeout()):window.requestAnimationFrame(t=>this.updateRAF(t)))}updateRAF(t){this.running=!0,this.fn(t),this.id=window.requestAnimationFrame(t=>this.updateRAF(t))}updateTimeout(){let t=window.performance.now();this.fn(t),this.id=window.setTimeout(()=>this.updateTimeout(),1e3/60)}restart(){this.usingSetTimeout?window.clearTimeout(this.id):window.cancelAnimationFrame(this.id),this.id=0,this.running=!1,this.usingSetTimeout?this.updateTimeout():window.requestAnimationFrame(t=>this.updateRAF(t)),this.running=!0}stop(){this.usingSetTimeout?window.clearTimeout(this.id):window.cancelAnimationFrame(this.id),this.id=0,this.running=!1,this.fn=()=>{}}}class i{minFps=15;targetFps=60;maxRestarts=1/0;runTime=1/0;forceSetTimeout=!1;autoResume=!0;constructor(t={}){Object.assign(this,t)}get minFpsCalc(){return Math.floor(1e3/this.minFps)}get targetFpsCalc(){return Math.floor(1e3/this.targetFps)}}return class{_options;_restartAttempts;_running;_paused;_fn;_c;_raf;_frame;_time;_prevTime;_delta;_deltaAverage;_deltaHistory;_deltaIndex;_hidden;constructor(e,s,n){this._options=new i(e),this._restartAttempts=0,this._running=!1,this._paused=!1,this._fn=s,this._c=n,this._frame=0,this._time=0,this._prevTime=0,this._delta=0,this._deltaAverage=0,this._deltaHistory=[],this._deltaIndex=0,this._raf=new t,this._hidden=document.hidden,this._boot()}get timesRestarted(){return this._restartAttempts}get isRunning(){return this._running}get isPaused(){return this._paused}get frame(){return this._frame}get time(){return this._time}start(){this._prevTime=0,this._running=!0,this._raf.start(t=>this._update(t),this._options.forceSetTimeout)}pause(){this._paused=!0,this._running=!1}resume(){this._paused=!1,this._prevTime=window.performance.now(),this._running=!0}stop(){this._restartAttempts=0,this._running=!1,this._paused=!1,this._fn=()=>{},this._frame=0,this._time=0,this._prevTime=0,this._delta=0,this._deltaHistory=[],this._deltaIndex=0,document.removeEventListener("visibilitychange",()=>this._visibilityChange),this._raf.stop()}_boot(){document.addEventListener("visibilitychange",()=>this._visibilityChange())}_update(t){if(this._paused)return;if(t>=this._options.runTime)return void this.stop();this._time=t,this._delta=t-this._prevTime,10===this._deltaIndex&&(this._deltaIndex=0),this._deltaHistory[this._deltaIndex]=this._delta,this._deltaIndex++;let i=0;for(let t=0;t<this._deltaHistory.length;++t)i+=this._deltaHistory[t];if(i/=10,this._deltaAverage=i,this._deltaAverage>=this._options.minFpsCalc){if(this._restartAttempts===this._options.maxRestarts)return void this.stop();this._raf.restart(),this._restartAttempts++}this._deltaAverage>=this._options.targetFpsCalc&&(this._frame++,this._fn(this._c.state,this._delta,this._deltaAverage,t),this._prevTime=t)}_visibilityChange(){const t=document.visibilityState;this.isPaused&&this._options.autoResume&&"visible"===t?this.resume():this.isRunning&&"hidden"===t&&this.pause()}}}));
//# sourceMappingURL=onLoop.min.js.map
