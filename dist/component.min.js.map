{"version":3,"file":"component.min.js","sources":["../src/component.js"],"sourcesContent":["// Begin example implementation\n\n// Note:   This is just a demo/experiment\n// Goals:  Super easy to setup, small code base, automatic re-renders on state update\n;(\"use strict\")\n\n// t = target\n// s = source\nconst domDiff = (t, s) => { // from https://codepen.io/tevko/pen/LzXjKE?editors=0010\n  const d = document; // TODO: support shadow DOM - check the root, set accordingly\n  const job = {\n    cfg: {\n      orig: t\n    },\n    // t = target\n    // s = source\n    replace(t, s = t) {\n      const v = d.createElement(\"template\")\n      v.innerHTML = s\n      const vHTML = v.content.firstChild.nextElementSibling\n      if (vHTML.nodeName !== t.nodeName) {\n        t.parentElement.replaceChild(vHTML, t)\n        return\n      }\n      this.loop(t, vHTML)\n    },\n    // tn = target Node\n    // sn = source Node\n    loop(tn, sn, tOrig) {\n      if (tn || sn) {\n        this.checkNew(tn, sn, tOrig)\n        if (\n          tn &&\n          sn &&\n          tn.nodeName !== sn.nodeName\n        ) {\n          this.checkNodeName(tn, sn)\n        } else if (\n          tn &&\n          sn &&\n          tn.nodeName === sn.nodeName\n        ) {\n          this.checkCtx(tn, sn)\n          tn.nodeType !== 3 &&\n            t.nodeType !== 8 &&\n            this.checkAttrs(tn, sn)\n        }\n      }\n      if (tn && sn) {\n        if (tn.childNodes && sn.childNodes) {\n          this.cfg.lengthDiff = [\n            ...t.childNodes,\n            ...sn.childNodes\n          ]\n        } else {\n          this.cfg.lengthDiff = null\n        }\n        Array.apply(null, this.cfg.lengthDiff).forEach(\n          (node, idx) => {\n            this.cfg.lengthDiff &&\n              this.loop(\n                tn.childNodes[idx],\n                sn.childNodes[idx],\n                tn,\n                sn\n              )\n          }\n        )\n      }\n    },\n    checkNodeName(tn, sn) {\n      const n = sn.cloneNode(true)\n      tn.parentElement.replaceChild(n, tn)\n    },\n    checkAttrs(tn, sn) {\n      const attrs = tn.attributes || []\n      const filteredAttrs = Object.keys(attrs).map(n => attrs[n])\n      const attrsNew = sn.attributes || []\n      const filteredAttrsNew = Object.keys(attrsNew).map(\n        n => attrsNew[n]\n      )\n      filteredAttrs.forEach(o => {\n        return sn.getAttribute(o.name) !== null\n          ? tn.setAttribute(o.name, sn.getAttribute(o.name))\n          : tn.removeAttribute(o.name)\n      })\n      filteredAttrsNew.forEach(a => {\n        return (\n          tn.getAttribute(a.name) !== sn.getAttribute(a.name) &&\n          tn.setAttribute(a.name, sn.getAttribute(a.name))\n        )\n      })\n    },\n    checkCtx(tn, sn) {\n      if (tn.nodeValue !== sn.nodeValue) {\n        tn.textContent = sn.textContent\n      }\n    },\n    checkNew(tn, sn, tParent = this.cfg.orig) {\n      if (sn && tn === undefined) {\n        const newNode = sn.cloneNode(true)\n        tParent.nodeType !== 3 &&\n          tParent.nodeType !== 8 &&\n          tParent.appendChild(newNode)\n      } else if (tn && sn === undefined) {\n        tn.parentElement.removeChild(tn)\n      }\n    }\n  }\n  // t = target\n  // s = source\n  Object.create(job).replace(t, s)\n}\n\n\n/**\n * A stateful component creator\n * @constructor\n * @param {object} state - The component state (model).\n */\nfunction Component(state, schema) {\n  const c = function c(state, schema) {\n    c.setState(state, schema)\n    return !state ? c.container : c\n  }\n\n  const C = Component\n  // register the add-ons\n  const validator = C.validator\n  const emitter = C.emitter\n  const tweenState = C.tweenState\n  const springTo = C.springTo\n  const strg = C.storage\n  const useAudio = C.useAudio\n  const onScroll = C.onScroll\n  const onLoop = C.onLoop\n  const Ctx = C.Ctx\n  const devtools = C.devtools\n  const cache = C.memo ? C.memo : function(f){return f;}\n  // used by storage add-on.. maybe try to remove at some point\n  const self = c\n  // re-used a lot..\n  const O = Object\n  const R = RegExp\n\n  // for debouncing render() calls, and window, document\n  let timeout, w, d, raf, t\n\n  c.reactive = true                   // if true, re-render on every state change\n  c.immutable = true                  // if true, freeze the state object after updating it\n  c.debug = devtools ? true : false   //  if true, maintain a history of state changes in `.log`\n  c.scopedCss = true                  // auto prefix component css with a unique id\n  c.state = state                     // component state\n  if (schema) c.schema = schema       // component schema (optional)\n\n  // on init, add our initial state to the state history\n  c.log = [{ id: 0, state: state, action: \"init\" }]\n  c.i = c.log.length\n\n  c.view = props => props // the default view (just return the props)\n\n  // a unique ID, used for scoping component CSS and by devtools to register them\n  c.uid = Math.random()\n    .toString(36)\n    .split(\".\")[1]\n\n  c.isNode =\n    typeof process !== \"undefined\" &&\n    process !== null &&\n    process.versions !== null &&\n    process.versions.node !== null\n\n  if (!c.isNode) {\n    w = window\n    d = document  // TODO: support shadow DOM - check the root, set accordingly\n    raf = requestAnimationFrame\n  }\n\n  /**\n   * Define chainable named \"actions\" that will update our\n   * state in specific ways and register in our state history\n   */\n  c.actions = actions => {\n    c.actionsList = actions\n    // convert each key/value to set state function:\n    O.keys(actions).forEach(axn => {\n      if (typeof c[axn] !== \"undefined\") return false\n      // add the action as a function\n      c[axn] = newState => {\n        // set current action\n        c.action = axn\n        // run action\n        actions[axn](newState)\n        // make sure the component returns itself, so it's always chainable\n        return c\n      }\n    })\n    return c\n  }\n\n  /**\n   * Used to freeze the component state\n   * @param {object} o - the object to freeze\n   */\n  c.freeze = cache(o => {\n    if (!O.isFrozen(o)) {\n      // Recursively call until all child objects are frozen\n      O.keys(o).forEach(k => c.freeze(o[k]))\n      O.freeze(o)\n    }\n    return o\n  })\n\n  /**\n   * Used to compare the current and next component state\n   * @param {object} x - the object to compare with y\n   * @param {object} y - the object to compare with x\n   */\n  c.eq = cache((x, y) => {\n    const ok = O.keys,\n      tx = typeof x,\n      ty = typeof y\n    return x && y && tx === \"object\" && tx === ty\n      ? ok(x).length === ok(y).length &&\n          ok(x).every(key => c.eq(x[key], y[key]))\n      : String(x) === String(y)\n  })\n\n  /**\n   * Set the component state\n   * @param {object} newState - the new state to update to\n   */\n  c.setState = (newState, callback) => {\n    const nextState = { ...c.state, ...newState };\n    // get initial state from localStorage, if it's in there\n    if (strg && !c.done) {\n      const pState = strg.getItem(c, nextState);\n      if (pState) newState = { ...newState, ...pState };\n    }\n    c.done = true;\n\n    // enable schema validation using @scottjarvis/validator\n    if (validator && c.schema) {\n      const err = cache(validator(nextState, c.schema))\n      const msg = \"State doesn't match schema:\"\n      if (err.length > 0) {\n        console.error(msg, \"\\n\", err, \"\\n\")\n        throw new Error(msg + \"\\n\" + JSON.stringify(err) + \"\\n\")\n      }\n    }\n    // ...the new state is valid, lets continue\n\n    // update previous and current state\n    c.prev = c.state\n    c.state = { ...c.state, ...nextState }\n\n    if (!c.eq(c.state, c.prev)) {\n\n      if (strg && c.done) {\n        // c.store is just the name of the key in localStorage,\n        // where we keep our JSON stringified state\n        strg.setItem(c, c.state)\n      }\n\n      // re-render component\n      if (c.reactive) c.render(c.container, c.ctx)\n\n      if (t && !c.isNode) cancelAnimationFrame(t)\n\n      // c.tt = component is \"time travelling\" (traversing state history)\n      if (c.debug && c.tt !== true) {\n        // if node, just use setTimeout\n        if (c.isNode) raf = (logFn) => setTimeout(() => logFn(), 1)\n        t = raf(() => {\n          // we are not traversing state history, so add the new state to the log\n          c.log.push({\n            id: c.log.length,\n            state: c.state,\n            action: c.action || \"setState\"\n          })\n          // move along index\n          c.i = c.log.length -1\n        })\n      }\n\n      // log state changes if debug = true\n      //if (c.debug) console.log(c.i, [c.state, ...c.log])\n\n      // freeze state so it can only be changed through setState()\n      if (c.immutable) c.freeze(c.state)\n\n      // if we updated using an \"action\" method, and emitter is avail,\n      // then emit an event with same name as the \"action\" called,\n      // passing in the current state\n      if (typeof emitter !== \"undefined\" && !!c.action) {\n        emitter.emit(`${c.action}`, { ...c.state })\n      }\n\n      if (typeof callback === 'function') callback(c.state);\n\n      // run any middlware functions that were defined by the user\n      if (c.middleware) c.middleware.forEach(fn => fn({ ...c.state }))\n\n      c.action = undefined\n\n      return c\n    }\n  }\n\n  /**\n   * Tween from the current state to the given state, then set the given\n   * state as the new state.\n   *\n   * @param {object} cfg - the settings used for the tweening\n   *\n   */\n  if (tweenState) c.tweenState = (props, cfg) => tweenState(c, props, cfg)\n\n  /**\n   * Animate from the current state to the given state, then set the given\n   * state as the new state. Uses spring-based physics.\n   *\n   * @param {object} cfg - the settings used for the spring\n   *\n   */\n  if (springTo) c.springTo = (props, cfg) => springTo(c, props, cfg)\n\n  /**\n   * Audio for components\n   *\n   * @param {object} audio library - the audio files and their settings\n   *\n   */\n  if (useAudio) c.useAudio = (props) => useAudio(props, c)\n\n  /**\n   * Scroll-based animations for components\n   *\n   * @param {object}\n   *\n   */\n  if (onScroll) c.onScroll = fn => onScroll(fn, c)\n\n  /**\n   * Game loop (fixed interval loop, variable interval rendering)\n   *\n   * @param {object}\n   *\n   */\n  if (onLoop) {\n    c.onLoop = (fn, o) => {\n      // create a controllable loop, if needed\n      c.loop = c.loop ? c.loop : new onLoop(o, fn, c)\n      // attach the methods to control the loop\n      c.start = () => c.loop.start();\n      c.stop = () => c.loop.stop();\n      c.pause = () => c.loop.pause();\n      c.resume = () => c.loop.resume();\n    }\n  }\n\n  c.on = (ev, fn) => {\n    typeof emitter !== \"undefined\"\n      ? emitter.on(ev, fn)\n      : false\n    return c\n  }\n\n  c.once = (ev, fn) => {\n    if (typeof emitter !== \"undefined\") {\n      emitter.on(ev, props => {\n        fn(props)\n        emitter.off(ev, fn)\n      })\n    }\n    return c\n  }\n\n  c.off = (ev, fn) => {\n    typeof emitter !== \"undefined\"\n      ? emitter.off(ev, fn)\n      : false\n    return c\n  }\n\n  /**\n   * Travel forward/backward to different states in the state history\n   * @param {number} num - the number of steps through the history to take\n   * @param {string} direction - 'f' for forward, 'b' for backwards\n   */\n  c.go = function(num, dir) {\n    let i\n    if (dir === \"f\") {\n      i = c.i + num\n    } else {\n      i = c.i - num\n    }\n    if (c.log[i]) {\n      c.i = i\n      c.tt = true;\n      c(c.log[i].state) // set state\n      c.tt = false;\n    }\n    return c\n  }\n\n  /**\n   * Go to previous (or first) state in the state history\n   * @param {number} num - the number of steps through the history to take, 0 if 'num' not given\n   */\n  c.rw = function(num) {\n    if (!num) {\n      if (c.log[0]) {\n        c.tt = true;\n        c(c.log[0].state) // set state\n        c.tt = false;\n      }\n      c.i = 0\n      return c\n    }\n    return c.go(num, \"b\")\n  }\n\n  /**\n   * Go to more recent state in the state history\n   * @param {number} num - the number of steps through the history to take, most recent if 'num' not given\n   */\n  c.ff = function(num) {\n    if (!num) {\n      if (c.log[c.log.length - 1]) {\n        c.tt = true;\n        c(c.log[c.log.length - 1].state) // set state\n        c.tt = false;\n      }\n      c.i = c.log.length -1\n      return c\n    }\n    return c.go(num, \"f\")\n  }\n\n  /**\n   * If in browser, puts scoped component styles in c.css\n   */\n  c.setCss = function() {\n    // if in browser\n    if (c && !c.isNode) {\n      // if a style is defined\n      if (c.css && typeof c.style === \"function\") {\n        // get the latest component style\n        let st = c.style(c.state) // the css\n\n        // auto-prefix CSS styles with a unique id,to \"scope\" the\n        // styles to the component only\n        if (c.scopedCss) {\n          const p = c.container.id ? \"#\" : \".\"\n          // get container id, or class if no id\n          let u = c.container.id ? c.container.id : c.container.className\n          // if container has no class or id, use uid\n          u = !!u ? u : c.uid\n\n          // ..these 3 are used for scoping CSS, in setCss()\n          const fx1 = new R(u + \" ,\\\\s*\\\\.\", \"gm\")\n          const fx2 = new R(u + \" ,\\\\s*#\", \"gm\")\n          const fx3 = new R(u + \" ,\\\\s*([a-z\\\\.#])\", \"gmi\")\n          // func to scope css\n          const fx = (v,p,u) =>\n            v.replace(/}/g, \"}\\n\")\n             .replace(/\\;\\s*\\n/g, \";\")\n             .replace(/{\\s*\\n/g, \"{ \")\n             .replace(/^\\s+|\\s+$/gm, \"\\n\")\n             .replace(/(^[\\.#\\w][\\w\\-]*|\\s*,[\\.#\\w][\\w\\-]*)/gm, p + u + \" $1\")\n             .replace(fx1, \", \" + p + u + \" \")\n             .replace(fx2, \", \" + p + u + \" #\")\n             .replace(fx3, \", \" + p + u + \" $1\")\n             .replace(/\\n/g, \"\")\n             .replace(/\\s\\s+/g, \" \")\n           // scope the css\n           st = cache(fx(st,p,u))\n        }\n\n        // minify the CSS\n        const minCss = st.replace(/\\n/g, \"\").replace(/\\s\\s+/g, \" \")\n        // if the new CSS is changed from previous, re-render it\n        if (c.css.innerHTML !== minCss) c.css.innerHTML = minCss\n      }\n    }\n  }\n\n  // used by .toString()\n  const toStr = (view, style) => {\n    let s = '';\n    if (view.outerHTML) {\n      if (style) s = `<style>${style}\\n</style>\\n`\n      s += `${view.outerHTML}`.replace(/^ {4}/gm, \"\")\n    } else if (typeof view === \"string\") {\n      try {\n        // if view is a JSON string\n        s = JSON.parse(view)\n        // return the view as prettified JSON\n        s = JSON.stringify(s, null, 2)\n      } catch (err) {\n        if (style) s = `<style>${style}\\n</style>\\n`\n        s += `${view}`.replace(/^ {4}/gm, \"\")\n      }\n    } else if (typeof view === \"object\" || Array.isArray(view)) {\n      // return the view as prettified JSON\n      s = JSON.stringify(view, null, 2)\n    }\n    //if (c.debug) console.log(s)\n    return s\n  }\n\n  /*\n  * Render the current view as a string, including\n  * our component styling, in a <style> tag\n  */\n  c.toString = function() {\n    let view = c.view(c.state, c.ctx)\n    let str = ''\n    let style = ''\n\n    // get local state\n    if (!c.done && strg) {\n      const pState = strg.getItem(c, c.state);\n      c(pState);\n      view = typeof c.view === \"function\" ? c.view(pState, c.ctx) : view\n    }\n\n    // get component styles, nicely indented\n    if (typeof c.style === \"function\") {\n      style = c.style(c.state).replace(/^ {4}/gm, \"\")\n    }\n\n    return cache(toStr(view,style))\n  }\n\n  /**\n   * Re-render the component and add it to the page\n   * @param {string|element} container - the element which holds the component\n   */\n  c.render = function(el, ctxType) {\n    if (c.isNode) return c.toString()\n\n    let view;\n\n    // get state from localStorage, if it's in there\n    if (!c.html && strg) {\n      const pState = strg.getItem(c, c.state);\n      view = typeof c.view === \"function\" ? c.view(pState, c.ctx) : null\n      c(pState); // set state\n    }\n\n    // make sure we have container as an HTML Element\n    if (d && !c.html) {\n      // TODO: support shadow DOM - check the root , set `d` accordingly\n      el = d.querySelector(el)\n    }\n    c.html = c.container = el\n\n    if (c.html) {\n      // create the <style> elem into which we put our component CSS:\n      if (c.style) {\n        if (!c.css) {\n          // create the style elem\n          c.css = d.createElement(\"style\")\n          c.css.type = 'text/css';\n          c.css.id = c.uid\n          // append to page\n          d.head.appendChild(c.css)\n        }\n      }\n\n      // get the canvas context, if needed\n      if (c.html.getContext && !c.ctx) {\n        c.ctx = c.html.getContext(ctxType ? ctxType : '2d')\n        // extend canvas if Ctx addon available (adds methods, makes all methods chainable)\n        if (c.ctx && Ctx) {\n          c.ctx = new Ctx(c.ctx, c);\n        }\n      }\n    }\n\n    if (timeout) cancelAnimationFrame(timeout)\n\n    timeout = raf(() => {\n      if (c.css && c.style) c.setCss()\n\n      // if we a container, lets (re)render the view (if any) to the page\n      if (c.html) {\n        view = typeof c.view === \"function\" ? c.view(c.state, c.ctx) : null\n        // if container exists, is *not* a canvas\n        if (!c.ctx) {\n          // get the view\n          // try to update view:\n          // try DOM diffing, else append to empty innerHTML, else replace innerHTML\n          try {\n            domDiff(c.html.firstElementChild, view.outerHTML ? view.outerHTML : view)\n            //console.log('diffed')\n          } catch (err) {\n            if (view && view.outerHTML) {\n              c.html.innerHTML = ''\n              c.html.append(view)\n              //console.log('cleared & appended')\n            } else {\n              c.html.innerHTML = view\n              //console.log('replaced innerHTML')\n            }\n          }\n        } else {\n          // else if container exists and *is* a canvas\n          c.view(c.state, c.ctx)\n        }\n      }\n      // for devtools\n      if (devtools && c.html) {\n        c.html.firstChild.setAttribute('data-uid', c.uid)\n        devtools.populateUI(c.html)\n      }\n      // we should (probably!) clear/reset the `html.funcs` array here,\n      // because once the view has rendered, we don't need to keep its\n      // list of the event handlers\n      if (typeof html == 'function' && Array.isArray(html.funcs)) html.funcs = [];\n    })\n\n    // return the container element\n    return c.html\n  }\n\n  // for devtools\n  if (!c.isNode) {\n    w.sjComponents = w.sjComponents || {};\n    w.sjComponents[c.uid] = c;\n  }\n\n  return c\n}\n\nexport default Component\n"],"names":["domDiff","t","s","d","document","job","cfg","orig","[object Object]","v","createElement","innerHTML","vHTML","content","firstChild","nextElementSibling","nodeName","this","loop","parentElement","replaceChild","tn","sn","tOrig","checkNew","checkNodeName","checkCtx","nodeType","checkAttrs","childNodes","lengthDiff","Array","apply","forEach","node","idx","n","cloneNode","attrs","attributes","filteredAttrs","Object","keys","map","attrsNew","filteredAttrsNew","o","getAttribute","name","setAttribute","removeAttribute","a","nodeValue","textContent","tParent","undefined","newNode","appendChild","removeChild","create","replace","Component","state","schema","c","setState","container","C","validator","emitter","tweenState","springTo","strg","storage","useAudio","onScroll","onLoop","Ctx","devtools","cache","memo","f","O","R","RegExp","timeout","w","raf","reactive","immutable","debug","scopedCss","i","log","id","action","length","view","props","uid","Math","random","toString","split","isNode","process","versions","window","requestAnimationFrame","actions","actionsList","axn","newState","freeze","isFrozen","k","eq","x","y","ok","tx","every","key","String","callback","nextState","done","pState","getItem","err","msg","console","error","Error","JSON","stringify","prev","setItem","render","ctx","cancelAnimationFrame","tt","logFn","setTimeout","push","emit","middleware","fn","start","stop","pause","resume","on","ev","once","off","go","num","dir","rw","ff","setCss","css","style","st","p","u","className","fx1","fx2","fx3","fx","minCss","outerHTML","parse","isArray","toStr","el","ctxType","html","querySelector","type","head","getContext","firstElementChild","append","populateUI","funcs","sjComponents"],"mappings":"0OAQA,MAAMA,EAAU,CAACC,EAAGC,KAClB,MAAMC,EAAIC,SACJC,EAAM,CACVC,IAAK,CACHC,KAAMN,GAIRO,QAAQP,EAAGC,EAAID,GACb,MAAMQ,EAAIN,EAAEO,cAAc,YAC1BD,EAAEE,UAAYT,EACd,MAAMU,EAAQH,EAAEI,QAAQC,WAAWC,mBAC/BH,EAAMI,WAAaf,EAAEe,SAIzBC,KAAKC,KAAKjB,EAAGW,GAHXX,EAAEkB,cAAcC,aAAaR,EAAOX,IAOxCO,KAAKa,EAAIC,EAAIC,IACPF,GAAMC,KACRL,KAAKO,SAASH,EAAIC,EAAIC,GAEpBF,GACAC,GACAD,EAAGL,WAAaM,EAAGN,SAEnBC,KAAKQ,cAAcJ,EAAIC,GAEvBD,GACAC,GACAD,EAAGL,WAAaM,EAAGN,WAEnBC,KAAKS,SAASL,EAAIC,GACF,IAAhBD,EAAGM,UACc,IAAf1B,EAAE0B,UACFV,KAAKW,WAAWP,EAAIC,KAGtBD,GAAMC,IACJD,EAAGQ,YAAcP,EAAGO,WACtBZ,KAAKX,IAAIwB,WAAa,IACjB7B,EAAE4B,cACFP,EAAGO,YAGRZ,KAAKX,IAAIwB,WAAa,KAExBC,MAAMC,MAAM,KAAMf,KAAKX,IAAIwB,YAAYG,QACrC,CAACC,EAAMC,KACLlB,KAAKX,IAAIwB,YACPb,KAAKC,KACHG,EAAGQ,WAAWM,GACdb,EAAGO,WAAWM,GACdd,EACAC,OAMZd,cAAca,EAAIC,GAChB,MAAMc,EAAId,EAAGe,WAAU,GACvBhB,EAAGF,cAAcC,aAAagB,EAAGf,IAEnCb,WAAWa,EAAIC,GACb,MAAMgB,EAAQjB,EAAGkB,YAAc,GACzBC,EAAgBC,OAAOC,KAAKJ,GAAOK,IAAIP,GAAKE,EAAMF,IAClDQ,EAAWtB,EAAGiB,YAAc,GAC5BM,EAAmBJ,OAAOC,KAAKE,GAAUD,IAC7CP,GAAKQ,EAASR,IAEhBI,EAAcP,QAAQa,GACe,OAA5BxB,EAAGyB,aAAaD,EAAEE,MACrB3B,EAAG4B,aAAaH,EAAEE,KAAM1B,EAAGyB,aAAaD,EAAEE,OAC1C3B,EAAG6B,gBAAgBJ,EAAEE,OAE3BH,EAAiBZ,QAAQkB,GAErB9B,EAAG0B,aAAaI,EAAEH,QAAU1B,EAAGyB,aAAaI,EAAEH,OAC9C3B,EAAG4B,aAAaE,EAAEH,KAAM1B,EAAGyB,aAAaI,EAAEH,SAIhDxC,SAASa,EAAIC,GACPD,EAAG+B,YAAc9B,EAAG8B,YACtB/B,EAAGgC,YAAc/B,EAAG+B,cAGxB7C,SAASa,EAAIC,EAAIgC,EAAUrC,KAAKX,IAAIC,MAClC,GAAIe,QAAaiC,IAAPlC,EAAkB,CAC1B,MAAMmC,EAAUlC,EAAGe,WAAU,GACR,IAArBiB,EAAQ3B,UACe,IAArB2B,EAAQ3B,UACR2B,EAAQG,YAAYD,QACbnC,QAAakC,IAAPjC,GACfD,EAAGF,cAAcuC,YAAYrC,KAMnCoB,OAAOkB,OAAOtD,GAAKuD,QAAQ3D,EAAGC,WAShC,SAAS2D,EAAUC,EAAOC,GACxB,MAAMC,EAAI,SAASA,EAAEF,EAAOC,GAE1B,OADAC,EAAEC,SAASH,EAAOC,GACVD,EAAsBE,EAAdA,EAAEE,WAGdC,EAAIN,EAEJO,EAAYD,EAAEC,UACdC,EAAUF,EAAEE,QACZC,EAAaH,EAAEG,WACfC,EAAWJ,EAAEI,SACbC,EAAOL,EAAEM,QACTC,EAAWP,EAAEO,SACbC,EAAWR,EAAEQ,SACbC,EAAST,EAAES,OACXC,EAAMV,EAAEU,IACRC,EAAWX,EAAEW,SACbC,EAAQZ,EAAEa,KAAOb,EAAEa,KAAO,SAASC,GAAG,OAAOA,GAI7CC,EAAIzC,OACJ0C,EAAIC,OAGV,IAAIC,EAASC,EAAGnF,EAAGoF,EAAKtF,EAwexB,OAteA+D,EAAEwB,UAAW,EACbxB,EAAEyB,WAAY,EACdzB,EAAE0B,QAAQZ,EACVd,EAAE2B,WAAY,EACd3B,EAAEF,MAAQA,EACNC,IAAQC,EAAED,OAASA,GAIvBC,EAAE4B,GADF5B,EAAE6B,IAAM,CAAC,CAAEC,GAAI,EAAGhC,MAAOA,EAAOiC,OAAQ,UAC5BC,OAEZhC,EAAEiC,KAAOC,GAASA,EAGlBlC,EAAEmC,IAAMC,KAAKC,SACVC,SAAS,IACTC,MAAM,KAAK,IAEdvC,EAAEwC,OACmB,oBAAZC,SACK,OAAZA,SACqB,OAArBA,QAAQC,UACkB,OAA1BD,QAAQC,SAASxE,QAGjBoD,EAAIqB,OACJxG,EAAIC,SACJmF,EAAMqB,uBAOR5C,EAAE6C,QAAUA,IACV7C,EAAE8C,YAAcD,EAEhB3B,EAAExC,KAAKmE,GAAS5E,QAAQ8E,IACtB,QAAsB,IAAX/C,EAAE+C,GAAsB,OAAO,EAE1C/C,EAAE+C,GAAOC,IAEPhD,EAAE+B,OAASgB,EAEXF,EAAQE,GAAKC,GAENhD,KAGJA,GAOTA,EAAEiD,OAASlC,EAAMjC,IACVoC,EAAEgC,SAASpE,KAEdoC,EAAExC,KAAKI,GAAGb,QAAQkF,GAAKnD,EAAEiD,OAAOnE,EAAEqE,KAClCjC,EAAE+B,OAAOnE,IAEJA,IAQTkB,EAAEoD,GAAKrC,EAAM,CAACsC,EAAGC,KACf,MAAMC,EAAKrC,EAAExC,KACX8E,SAAYH,EAEd,OAAOA,GAAKC,GAAY,WAAPE,GAAmBA,WADtBF,EAEVC,EAAGF,GAAGrB,SAAWuB,EAAGD,GAAGtB,QACrBuB,EAAGF,GAAGI,MAAMC,GAAO1D,EAAEoD,GAAGC,EAAEK,GAAMJ,EAAEI,KACpCC,OAAON,KAAOM,OAAOL,KAO3BtD,EAAEC,SAAW,CAAC+C,EAAUY,KACtB,MAAMC,EAAY,IAAK7D,EAAEF,SAAUkD,GAEnC,GAAIxC,IAASR,EAAE8D,KAAM,CACnB,MAAMC,EAASvD,EAAKwD,QAAQhE,EAAG6D,GAC3BE,IAAQf,EAAW,IAAKA,KAAae,IAK3C,GAHA/D,EAAE8D,MAAO,EAGL1D,GAAaJ,EAAED,OAAQ,CACzB,MAAMkE,EAAMlD,EAAMX,EAAUyD,EAAW7D,EAAED,SACnCmE,EAAM,8BACZ,GAAID,EAAIjC,OAAS,EAEf,MADAmC,QAAQC,MAAMF,EAAK,KAAMD,EAAK,MACxB,IAAII,MAAMH,EAAM,KAAOI,KAAKC,UAAUN,GAAO,MASvD,GAHAjE,EAAEwE,KAAOxE,EAAEF,MACXE,EAAEF,MAAQ,IAAKE,EAAEF,SAAU+D,IAEtB7D,EAAEoD,GAAGpD,EAAEF,MAAOE,EAAEwE,MAiDnB,OA/CIhE,GAAQR,EAAE8D,MAGZtD,EAAKiE,QAAQzE,EAAGA,EAAEF,OAIhBE,EAAEwB,UAAUxB,EAAE0E,OAAO1E,EAAEE,UAAWF,EAAE2E,KAEpC1I,IAAM+D,EAAEwC,QAAQoC,qBAAqB3I,GAGrC+D,EAAE0B,QAAkB,IAAT1B,EAAE6E,KAEX7E,EAAEwC,SAAQjB,EAAOuD,GAAUC,WAAW,IAAMD,IAAS,IACzD7I,EAAIsF,EAAI,KAENvB,EAAE6B,IAAImD,KAAK,CACTlD,GAAI9B,EAAE6B,IAAIG,OACVlC,MAAOE,EAAEF,MACTiC,OAAQ/B,EAAE+B,QAAU,aAGtB/B,EAAE4B,EAAI5B,EAAE6B,IAAIG,OAAQ,KAQpBhC,EAAEyB,WAAWzB,EAAEiD,OAAOjD,EAAEF,YAKL,IAAZO,GAA6BL,EAAE+B,QACxC1B,EAAQ4E,KAAK,GAAGjF,EAAE+B,OAAU,IAAK/B,EAAEF,QAGb,mBAAb8D,GAAyBA,EAAS5D,EAAEF,OAG3CE,EAAEkF,YAAYlF,EAAEkF,WAAWjH,QAAQkH,GAAMA,EAAG,IAAKnF,EAAEF,SAEvDE,EAAE+B,YAASxC,EAEJS,GAWPM,IAAYN,EAAEM,WAAa,CAAC4B,EAAO5F,IAAQgE,EAAWN,EAAGkC,EAAO5F,IAShEiE,IAAUP,EAAEO,SAAW,CAAC2B,EAAO5F,IAAQiE,EAASP,EAAGkC,EAAO5F,IAQ1DoE,IAAUV,EAAEU,SAAYwB,GAAUxB,EAASwB,EAAOlC,IAQlDW,IAAUX,EAAEW,SAAWwE,GAAMxE,EAASwE,EAAInF,IAQ1CY,IACFZ,EAAEY,OAAS,CAACuE,EAAIrG,KAEdkB,EAAE9C,KAAO8C,EAAE9C,KAAO8C,EAAE9C,KAAO,IAAI0D,EAAO9B,EAAGqG,EAAInF,GAE7CA,EAAEoF,MAAQ,IAAMpF,EAAE9C,KAAKkI,QACvBpF,EAAEqF,KAAO,IAAMrF,EAAE9C,KAAKmI,OACtBrF,EAAEsF,MAAQ,IAAMtF,EAAE9C,KAAKoI,QACvBtF,EAAEuF,OAAS,IAAMvF,EAAE9C,KAAKqI,WAI5BvF,EAAEwF,GAAK,CAACC,EAAIN,UACS,IAAZ9E,GACHA,EAAQmF,GAAGC,EAAIN,GAEZnF,GAGTA,EAAE0F,KAAO,CAACD,EAAIN,UACW,IAAZ9E,GACTA,EAAQmF,GAAGC,EAAIvD,IACbiD,EAAGjD,GACH7B,EAAQsF,IAAIF,EAAIN,KAGbnF,GAGTA,EAAE2F,IAAM,CAACF,EAAIN,UACQ,IAAZ9E,GACHA,EAAQsF,IAAIF,EAAIN,GAEbnF,GAQTA,EAAE4F,GAAK,SAASC,EAAKC,GACnB,IAAIlE,EAYJ,OAVEA,EADU,MAARkE,EACE9F,EAAE4B,EAAIiE,EAEN7F,EAAE4B,EAAIiE,EAER7F,EAAE6B,IAAID,KACR5B,EAAE4B,EAAIA,EACN5B,EAAE6E,IAAK,EACP7E,EAAEA,EAAE6B,IAAID,GAAG9B,OACXE,EAAE6E,IAAK,GAEF7E,GAOTA,EAAE+F,GAAK,SAASF,GACd,OAAKA,EASE7F,EAAE4F,GAAGC,EAAK,MARX7F,EAAE6B,IAAI,KACR7B,EAAE6E,IAAK,EACP7E,EAAEA,EAAE6B,IAAI,GAAG/B,OACXE,EAAE6E,IAAK,GAET7E,EAAE4B,EAAI,EACC5B,IASXA,EAAEgG,GAAK,SAASH,GACd,OAAKA,EASE7F,EAAE4F,GAAGC,EAAK,MARX7F,EAAE6B,IAAI7B,EAAE6B,IAAIG,OAAS,KACvBhC,EAAE6E,IAAK,EACP7E,EAAEA,EAAE6B,IAAI7B,EAAE6B,IAAIG,OAAS,GAAGlC,OAC1BE,EAAE6E,IAAK,GAET7E,EAAE4B,EAAI5B,EAAE6B,IAAIG,OAAQ,EACbhC,IAQXA,EAAEiG,OAAS,WAET,GAAIjG,IAAMA,EAAEwC,QAENxC,EAAEkG,KAA0B,mBAAZlG,EAAEmG,MAAsB,CAE1C,IAAIC,EAAKpG,EAAEmG,MAAMnG,EAAEF,OAInB,GAAIE,EAAE2B,UAAW,CACf,MAAM0E,EAAIrG,EAAEE,UAAU4B,GAAK,IAAM,IAEjC,IAAIwE,EAAItG,EAAEE,UAAU4B,GAAK9B,EAAEE,UAAU4B,GAAK9B,EAAEE,UAAUqG,UAEtDD,EAAMA,GAAQtG,EAAEmC,IAGhB,MAAMqE,EAAM,IAAIrF,EAAEmF,EAAI,YAAa,MAC7BG,EAAM,IAAItF,EAAEmF,EAAI,UAAW,MAC3BI,EAAM,IAAIvF,EAAEmF,EAAI,oBAAqB,OAc1CF,EAAKrF,EAZK,EAACtE,EAAE4J,EAAEC,IACd7J,EAAEmD,QAAQ,KAAM,OACdA,QAAQ,WAAY,KACpBA,QAAQ,UAAW,MACnBA,QAAQ,cAAe,MACvBA,QAAQ,yCAA0CyG,EAAIC,EAAI,OAC1D1G,QAAQ4G,EAAK,KAAOH,EAAIC,EAAI,KAC5B1G,QAAQ6G,EAAK,KAAOJ,EAAIC,EAAI,MAC5B1G,QAAQ8G,EAAK,KAAOL,EAAIC,EAAI,OAC5B1G,QAAQ,MAAO,IACfA,QAAQ,SAAU,KAEV+G,CAAGP,EAAGC,EAAEC,IAItB,MAAMM,EAASR,EAAGxG,QAAQ,MAAO,IAAIA,QAAQ,SAAU,KAEnDI,EAAEkG,IAAIvJ,YAAciK,IAAQ5G,EAAEkG,IAAIvJ,UAAYiK,KAiCxD5G,EAAEsC,SAAW,WACX,IAAIL,EAAOjC,EAAEiC,KAAKjC,EAAEF,MAAOE,EAAE2E,KAEzBwB,EAAQ,GAGZ,IAAKnG,EAAE8D,MAAQtD,EAAM,CACnB,MAAMuD,EAASvD,EAAKwD,QAAQhE,EAAGA,EAAEF,OACjCE,EAAE+D,GACF9B,EAAyB,mBAAXjC,EAAEiC,KAAsBjC,EAAEiC,KAAK8B,EAAQ/D,EAAE2E,KAAO1C,EAQhE,MAJuB,mBAAZjC,EAAEmG,QACXA,EAAQnG,EAAEmG,MAAMnG,EAAEF,OAAOF,QAAQ,UAAW,KAGvCmB,EA5CK,EAACkB,EAAMkE,KACnB,IAAIjK,EAAI,GACR,GAAI+F,EAAK4E,UACHV,IAAOjK,EAAI,UAAUiK,iBACzBjK,IAAK,GAAG+F,EAAK4E,WAAYjH,QAAQ,UAAW,SACvC,GAAoB,iBAATqC,EAChB,IAEE/F,EAAIoI,KAAKwC,MAAM7E,GAEf/F,EAAIoI,KAAKC,UAAUrI,EAAG,KAAM,GAC5B,MAAO+H,GACHkC,IAAOjK,EAAI,UAAUiK,iBACzBjK,IAAK,GAAG+F,GAAOrC,QAAQ,UAAW,SAEX,iBAATqC,GAAqBlE,MAAMgJ,QAAQ9E,MAEnD/F,EAAIoI,KAAKC,UAAUtC,EAAM,KAAM,IAGjC,OAAO/F,GAwBM8K,CAAM/E,EAAKkE,KAO1BnG,EAAE0E,OAAS,SAASuC,EAAIC,GACtB,GAAIlH,EAAEwC,OAAQ,OAAOxC,EAAEsC,WAEvB,IAAIL,EAGJ,IAAKjC,EAAEmH,MAAQ3G,EAAM,CACnB,MAAMuD,EAASvD,EAAKwD,QAAQhE,EAAGA,EAAEF,OACjCmC,EAAyB,mBAAXjC,EAAEiC,KAAsBjC,EAAEiC,KAAK8B,EAAQ/D,EAAE2E,KAAO,KAC9D3E,EAAE+D,GA4EJ,OAxEI5H,IAAM6D,EAAEmH,OAEVF,EAAK9K,EAAEiL,cAAcH,KAEvBjH,EAAEmH,KAAOnH,EAAEE,UAAY+G,KAIjBjH,EAAEmG,QACCnG,EAAEkG,OAELlG,EAAEkG,IAAM/J,EAAEO,cAAc,UAClB2K,KAAO,WACbrH,EAAEkG,IAAIpE,GAAK9B,EAAEmC,IAEbhG,EAAEmL,KAAK7H,YAAYO,EAAEkG,OAKrBlG,EAAEmH,KAAKI,aAAevH,EAAE2E,MAC1B3E,EAAE2E,IAAM3E,EAAEmH,KAAKI,WAAWL,GAAoB,QAEjCrG,IACXb,EAAE2E,IAAM,IAAI9D,EAAIb,EAAE2E,IAAK3E,KAKzBqB,GAASuD,qBAAqBvD,GAElCA,EAAUE,EAAI,KAIZ,GAHIvB,EAAEkG,KAAOlG,EAAEmG,OAAOnG,EAAEiG,SAGpBjG,EAAEmH,KAGJ,GAFAlF,EAAyB,mBAAXjC,EAAEiC,KAAsBjC,EAAEiC,KAAKjC,EAAEF,MAAOE,EAAE2E,KAAO,KAE1D3E,EAAE2E,IAmBL3E,EAAEiC,KAAKjC,EAAEF,MAAOE,EAAE2E,UAflB,IACE3I,EAAQgE,EAAEmH,KAAKK,kBAAmBvF,EAAK4E,UAAY5E,EAAK4E,UAAY5E,GAEpE,MAAOgC,GACHhC,GAAQA,EAAK4E,WACf7G,EAAEmH,KAAKxK,UAAY,GACnBqD,EAAEmH,KAAKM,OAAOxF,IAGdjC,EAAEmH,KAAKxK,UAAYsF,EAUvBnB,GAAYd,EAAEmH,OAChBnH,EAAEmH,KAAKrK,WAAWmC,aAAa,WAAYe,EAAEmC,KAC7CrB,EAAS4G,WAAW1H,EAAEmH,OAKL,mBAARA,MAAsBpJ,MAAMgJ,QAAQI,KAAKQ,SAAQR,KAAKQ,MAAQ,MAIpE3H,EAAEmH,MAINnH,EAAEwC,SACLlB,EAAEsG,aAAetG,EAAEsG,cAAgB,GACnCtG,EAAEsG,aAAa5H,EAAEmC,KAAOnC,GAGnBA"}