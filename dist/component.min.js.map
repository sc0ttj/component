{"version":3,"file":"component.min.js","sources":["../src/component.js"],"sourcesContent":["// Begin example implementation\n\n// Note:   This is just a demo/experiment\n// Goals:  Super easy to setup, small code base, automatic re-renders on state update\n;(\"use strict\")\n\n// t = target\n// s = source\nconst domDiff = (t, s) => { // from https://codepen.io/tevko/pen/LzXjKE?editors=0010\n  const d = document; // TODO: support shadow DOM - check the root, set accordingly\n  const job = {\n    cfg: {\n      orig: t\n    },\n    // t = target\n    // s = source\n    replace(t, s = t) {\n      const v = d.createElement(\"template\")\n      v.innerHTML = s\n      const vHTML = v.content.firstChild.nextElementSibling\n      if (vHTML.nodeName !== t.nodeName) {\n        t.parentElement.replaceChild(vHTML, t)\n        return\n      }\n      this.loop(t, vHTML)\n    },\n    // tn = target Node\n    // sn = source Node\n    loop(tn, sn, tOrig) {\n      if (tn || sn) {\n        this.checkNew(tn, sn, tOrig)\n        if (\n          tn &&\n          sn &&\n          tn.nodeName !== sn.nodeName\n        ) {\n          this.checkNodeName(tn, sn)\n        } else if (\n          tn &&\n          sn &&\n          tn.nodeName === sn.nodeName\n        ) {\n          this.checkCtx(tn, sn)\n          tn.nodeType !== 3 &&\n            t.nodeType !== 8 &&\n            this.checkAttrs(tn, sn)\n        }\n      }\n      if (tn && sn) {\n        if (tn.childNodes && sn.childNodes) {\n          this.cfg.lengthDiff = [\n            ...t.childNodes,\n            ...sn.childNodes\n          ]\n        } else {\n          this.cfg.lengthDiff = null\n        }\n        Array.apply(null, this.cfg.lengthDiff).forEach(\n          (node, idx) => {\n            this.cfg.lengthDiff &&\n              this.loop(\n                tn.childNodes[idx],\n                sn.childNodes[idx],\n                tn,\n                sn\n              )\n          }\n        )\n      }\n    },\n    checkNodeName(tn, sn) {\n      const n = sn.cloneNode(true)\n      tn.parentElement.replaceChild(n, tn)\n    },\n    checkAttrs(tn, sn) {\n      const attrs = tn.attributes || []\n      const filteredAttrs = Object.keys(attrs).map(n => attrs[n])\n      const attrsNew = sn.attributes || []\n      const filteredAttrsNew = Object.keys(attrsNew).map(\n        n => attrsNew[n]\n      )\n      filteredAttrs.forEach(o => {\n        return sn.getAttribute(o.name) !== null\n          ? tn.setAttribute(o.name, sn.getAttribute(o.name))\n          : tn.removeAttribute(o.name)\n      })\n      filteredAttrsNew.forEach(a => {\n        return (\n          tn.getAttribute(a.name) !== sn.getAttribute(a.name) &&\n          tn.setAttribute(a.name, sn.getAttribute(a.name))\n        )\n      })\n    },\n    checkCtx(tn, sn) {\n      if (tn.nodeValue !== sn.nodeValue) {\n        tn.textContent = sn.textContent\n      }\n    },\n    checkNew(tn, sn, tParent = this.cfg.orig) {\n      if (sn && tn === undefined) {\n        const newNode = sn.cloneNode(true)\n        tParent.nodeType !== 3 &&\n          tParent.nodeType !== 8 &&\n          tParent.appendChild(newNode)\n      } else if (tn && sn === undefined) {\n        tn.parentElement.removeChild(tn)\n      }\n    }\n  }\n  // t = target\n  // s = source\n  Object.create(job).replace(t, s)\n}\n\n\n/**\n * A stateful component creator\n * @constructor\n * @param {object} state - The component state (model).\n */\nfunction Component(state, schema) {\n  const c = function c(state, schema) {\n    c.setState(state, schema)\n    return !state ? c.container : c\n  }\n\n  const C = Component\n  // register the add-ons\n  const validator = C.validator\n  const emitter = C.emitter\n  const tweenState = C.tweenState\n  const springTo = C.springTo\n  const strg = C.storage\n  const useAudio = C.useAudio\n  const onScroll = C.onScroll\n  const onLoop = C.onLoop\n  const devtools = C.devtools\n  const cache = C.memo ? C.memo : function(f){return f;}\n  // used by storage add-on.. maybe try to remove at some point\n  const self = c\n  // re-used a lot..\n  const O = Object\n  const R = RegExp\n\n  // for debouncing render() calls, and window, document\n  let timeout, w, d, raf, t\n\n  c.reactive = true                   // if true, re-render on every state change\n  c.immutable = true                  // if true, freeze the state object after updating it\n  c.debug = devtools ? true : false   //  if true, maintain a history of state changes in `.log`\n  c.scopedCss = true                  // auto prefix component css with a unique id\n  c.state = state                     // component state\n  c.schema = schema                   // component schema (optional)\n\n  // on init, add our initial state to the state history\n  c.log = [{ id: 0, state: state, action: \"init\" }]\n  c.i = c.log.length\n\n  c.view = props => props // the default view (just return the props)\n\n  c.middleware = []\n\n  // a unique ID, used for scoping component CSS and by devtools to register them\n  c.uid = Math.random()\n    .toString(36)\n    .split(\".\")[1]\n\n  c.isNode =\n    typeof process !== \"undefined\" &&\n    process !== null &&\n    process.versions !== null &&\n    process.versions.node !== null\n\n  if (!c.isNode) {\n    w = window\n    d = document  // TODO: support shadow DOM - check the root, set accordingly\n    raf = requestAnimationFrame\n    // the <style> elem into which we put our component CSS\n    // TODO: only do this if component styles are defined\n    c.css = d.createElement(\"style\")\n    c.css.id = c.uid\n    d.head.appendChild(c.css)\n  }\n\n  /**\n   * Define chainable named \"actions\" that will update our\n   * state in specific ways and register in our state history\n   */\n  c.actions = actions => {\n    c.actionsList = actions\n    // convert each key/value to set state function:\n    O.keys(actions).forEach(axn => {\n      if (typeof c[axn] !== \"undefined\") return false\n      // add the action as a function\n      c[axn] = newState => {\n        // set current action\n        c.action = axn\n        // run action\n        actions[axn](newState)\n        // make sure the component returns itself, so it's always chainable\n        return c\n      }\n    })\n    return c\n  }\n\n  /**\n   * Used to freeze the component state\n   * @param {object} o - the object to freeze\n   */\n  c.freeze = cache(o => {\n    if (!O.isFrozen(o)) {\n      // Recursively call until all child objects are frozen\n      O.keys(o).forEach(k => c.freeze(o[k]))\n      O.freeze(o)\n    }\n    return o\n  })\n\n  /**\n   * Used to compare the current and next component state\n   * @param {object} x - the object to compare with y\n   * @param {object} y - the object to compare with x\n   */\n  c.eq = cache((x, y) => {\n    const ok = O.keys,\n      tx = typeof x,\n      ty = typeof y\n    return x && y && tx === \"object\" && tx === ty\n      ? ok(x).length === ok(y).length &&\n          ok(x).every(key => c.eq(x[key], y[key]))\n      : String(x) === String(y)\n  })\n\n  /**\n   * Set the component state\n   * @param {object} newState - the new state to update to\n   */\n  c.setState = newState => {\n    const nextState = { ...c.state, ...newState };\n    // get initial state from localStorage, if it's in there\n    if (strg && !c.done) {\n      const pState = strg.getItem(c, nextState);\n      if (pState) newState = { ...newState, ...pState };\n    }\n    c.done = true;\n\n    // enable schema validation using @scottjarvis/validator\n    if (validator && c.schema) {\n      const err = cache(validator(nextState, c.schema))\n      const msg = \"State doesn't match schema:\"\n      if (err.length > 0) {\n        console.error(msg, \"\\n\", err, \"\\n\")\n        throw new Error(msg + \"\\n\" + JSON.stringify(err) + \"\\n\")\n      }\n    }\n    // ...the new state is valid, lets continue\n\n    // update previous and current state\n    c.prev = c.state\n    c.state = { ...c.state, ...nextState }\n\n    if (!c.eq(c.state, c.prev)) {\n\n      if (strg && c.done) {\n        // c.store is just the name of the key in localStorage,\n        // where we keep our JSON stringified state\n        strg.setItem(c, c.state)\n      }\n\n      // re-render component\n      if (c.reactive) c.render(c.container, c.ctx)\n\n      if (t && !c.isNode) cancelAnimationFrame(t)\n\n      // c.tt = component is \"time travelling\" (traversing state history)\n      if (c.debug && c.tt !== true) {\n        // if node, just use setTimeout\n        if (c.isNode) raf = (logFn) => setTimeout(() => logFn(), 1)\n        t = raf(() => {\n          // we are not traversing state history, so add the new state to the log\n          c.log.push({\n            id: c.log.length,\n            state: c.state,\n            action: c.action || \"setState\"\n          })\n          // move along index\n          c.i = c.log.length -1\n        })\n      }\n\n      // log state changes if debug = true\n      //if (c.debug) console.log(c.i, [c.state, ...c.log])\n\n      // freeze state so it can only be changed through setState()\n      if (c.immutable) c.freeze(c.state)\n\n      // if we updated using an \"action\" method, and emitter is avail,\n      // then emit an event with same name as the \"action\" called,\n      // passing in the current state\n      if (typeof emitter !== \"undefined\" && !!c.action) {\n        emitter.emit(`${c.action}`, { ...c.state })\n      }\n\n      // run any middlware functions that were defined by the user\n      c.middleware.forEach(fn => fn({ ...c.state }))\n\n      c.action = undefined\n\n      return c\n    }\n  }\n\n  /**\n   * Tween from the current state to the given state, then set the given\n   * state as the new state.\n   *\n   * @param {object} cfg - the settings used for the tweening\n   *\n   */\n  c.tweenState = (props, cfg) => {\n    typeof tweenState !== \"undefined\"\n      ? tweenState(c, props, cfg)\n      : c(props)\n    return c\n  }\n\n  /**\n   * Animate from the current state to the given state, then set the given\n   * state as the new state. Uses spring-based physics.\n   *\n   * @param {object} cfg - the settings used for the spring\n   *\n   */\n  c.springTo = (props, cfg) => {\n    typeof springTo !== \"undefined\"\n      ? springTo(c, props, cfg)\n      : c(props)\n    return c\n  }\n\n  /**\n   * Audio for components\n   *\n   * @param {object} audio library - the audio files and their settings\n   *\n   */\n  c.useAudio = (props) => {\n    if (typeof useAudio !== \"undefined\") {\n      useAudio(props, c)\n    } else {\n      c(props)\n    }\n    return c\n  }\n\n  /**\n   * Scroll-based animations for components\n   *\n   * @param {object}\n   *\n   */\n  c.onScroll = fn => {\n    if (onScroll) {\n      onScroll(fn, c);\n    }\n    return c\n  }\n\n  /**\n   * Game loop (fixed interval loop, variable interval rendering)\n   *\n   * @param {object}\n   *\n   */\n  if (onLoop) {\n    c.onLoop = (fn, o) => {\n      // create a controllable loop, if needed\n      c.loop = c.loop ? c.loop : new onLoop(o, fn, c)\n      // attach the methods to control the loop\n      c.start = () => c.loop.start();\n      c.stop = () => c.loop.stop();\n      c.pause = () => c.loop.pause();\n      c.resume = () => c.loop.resume();\n    }\n  }\n\n  c.on = (ev, fn) => {\n    typeof emitter !== \"undefined\"\n      ? emitter.on(ev, fn)\n      : false\n    return c\n  }\n\n  c.once = (ev, fn) => {\n    if (typeof emitter !== \"undefined\") {\n      emitter.on(ev, props => {\n        fn(props)\n        emitter.off(ev, fn)\n      })\n    }\n    return c\n  }\n\n  c.off = (ev, fn) => {\n    typeof emitter !== \"undefined\"\n      ? emitter.off(ev, fn)\n      : false\n    return c\n  }\n\n  /**\n   * Travel forward/backward to different states in the state history\n   * @param {number} num - the number of steps through the history to take\n   * @param {string} direction - 'f' for forward, 'b' for backwards\n   */\n  c.go = function(num, dir) {\n    let i\n    if (dir === \"f\") {\n      i = c.i + num\n    } else {\n      i = c.i - num\n    }\n    if (c.log[i]) {\n      c.i = i\n      c.tt = true;\n      c(c.log[i].state) // set state\n      c.tt = false;\n    }\n    return c\n  }\n\n  /**\n   * Go to previous (or first) state in the state history\n   * @param {number} num - the number of steps through the history to take, 0 if 'num' not given\n   */\n  c.rw = function(num) {\n    if (!num) {\n      if (c.log[0]) {\n        c.tt = true;\n        c(c.log[0].state) // set state\n        c.tt = false;\n      }\n      c.i = 0\n      return c\n    }\n    return c.go(num, \"b\")\n  }\n\n  /**\n   * Go to more recent state in the state history\n   * @param {number} num - the number of steps through the history to take, most recent if 'num' not given\n   */\n  c.ff = function(num) {\n    if (!num) {\n      if (c.log[c.log.length - 1]) {\n        c.tt = true;\n        c(c.log[c.log.length - 1].state) // set state\n        c.tt = false;\n      }\n      c.i = c.log.length -1\n      return c\n    }\n    return c.go(num, \"f\")\n  }\n\n  /**\n   * If in browser, puts scoped component styles in c.css\n   */\n  c.setCss = function() {\n    // if in browser\n    if (c && !c.isNode) {\n      // if a style is defined\n      if (c.css && typeof c.style === \"function\") {\n        // get the latest component style\n        let st = c.style(c.state) // the css\n\n        // auto-prefix CSS styles with a unique id,to \"scope\" the\n        // styles to the component only\n        if (c.scopedCss) {\n          const p = c.container.id ? \"#\" : \".\"\n          // get container id, or class if no id\n          let u = c.container.id ? c.container.id : c.container.className\n          // if container has no class or id, use uid\n          u = !!u ? u : c.uid\n\n          // ..these 3 are used for scoping CSS, in setCss()\n          const fx1 = new R(u + \" ,\\\\s*\\\\.\", \"gm\")\n          const fx2 = new R(u + \" ,\\\\s*#\", \"gm\")\n          const fx3 = new R(u + \" ,\\\\s*([a-z\\\\.#])\", \"gmi\")\n          // func to scope css\n          const fx = (v,p,u) =>\n            v.replace(/}/g, \"}\\n\")\n             .replace(/\\;\\s*\\n/g, \";\")\n             .replace(/{\\s*\\n/g, \"{ \")\n             .replace(/^\\s+|\\s+$/gm, \"\\n\")\n             .replace(/(^[\\.#\\w][\\w\\-]*|\\s*,[\\.#\\w][\\w\\-]*)/gm, p + u + \" $1\")\n             .replace(fx1, \", \" + p + u + \" \")\n             .replace(fx2, \", \" + p + u + \" #\")\n             .replace(fx3, \", \" + p + u + \" $1\")\n             .replace(/\\n/g, \"\")\n             .replace(/\\s\\s+/g, \" \")\n           // scope the css\n           st = cache(fx(st,p,u))\n        }\n\n        // minify the CSS\n        const minCss = st.replace(/\\n/g, \"\").replace(/\\s\\s+/g, \" \")\n        // if the new CSS is changed from previous, re-render it\n        if (c.css.innerHTML !== minCss) c.css.innerHTML = minCss\n      }\n    }\n  }\n\n  // used by .toString()\n  const toStr = (view, style) => {\n    let s = '';\n    if (view.outerHTML) {\n      if (style) s = `<style>${style}\\n</style>\\n`\n      s += `${view.outerHTML}`.replace(/^ {4}/gm, \"\")\n    } else if (typeof view === \"string\") {\n      try {\n        // if view is a JSON string\n        s = JSON.parse(view)\n        // return the view as prettified JSON\n        s = JSON.stringify(s, null, 2)\n      } catch (err) {\n        if (style) s = `<style>${style}\\n</style>\\n`\n        s += `${view}`.replace(/^ {4}/gm, \"\")\n      }\n    } else if (typeof view === \"object\" || Array.isArray(view)) {\n      // return the view as prettified JSON\n      s = JSON.stringify(view, null, 2)\n    }\n    //if (c.debug) console.log(s)\n    return s\n  }\n\n  /*\n  * Render the current view as a string, including\n  * our component styling, in a <style> tag\n  */\n  c.toString = function() {\n    let view = c.view(c.state, c.ctx)\n    let str = ''\n    let style = ''\n\n    // get local state\n    if (!c.done && strg) {\n      const pState = strg.getItem(c, c.state);\n      c(pState);\n      view = typeof c.view === \"function\" ? c.view(pState, c.ctx) : view\n    }\n\n    // get component styles, nicely indented\n    if (typeof c.style === \"function\") {\n      style = c.style(c.state).replace(/^ {4}/gm, \"\")\n    }\n\n    return cache(toStr(view,style))\n  }\n\n  /**\n   * Re-render the component and add it to the page\n   * @param {string|element} container - the element which holds the component\n   */\n  c.render = function(el, ctxType) {\n    if (c.isNode) return c.toString()\n\n    let view;\n\n    // get state from localStorage, if it's in there\n    if (!c.html && strg) {\n      const pState = strg.getItem(c, c.state);\n      view = typeof c.view === \"function\" ? c.view(pState, c.ctx) : null\n      c(pState); // set state\n    }\n\n    // make sure we have container as an HTML Element\n    if (d && !c.html) {\n      // TODO: support shadow DOM - check the root , set `d` accordingly\n      el = d.querySelector(el)\n    }\n    c.html = c.container = el\n\n    // get the canvas context, if needed\n    if (c.html && c.html.getContext) {\n      c.ctx = c.ctx ? c.ctx : c.html.getContext(ctxType ? ctxType : '2d')\n    }\n\n    if (timeout) cancelAnimationFrame(timeout)\n\n    timeout = raf(() => {\n      if (c.css && c.style) c.setCss()\n\n      // if we a container, lets (re)render the view (if any) to the page\n      if (c.html) {\n        view = typeof c.view === \"function\" ? c.view(c.state, c.ctx) : null\n        // if container exists, is *not* a canvas\n        if (!c.ctx) {\n          // get the view\n          // try to update view:\n          // try DOM diffing, else append to empty innerHTML, else replace innerHTML\n          try {\n            domDiff(c.html.firstElementChild, view.outerHTML ? view.outerHTML : view)\n            //console.log('diffed')\n          } catch (err) {\n            if (view && view.outerHTML) {\n              c.html.innerHTML = ''\n              c.html.append(view)\n              //console.log('cleared & appended')\n            } else {\n              c.html.innerHTML = view\n              //console.log('replaced innerHTML')\n            }\n          }\n        } else {\n          // else if container exists and *is* a canvas\n          c.view(c.state, c.ctx)\n        }\n      }\n      // for devtools\n      if (devtools && c.html) {\n        c.html.firstChild.setAttribute('data-uid', c.uid)\n        devtools.populateUI(c.html)\n      }\n    })\n\n    // return the container element\n    return c.html\n  }\n\n  // for devtools\n  if (!c.isNode) {\n    w.sjComponents = w.sjComponents || {};\n    w.sjComponents[c.uid] = c;\n  }\n\n  return c\n}\n\nexport default Component\n"],"names":["domDiff","t","s","d","document","job","cfg","orig","[object Object]","v","createElement","innerHTML","vHTML","content","firstChild","nextElementSibling","nodeName","this","loop","parentElement","replaceChild","tn","sn","tOrig","checkNew","checkNodeName","checkCtx","nodeType","checkAttrs","childNodes","lengthDiff","Array","apply","forEach","node","idx","n","cloneNode","attrs","attributes","filteredAttrs","Object","keys","map","attrsNew","filteredAttrsNew","o","getAttribute","name","setAttribute","removeAttribute","a","nodeValue","textContent","tParent","undefined","newNode","appendChild","removeChild","create","replace","Component","state","schema","c","setState","container","C","validator","emitter","tweenState","springTo","strg","storage","useAudio","onScroll","onLoop","devtools","cache","memo","f","O","R","RegExp","timeout","w","raf","reactive","immutable","debug","scopedCss","i","log","id","action","length","view","props","middleware","uid","Math","random","toString","split","isNode","process","versions","window","requestAnimationFrame","css","head","actions","actionsList","axn","newState","freeze","isFrozen","k","eq","x","y","ok","tx","every","key","String","nextState","done","pState","getItem","err","msg","console","error","Error","JSON","stringify","prev","setItem","render","ctx","cancelAnimationFrame","tt","logFn","setTimeout","push","emit","fn","start","stop","pause","resume","on","ev","once","off","go","num","dir","rw","ff","setCss","style","st","p","u","className","fx1","fx2","fx3","fx","minCss","outerHTML","parse","isArray","toStr","el","ctxType","html","querySelector","getContext","firstElementChild","append","populateUI","sjComponents"],"mappings":"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"}