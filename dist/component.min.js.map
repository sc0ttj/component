{"version":3,"file":"component.min.js","sources":["../src/component.js"],"sourcesContent":["// Begin example implementation\n\n// Note:   This is just a demo/experiment\n// Goals:  Super easy to setup, small code base, automatic re-renders on state update\n;(\"use strict\")\n\n// t = target\n// s = source\nconst domDiff = (t, s) => { // from https://codepen.io/tevko/pen/LzXjKE?editors=0010\n  const job = {\n    cfg: {\n      orig: t\n    },\n    // t = target\n    // s = source\n    replace(t, s = t) {\n      const v = document.createElement(\"template\")\n      v.innerHTML = s\n      const vHTML = v.content.firstChild.nextElementSibling\n      if (vHTML.nodeName !== t.nodeName) {\n        t.parentElement.replaceChild(vHTML, t)\n        return\n      }\n      this.loop(t, vHTML)\n    },\n    // tn = target Node\n    // sn = source Node\n    loop(tn, sn, tOrig) {\n      if (tn || sn) {\n        this.checkNew(tn, sn, tOrig)\n        if (\n          tn &&\n          sn &&\n          tn.nodeName !== sn.nodeName\n        ) {\n          this.checkNodeName(tn, sn)\n        } else if (\n          tn &&\n          sn &&\n          tn.nodeName === sn.nodeName\n        ) {\n          this.checkCtx(tn, sn)\n          tn.nodeType !== 3 &&\n            t.nodeType !== 8 &&\n            this.checkAttrs(tn, sn)\n        }\n      }\n      if (tn && sn) {\n        if (tn.childNodes && sn.childNodes) {\n          this.cfg.lengthDiff = [\n            ...t.childNodes,\n            ...sn.childNodes\n          ]\n        } else {\n          this.cfg.lengthDiff = null\n        }\n        Array.apply(null, this.cfg.lengthDiff).forEach(\n          (node, idx) => {\n            this.cfg.lengthDiff &&\n              this.loop(\n                tn.childNodes[idx],\n                sn.childNodes[idx],\n                tn,\n                sn\n              )\n          }\n        )\n      }\n    },\n    checkNodeName(tn, sn) {\n      const n = sn.cloneNode(true)\n      tn.parentElement.replaceChild(n, tn)\n    },\n    checkAttrs(tn, sn) {\n      const attrs = tn.attributes || []\n      const filteredAttrs = Object.keys(attrs).map(n => attrs[n])\n      const attrsNew = sn.attributes || []\n      const filteredAttrsNew = Object.keys(attrsNew).map(\n        n => attrsNew[n]\n      )\n      filteredAttrs.forEach(o => {\n        return sn.getAttribute(o.name) !== null\n          ? tn.setAttribute(o.name, sn.getAttribute(o.name))\n          : tn.removeAttribute(o.name)\n      })\n      filteredAttrsNew.forEach(a => {\n        return (\n          tn.getAttribute(a.name) !== sn.getAttribute(a.name) &&\n          tn.setAttribute(a.name, sn.getAttribute(a.name))\n        )\n      })\n    },\n    checkCtx(tn, sn) {\n      if (tn.nodeValue !== sn.nodeValue) {\n        tn.textContent = sn.textContent\n      }\n    },\n    checkNew(tn, sn, tParent = this.cfg.orig) {\n      if (sn && tn === undefined) {\n        const newNode = sn.cloneNode(true)\n        tParent.nodeType !== 3 &&\n          tParent.nodeType !== 8 &&\n          tParent.appendChild(newNode)\n      } else if (tn && sn === undefined) {\n        tn.parentElement.removeChild(tn)\n      }\n    }\n  }\n  // t = target\n  // s = source\n  Object.create(job).replace(t, s)\n}\n\n\n/**\n * A stateful component creator\n * @constructor\n * @param {object} state - The component state (model).\n */\nfunction Component(state, schema) {\n  const c = function c(state, schema) {\n    c.setState(state, schema)\n    return !state ? c.container : c\n  }\n\n  const C = Component\n  // register the add-ons\n  const validator = C.validator\n  const emitter = C.emitter\n  const tweenState = C.tweenState\n  const springTo = C.springTo\n  const strg = C.storage\n  const useAudio = C.useAudio\n  const onScroll = C.onScroll\n  const onLoop = C.onLoop\n  const devtools = C.devtools\n  const cache = C.memo ? C.memo : function(f){return f;}\n  // used by storage add-on.. maybe try to remove at some point\n  const self = c\n  // re-used a lot..\n  const O = Object\n  const R = RegExp\n\n  // for debouncing render() calls, and window, document\n  let timeout, w, d, raf, t\n\n  c.reactive = onLoop ? false: true   // if true, re-render on every state change.. set to false if using onLoop\n  c.immutable = true                  // if true, freeze the state object after updating it\n  c.debug = devtools ? true : false   //  if true, maintain a history of state changes in `.log`\n  c.scopedCss = true                  // auto prefix component css with a unique id\n  c.state = state                     // component state\n  c.schema = schema                   // component schema (optional)\n\n  // on init, add our initial state to the state history\n  c.log = [{ id: 0, state: state, action: \"init\" }]\n  c.i = c.log.length\n\n  c.view = props => props // the default view (just return the props)\n  c.draw = c.view // alias, make more sense when drawing to canvas (rather than DOM)\n  c.ctx = null;  // will be the canvas context, if set\n\n  c.middleware = []\n\n  // a unique ID, used for scoping component CSS and by devtools to register them\n  c.uid = Math.random()\n    .toString(36)\n    .split(\".\")[1]\n\n  c.isNode =\n    typeof process !== \"undefined\" &&\n    process !== null &&\n    process.versions !== null &&\n    process.versions.node !== null\n\n  if (!c.isNode) {\n    w = window\n    d = document\n    raf = requestAnimationFrame\n    // the <style> elem into which we put our component CSS\n    c.css = d.createElement(\"style\")\n    c.css.id = c.uid\n    d.head.appendChild(c.css)\n  }\n\n  /**\n   * Define chainable named \"actions\" that will update our\n   * state in specific ways and register in our state history\n   */\n  c.actions = actions => {\n    c.actionsList = actions\n    // convert each key/value to set state function:\n    O.keys(actions).forEach(axn => {\n      if (typeof c[axn] !== \"undefined\") return false\n      // add the action as a function\n      c[axn] = newState => {\n        // set current action\n        c.action = axn\n        // run action\n        actions[axn](newState)\n        // make sure the component returns itself, so it's always chainable\n        return c\n      }\n    })\n    return c\n  }\n\n  /**\n   * Used to freeze the component state\n   * @param {object} o - the object to freeze\n   */\n  c.freeze = cache(o => {\n    if (!O.isFrozen(o)) {\n      // Recursively call until all child objects are frozen\n      O.keys(o).forEach(k => c.freeze(o[k]))\n      O.freeze(o)\n    }\n    return o\n  })\n\n  /**\n   * Used to compare the current and next component state\n   * @param {object} x - the object to compare with y\n   * @param {object} y - the object to compare with x\n   */\n  c.eq = cache((x, y) => {\n    const ok = O.keys,\n      tx = typeof x,\n      ty = typeof y\n    return x && y && tx === \"object\" && tx === ty\n      ? ok(x).length === ok(y).length &&\n          ok(x).every(key => c.eq(x[key], y[key]))\n      : String(x) === String(y)\n  })\n\n  /**\n   * Set the component state\n   * @param {object} newState - the new state to update to\n   */\n  c.setState = newState => {\n    const nextState = { ...c.state, ...newState };\n    // get initial state from localStorage, if it's in there\n    if (strg && !c.done) {\n      const pState = strg.getItem(c, nextState);\n      if (pState) newState = { ...newState, ...pState };\n    }\n    c.done = true;\n\n    // enable schema validation using @scottjarvis/validator\n    if (validator && c.schema) {\n      const err = cache(validator(nextState, c.schema))\n      const msg = \"State doesn't match schema:\"\n      if (err.length > 0) {\n        console.error(msg, \"\\n\", err, \"\\n\")\n        throw new Error(msg + \"\\n\" + JSON.stringify(err) + \"\\n\")\n      }\n    }\n    // ...the new state is valid, lets continue\n\n    // update previous and current state\n    c.prev = c.state\n    c.state = { ...c.state, ...nextState }\n\n    if (!c.eq(c.state, c.prev)) {\n\n      if (strg && c.done) {\n        // c.store is just the name of the key in localStorage,\n        // where we keep our JSON stringified state\n        strg.setItem(c, c.state)\n      }\n\n      // re-render component\n      if (c.reactive) c.render(c.container, c.ctx)\n\n      if (t && !c.isNode) cancelAnimationFrame(t)\n\n      // c.tt = component is \"time travelling\" (traversing state history)\n      if (c.debug && c.tt !== true) {\n        // if node, just use setTimeout\n        if (c.isNode) raf = (logFn) => setTimeout(() => logFn(), 1)\n        t = raf(() => {\n          // we are not traversing state history, so add the new state to the log\n          c.log.push({\n            id: c.log.length,\n            state: c.state,\n            action: c.action || \"setState\"\n          })\n          // move along index\n          c.i = c.log.length -1\n        })\n      }\n\n      // log state changes if debug = true\n      //if (c.debug) console.log(c.i, [c.state, ...c.log])\n\n      // freeze state so it can only be changed through setState()\n      if (c.immutable) c.freeze(c.state)\n\n      // if we updated using an \"action\" method, and emitter is avail,\n      // then emit an event with same name as the \"action\" called,\n      // passing in the current state\n      if (typeof emitter !== \"undefined\" && !!c.action) {\n        emitter.emit(`${c.action}`, { ...c.state })\n      }\n\n      // run any middlware functions that were defined by the user\n      c.middleware.forEach(fn => fn({ ...c.state }))\n\n      c.action = undefined\n\n      return c\n    }\n  }\n\n  /**\n   * Tween from the current state to the given state, then set the given\n   * state as the new state.\n   *\n   * @param {object} cfg - the settings used for the tweening\n   *\n   */\n  c.tweenState = (props, cfg) => {\n    typeof tweenState !== \"undefined\"\n      ? tweenState(c, props, cfg)\n      : c(props)\n    return c\n  }\n\n  /**\n   * Animate from the current state to the given state, then set the given\n   * state as the new state. Uses spring-based physics.\n   *\n   * @param {object} cfg - the settings used for the spring\n   *\n   */\n  c.springTo = (props, cfg) => {\n    typeof springTo !== \"undefined\"\n      ? springTo(c, props, cfg)\n      : c(props)\n    return c\n  }\n\n  /**\n   * Audio for components\n   *\n   * @param {object} audio library - the audio files and their settings\n   *\n   */\n  c.useAudio = (props) => {\n    if (typeof useAudio !== \"undefined\") {\n      useAudio(props, c)\n    } else {\n      c(props)\n    }\n    return c\n  }\n\n  /**\n   * Scroll-based animations for components\n   *\n   * @param {object}\n   *\n   */\n  c.onScroll = fn => {\n    if (onScroll) {\n      onScroll(fn, c);\n    }\n    return c\n  }\n\n  /**\n   * Game loop (fixed interval loop, variable interval rendering)\n   *\n   * @param {object}\n   *\n   */\n  c.onLoop = fn => {\n    if (onLoop) onLoop(fn, c);\n    return c\n  }\n\n  c.on = (ev, fn) => {\n    typeof emitter !== \"undefined\"\n      ? emitter.on(ev, fn)\n      : false\n    return c\n  }\n\n  c.once = (ev, fn) => {\n    if (typeof emitter !== \"undefined\") {\n      emitter.on(ev, props => {\n        fn(props)\n        emitter.off(ev, fn)\n      })\n    }\n    return c\n  }\n\n  c.off = (ev, fn) => {\n    typeof emitter !== \"undefined\"\n      ? emitter.off(ev, fn)\n      : false\n    return c\n  }\n\n  /**\n   * Travel forward/backward to different states in the state history\n   * @param {number} num - the number of steps through the history to take\n   * @param {string} direction - 'f' for forward, 'b' for backwards\n   */\n  c.go = function(num, dir) {\n    let i\n    if (dir === \"f\") {\n      i = c.i + num\n    } else {\n      i = c.i - num\n    }\n    if (c.log[i]) {\n      c.i = i\n      c.tt = true;\n      c(c.log[i].state) // set state\n      c.tt = false;\n    }\n    return c\n  }\n\n  /**\n   * Go to previous (or first) state in the state history\n   * @param {number} num - the number of steps through the history to take, 0 if 'num' not given\n   */\n  c.rw = function(num) {\n    if (!num) {\n      if (c.log[0]) {\n        c.tt = true;\n        c(c.log[0].state) // set state\n        c.tt = false;\n      }\n      c.i = 0\n      return c\n    }\n    return c.go(num, \"b\")\n  }\n\n  /**\n   * Go to more recent state in the state history\n   * @param {number} num - the number of steps through the history to take, most recent if 'num' not given\n   */\n  c.ff = function(num) {\n    if (!num) {\n      if (c.log[c.log.length - 1]) {\n        c.tt = true;\n        c(c.log[c.log.length - 1].state) // set state\n        c.tt = false;\n      }\n      c.i = c.log.length -1\n      return c\n    }\n    return c.go(num, \"f\")\n  }\n\n  /**\n   * If in browser, puts scoped component styles in c.css\n   */\n  c.setCss = function() {\n    // if in browser\n    if (c && !c.isNode) {\n      // if a style is defined\n      if (c.css && typeof c.style === \"function\") {\n        // get the latest component style\n        let st = c.style(c.state) // the css\n\n        // auto-prefix CSS styles with a unique id,to \"scope\" the\n        // styles to the component only\n        if (c.scopedCss) {\n          const p = c.container.id ? \"#\" : \".\"\n          // get container id, or class if no id\n          let u = c.container.id ? c.container.id : c.container.className\n          // if container has no class or id, use uid\n          u = !!u ? u : c.uid\n\n          // ..these 3 are used for scoping CSS, in setCss()\n          const fx1 = new R(u + \" ,\\\\s*\\\\.\", \"gm\")\n          const fx2 = new R(u + \" ,\\\\s*#\", \"gm\")\n          const fx3 = new R(u + \" ,\\\\s*([a-z\\\\.#])\", \"gmi\")\n          // func to scope css\n          const fx = (v,p,u) =>\n            v.replace(/}/g, \"}\\n\")\n             .replace(/\\;\\s*\\n/g, \";\")\n             .replace(/{\\s*\\n/g, \"{ \")\n             .replace(/^\\s+|\\s+$/gm, \"\\n\")\n             .replace(/(^[\\.#\\w][\\w\\-]*|\\s*,[\\.#\\w][\\w\\-]*)/gm, p + u + \" $1\")\n             .replace(fx1, \", \" + p + u + \" \")\n             .replace(fx2, \", \" + p + u + \" #\")\n             .replace(fx3, \", \" + p + u + \" $1\")\n             .replace(/\\n/g, \"\")\n             .replace(/\\s\\s+/g, \" \")\n           // scope the css\n           st = cache(fx(st,p,u))\n        }\n\n        // minify the CSS\n        const minCss = st.replace(/\\n/g, \"\").replace(/\\s\\s+/g, \" \")\n        // if the new CSS is changed from previous, re-render it\n        if (c.css.innerHTML !== minCss) c.css.innerHTML = minCss\n      }\n    }\n  }\n\n  // used by .toString()\n  const toStr = (view, style) => {\n    let s = '';\n    if (view.outerHTML) {\n      if (style) s = `<style>${style}\\n</style>\\n`\n      s += `${view.outerHTML}`.replace(/^ {4}/gm, \"\")\n    } else if (typeof view === \"string\") {\n      try {\n        // if view is a JSON string\n        s = JSON.parse(view)\n        // return the view as prettified JSON\n        s = JSON.stringify(s, null, 2)\n      } catch (err) {\n        if (style) s = `<style>${style}\\n</style>\\n`\n        s += `${view}`.replace(/^ {4}/gm, \"\")\n      }\n    } else if (typeof view === \"object\" || Array.isArray(view)) {\n      // return the view as prettified JSON\n      s = JSON.stringify(view, null, 2)\n    }\n    //if (c.debug) console.log(s)\n    return s\n  }\n\n  /*\n  * Render the current view as a string, including\n  * our component styling, in a <style> tag\n  */\n  c.toString = function() {\n    let view = c.view(c.state, c.ctx)\n    let str = ''\n    let style = ''\n\n    // get local state\n    if (!c.done && strg) {\n      const pState = strg.getItem(c, c.state);\n      c(pState);\n      view = typeof c.view === \"function\" ? c.view(pState, c.ctx) : view\n    }\n\n    // get component styles, nicely indented\n    if (typeof c.style === \"function\") {\n      style = c.style(c.state).replace(/^ {4}/gm, \"\")\n    }\n\n    return cache(toStr(view,style))\n  }\n\n  /**\n   * Re-render the component and add it to the page\n   * @param {string|element} container - the element which holds the component\n   */\n  c.render = function(el, ctxType) {\n    if (c.isNode) return c.toString()\n\n    let view;\n\n    // get state from localStorage, if it's in there\n    if (!c.html && strg) {\n      const pState = strg.getItem(c, c.state);\n      view = typeof c.view === \"function\" ? c.view(pState, c.ctx) : null\n      c(pState); // set state\n    }\n\n    // make sure we have container as an HTML Element\n    if (d && !c.html) el = d.querySelector(el)\n    c.html = c.container = el\n\n    // get the cavas context, if needed\n    if (c.html && c.html.getContext) {\n      c.ctx = c.ctx ? c.ctx : c.html.getContext(ctxType ? ctxType : '2d')\n    }\n\n    if (timeout) cancelAnimationFrame(timeout)\n\n    timeout = raf(() => {\n      if (c.css && c.style) c.setCss()\n\n      // if we a container, lets (re)render the view (if any) to the page\n      if (c.html) {\n        view = typeof c.view === \"function\" ? c.view(c.state, c.ctx) : null\n        // if container exists, is *not* a canvas\n        if (!c.ctx) {\n          // get the view\n          // try to update view:\n          // try DOM diffing, else append to empty innerHTML, else replace innerHTML\n          try {\n            domDiff(c.html.firstElementChild, view.outerHTML ? view.outerHTML : view)\n            //console.log('diffed')\n          } catch (err) {\n            if (view && view.outerHTML) {\n              c.html.innerHTML = ''\n              c.html.append(view)\n              //console.log('cleared & appended')\n            } else {\n              c.html.innerHTML = view\n              //console.log('replaced innerHTML')\n            }\n          }\n        } else {\n          // else if container exists and *is* a canvas\n          c.view(c.state, c.ctx)\n        }\n      }\n      // for devtools\n      if (devtools && c.html) {\n        c.html.firstChild.setAttribute('data-uid', c.uid)\n        devtools.populateUI(c.html)\n      }\n    })\n\n    // return the container element\n    return c.html\n  }\n\n  // for devtools\n  if (!c.isNode) {\n    w.sjComponents = w.sjComponents || {};\n    w.sjComponents[c.uid] = c;\n  }\n\n  return c\n}\n\nexport default Component\n"],"names":["domDiff","t","s","job","cfg","orig","[object Object]","v","document","createElement","innerHTML","vHTML","content","firstChild","nextElementSibling","nodeName","this","loop","parentElement","replaceChild","tn","sn","tOrig","checkNew","checkNodeName","checkCtx","nodeType","checkAttrs","childNodes","lengthDiff","Array","apply","forEach","node","idx","n","cloneNode","attrs","attributes","filteredAttrs","Object","keys","map","attrsNew","filteredAttrsNew","o","getAttribute","name","setAttribute","removeAttribute","a","nodeValue","textContent","tParent","undefined","newNode","appendChild","removeChild","create","replace","Component","state","schema","c","setState","container","C","validator","emitter","tweenState","springTo","strg","storage","useAudio","onScroll","onLoop","devtools","cache","memo","f","O","R","RegExp","timeout","w","d","raf","reactive","immutable","debug","scopedCss","i","log","id","action","length","draw","view","props","ctx","middleware","uid","Math","random","toString","split","isNode","process","versions","window","requestAnimationFrame","css","head","actions","actionsList","axn","newState","freeze","isFrozen","k","eq","x","y","ok","tx","every","key","String","nextState","done","pState","getItem","err","msg","console","error","Error","JSON","stringify","prev","setItem","render","cancelAnimationFrame","tt","logFn","setTimeout","push","emit","fn","on","ev","once","off","go","num","dir","rw","ff","setCss","style","st","p","u","className","fx1","fx2","fx3","fx","minCss","outerHTML","parse","isArray","toStr","el","ctxType","html","querySelector","getContext","firstElementChild","append","populateUI","sjComponents"],"mappings":"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"}