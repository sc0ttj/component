<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Component thing demo</title>
</head>

<body>

  <div class="main">
    <p class="container" id="a-unique-string">You component will end up in here!</p>
  </div>

  <script src="../src/component.js"></script>
  <script>

  // ------------------------------------------------
  // USAGE: Defining components
  // ------------------------------------------------

  // Define our app state
  var state = {
    count: 0,
    x: 0,
    incrementBy: 5,
    id: "foo-id",
    items: [
      { name: "Item one" },
      { name: "Item two" },
    ],
    btnColor: 'black',
    borderColor: 'grey',
  }

  // Define some generic, re-usable, stateless "sub-components"
  var Heading = (text)      => `<h1>${text}</h1>`
  var List    = (items)     => `<ul>${items.map(item => `<li>${item.name}</li>`).join('')}</ul>`
  var Button  = (label, fn) => `<button class="btn" onclick=${fn}>${label}</button>`

  // Define a stateful main component
  var App = new Component(state);

  // IMPORTANT -  Define a view
  App.view = (props) => `
    <div id="myapp">
      ${Heading('Total so far = ' + props.count)}
      ${List(props.items)}
      ${Button('Click here', `App.clickBtn(${props.incrementBy})`)}
    </div>`

  // OPTIONAL - Define some events
  App.clickBtn = (props) => App.setState({ count: App.state.count + props})

  // OPTIONAL - Define some styles for the view
  App.style = (props) => `
    #myapp {
      background-color: #eee;
      border: 2px solid ${props.borderColor || 'red'};
      margin: 0 auto;
      max-width: 360px;
      padding: 0 18px 18px 18px;
    }
    .btn {
      background-color: ${props.btnColor || 'red'};
      border: 0;
      color: white;
      padding: 6px;
      position: relative;
      left: ${props.x}px;
    }`



  // ------------------------------------------------
  // USAGE: Using the component
  // ------------------------------------------------

  App.debug = false     // disable logging of state changes in console/DevTools
  App.debug = true      // enable logging of state changes in console/DevTools
  App.reactive = false  // disable auto re-render on state changes
  App.reactive = true   // enable auto re-render on state changes

  // Add our app to the page
  App.render('.container')

  // Using setState() to trigger a full re-render
  App.setState({
    items: [ { name: "First" } ],
  })

  // ...Or call any methods you defined directly
  App.clickBtn(1)



  // ------------------------------------------------
  // OPTIONAL: Define chainable "actions", to update the state more easily
  // ------------------------------------------------

  // Define "actions" to update your state in specific ways

  // These "actions" are like regular methods, except
  // they're always chainable and tagged by name in
  // your components state history
  App.actions({

    update:     (props) => App.setState({ props }), // same as calling App.setState()

    reset:      (props) => App.setState({ count: 0 }),

    count:      (props) => App.setState({ count: props }),

    plus:       (props) => App.setState({ count: App.state.count + props }),

    minus:      (props) => App.setState({ count: App.state.count - props }),

    items:      (props) => App.setState({ items: props }),

    addItems:   (props) => App.setState({ items: [ ...App.state.items, ...props ] }),

    animate:    (props) => App.setState({ x: App.state.x + 1 }),

  });

  // If you defined some "actions", you can use them
  // to update specific parts of your state
  App.plus(105)
  App.minus(5)

  // A components "actions" can be chained
  App
    .minus(1)
    .minus(1)
    .minus(1)
    .plus(3)
    .addItems([ { name: "two" }, { name: "three" } ])


  // ------------------------------------------------
  // OPTIONAL: Using the state "timeline"
  // ------------------------------------------------

  // Take a "snapshot" (we'll use it later)
  var snapshot = App.state

  App.rw()         // go to initial state
  App.ff()        // go to latest state
  App.rw(2)        // rewind two steps to a previous state
  App.ff(2)       // fast-forward two steps to a more current state

  // Set a previous state
  App.setState(App.log[0].state)
  // Set a "named" state, from a previous point in time
  App.setState(snapshot)

  // show the history of state changes
  console.log('App.log')
  console.log(App.log)

  </script>
</body>
