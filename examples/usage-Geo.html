<html>
<head>
  <meta charset="UTF-8">
  <title>Component - Geo add-on</title>
  <script src="../dist/component.min.js"></script>
  <script src="../dist/geo.min.js"></script>
  <style>
    canvas {
      border: 1px solid #222;
    }
  </style>
</head>
<body>

  <canvas class="container"></canvas>

<script>
  // list of plces and their latLongs
  const places = [
    { id: 'anchorage', lat: 61.217381, long: -149.863129 },
    { id: 'bangkok', lat: 13.75398, long: 100.50144 },
    { id: 'brisbane', lat: -27.46794, long: 153.02809 },
    { id: 'capetown', lat: -33.92584, long: 18.42322 },
    { id: 'dakkar', lat: 14.716677, long: -15.067686 },
    { id: 'delhi', lat: 28.65381, long: 77.22897 },
    { id: 'lagos', lat: 6.45407, long: 3.39467 },
    { id: 'london', lat: 51.50853, long: -0.12574 },
    { id: 'NYC', lat: 40.71427, long: -74.00597 },
    { id: 'oslo', lat: 59.91273, long: 10.74609 },
    { id: 'salvador', lat: -12.97111, long: -38.51083 },
    { id: 'mecca', lat: 21.42664, long: 39.82563 },
    { id: 'moscow', lat: 55.75222, long: 37.61556 },
    { id: 'panama', lat: 8.9936, long: -79.51973 },
    { id: 'perth', lat: -31.95224, long: 115.8614 },
    { id: 'sanfran', lat: 37.77493, long: -122.41942 },
    { id: 'santiago', lat: -33.45694, long: -70.64827 },
    { id: 'tokyo', lat: 35.6895, long: 139.69171 },
  ];

  // helper funcs

  function drawPlace(ctx, place) {
    // get pixel position from latLong
    const [x, y] = map.latLongToPixels(place.lat, place.long);
    // draw it
    ctx.fillText(place.id, x-8, y-5);
    ctx.beginPath();
    ctx.arc(x, y, 2, 0, 2*Math.PI);
    ctx.stroke();
    ctx.closePath();
  }

  const drawMap = (ctx, url) => {
      const image = new Image();
      image.src = url;
      image.onload = () => {
        ctx.globalAlpha = 0.25;
        ctx.drawImage(image, 0, 0, ctx.canvas.width, ctx.canvas.height)
        // draw each place here, after the image has loaded
        ctx.globalAlpha = 1;
        places.forEach(place => {
          drawPlace(ctx, place);
        });
      }
  }

  // define a new component
  const Foo = new Component({ x: 0, y: 0 });

  const map = new Geo({
    // dimensions in pixels
    width: 800,
    height: 591,
    // map bounds, in latlongs
    top: 83.65,
    bottom: -76,
    left: -187,
    right: 189.75,
  });

  // define a "view", that draws to the components canvas
  Foo.view = (props, ctx) => {
    // setup the canvas
    ctx.font = "16px Arial";
    ctx.canvas.width  = 800;
    ctx.canvas.height = 591;
    ctx.canvas.style.width  = '800px';
    ctx.canvas.style.height = '591px';
    drawMap(ctx, 'https://upload.wikimedia.org/wikipedia/commons/thumb/1/14/Mercator_Projection.svg/800px-Mercator_Projection.svg.png');
  };

  // render to a canvas, and attach its context (`ctx`) to our component
  Foo.render('.container', '2d');

  console.log(
    'Distance between London and Oslo:',
    `${map.getDistance(
      places[7].lat, places[7].long,
      places[9].lat, places[9].long,
    )} km`
  );
  console.log('Places nearest to Bangkok:', map.getNearestTo(places[1], places));
  console.log('Places nearest to London:', map.getNearestTo(places[7], places));

</script>

</body>
</html>
