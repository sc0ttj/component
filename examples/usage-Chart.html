<html>
<head>
  <meta charset="UTF-8">
  <title>Component - canvas demo</title>
  <script src="../dist/component.min.js"></script>
  <script src="../dist/chart.min.js"></script>
  <style>
    .container {
      border: 1px solid #222;
      margin: 1em;
      width: 640px;
      height: 480px;
    }
  </style>
</head>
<body>

  <canvas class="container"></canvas>

<script>
  let frame = 1; // frame count
  const colors = [ 'rgba(255,0,0, 0.5)', 'rgba(0,0,255, 0.5)' ];

  // Enable our Chart addon, it'll create an extended 2dContext,
  // with a chainable API, and these extra methods:
  //
  //    .data(), .margin(), .xAxis(), .yAxis(), .each(),
  //
  // Inside `.each()`, you get these drawing methods:
  //
  //    data.circle(), data.rect(), data.line()
  //
  Component.Ctx = Chart;

  // define a new component
  const myChart = new Component({ x: 280, y: 100 });

  // define the "view", that draws to the components canvas
  myChart.view = (props, ctx) => {

    if (frame === 1) {
      // set the canvas size (w, h, aspectRatio)
      ctx.size(640,480)           // set width and height, ignore aspect ratio
      //ctx.size(640, 480, null)   // same as above
      //ctx.size(null, 480, 4/3)   // set as 4:3,  grow till height = 4.0
      //ctx.size(null, 480, 16/9)  // set as 16:9, grow till height = 480
      //ctx.size(640, null, 3/4)   // set as 4:3, crop till width = 640
      //ctx.size(640, null, 9/16)  // set as 16:9, crop till width = 640
      //console.clear();
    }


      ctx.beginPath()

      .data({
        'USA': [{},
          { year: 2000, medals: 25 },
          { year: 2001, medals: 15 },
          { year: 2002, medals: 21 },
          { year: 2003, medals: 42 },
          { year: 2004, medals: 47 },
          { year: 2005, medals: 21 },
          { year: 2006, medals: 24 },
        ],
        'China': [{},
          { year: 2000, medals: 10 },
          { year: 2001, medals: 10 },
          { year: 2002, medals: 25 },
          { year: 2003, medals: 40 },
          { year: 2004, medals: 32 },
          { year: 2005, medals: 12 },
          { year: 2006, medals: 21 },
        ]
      })
      .margin(50,60,120,40)  // top, bottom, left, right
      .xAxis([1999,2007], 1, -6, 'Year', true)  // range, scale, tickSize, label, centeredLabels
      .yAxis([0,50],      5, -6, 'Gold Medals') // range, scale, tickSize, label
      .each((country, key, i) => {
        // Now we can work with our "decorated" chart data, ${country}.
        // Work with your top-level data here, like draw a legend..

        // Now lets go over each bit of data for this country
        country.forEach(data => {
          // Note, ${data} has .bar(), .rect(), and .line() methods added,
          // which try to draw "ready-made" shapes, in the right place.

          if (!data.medals && data.medals !== 0) return;

          // You should only define the attrs you want "joined" to your
          // data - and don't override any others.

          data.bar({
            height: data.medals,
            //width: data.medals,
            fill: colors[i]
          });

          data.circle({
            cy: data.medals,
            //cx: data.medals,
            cr: 5,
            fill: colors[i]
          });

          data.line({
            py: data.medals,
            //px: data.medals,
            stroke: colors[i]
          });

        });

      });

      frame++;
  };


  // render to a canvas, and attach its context (`ctx`) to our component
  myChart.render('.container', '2d');

</script>
</body>
</html>
